<template>

  <div id="component-filters">
  
      <div id="container-filters-mobile">

          <form name="form-filters-mobile" class="overflow-x-scroll">

              <fieldset v-if="prop_mode==1" class="container_mode">
                  <h4>{{ $t('filters').mode }}</h4>

                   <select v-model="values.mode_mobile" :placeholder="$t('filters').mode" @change="updateMobileMode">
                      <option v-for="mode in values.options_mode" :value="mode.value">
                          {{ mode.label }}
                      </option>
                  </select>
              </fieldset>

              <fieldset v-if="prop_indicator==1" class="container_indicator">
                  <h4>{{ $t('filters').indicators }}</h4>

                  <select v-model="values.key" @change="updateMobileSelect">
                      <option v-for="opt in values.options_indicator" :value="opt.key">
                          {{ opt.label }}
                      </option>
                  </select>

              </fieldset>

              <fieldset v-if="prop_types_single==1" class="container_types_single_1">
                  <h4>{{ $t('filters').types.label }}</h4>
                  
                  <select v-model="values.types" :placeholder="$t('filters').types.label" @change="update">
                      <option value="0">{{ $t('filters').types.values[0] }}</option>
                      </option>
                      <option value="1">{{ $t('filters').types.values[1] }}</option>
                      </option>
                  </select>

              </fieldset>

              <fieldset v-if="prop_types_multiple==1" class="container_types_multiple_1">
                  <h4>{{ $t('filters').types.label }}</h4>
                  
                  <select v-model="values.types" :placeholder="$t('filters').types.label" @change="update">
                      <option value="0">{{ $t('filters').types.values[0] }}</option>
                      </option>
                      <option value="1">{{ $t('filters').types.values[1] }}</option>
                      </option>
                      <option value="0_1">{{ $t('filters').types.values[2] }}</option>
                      </option>
                  </select>

              </fieldset>

              

              <fieldset v-if="prop_sexes_single==1" class="container_sexes_1">

                  <h4>{{ $t('filters').sexes }}</h4>

                  <select v-model="values.sexes" :placeholder="$t('filters').sexes.label" @change="update">
                      <option value="1">{{ $t('filters').sex.title[0] }}</option>
                      </option>
                      <option value="2">{{ $t('filters').sex.title[1] }}</option>
                      </option>
                  </select>
                  
              </fieldset>

              <fieldset v-if="prop_sexes_multiple==1" class="container_sexes_1">

                  <h4>{{ $t('filters').sexes }}</h4>

                  <select v-model="values.sexes" :placeholder="$t('filters').sexes.label" @change="update">
                      <option value="1">{{ $t('filters').sex.title[0] }}</option>
                      </option>
                      <option value="2">{{ $t('filters').sex.title[1] }}</option>
                      </option>
                      <option value="1_2">{{ $t('filters').sex.title[2] }}</option>
                      </option>
                  </select>
                  
              </fieldset>

              <fieldset v-if="prop_sexes_single==2" class="container_sexes_2">

                  <h4>{{ $t('filters').sexes }}</h4>

                  <select v-model="values.sexes" :placeholder="$t('filters').sexes.label" @change="update">
                      <option value="0">{{ $t('filters').sexes_both.label2 }}</option>
                      </option>
                      <option value="1">{{ $t('filters').sex.title[0] }}</option>
                      </option>
                      <option value="2">{{ $t('filters').sex.title[1] }}</option>
                      </option>
                  </select>
                  
              </fieldset>

              <fieldset v-if="prop_sexes_single==3" class="container_sexes_3">

                  <h4>{{ $t('filters').sexes }}</h4>

                  <select v-model="values.sexes" :placeholder="$t('filters').sexes.label" @change="update">
                      <option value="1_2">{{ $t('filters').sexes_both.label1 }}</option>
                      </option>
                      <option value="0">{{ $t('filters').sexes_both.label2 }}</option>
                      </option>
                  </select>
                  
              </fieldset>
              
              <fieldset class="container_populations" v-if="prop_populations>=1">
                   <h4>
                      {{ $t('filters').populations}}
                  </h4>

                  <input type="checkbox" class="group_populations mobile_input" v-model="values.group_populations" value="1" id="group_populations" name="group_populations" :disabled="values.group_populations_disabled"  v-on:change="updatePopulationGroupButton" v-if="website_is_static==false">

                  <select v-model="values.populations[0]" :placeholder="$t('filters').populations" @change="updateMobilePopulation" v-if="values.multiple_populations==0">
                      <optgroup v-for="grp in dictionnary.populations_list_grouped" :label="grp.key">
                          <option v-for="pop in grp.values" :value="pop.country">
                          {{ pop.label }}
                          </option>
                      </optgroup>
                  </select>

                  <select v-model="values.populations" :placeholder="$t('filters').populations" @change="updateMobilePopulation" v-if="values.multiple_populations==1" multiple="multiple">
                      <optgroup v-for="grp in dictionnary.populations_list_grouped" :label="grp.key">
                          <option v-for="pop in grp.values" :value="pop.country">
                          {{ pop.label }}
                          </option>
                      </optgroup>
                  </select>

              </fieldset>

              <fieldset class="container_cancers" v-if="prop_cancers>=1">
                   <h4>
                      {{ $t('filters').cancer_site }}
                  </h4>

                  <input type="checkbox" class="group_cancers mobile_input" v-model="values.group_cancers" id="group_cancers" name="group_cancers" :disabled="values.group_cancers_disabled"  v-on:change="updateCancerGroupButton" v-if="website_is_static==false">

                  <select v-model="values.cancers[0]" :placeholder="$t('filters').cancers" @change="updateMobileCancer" v-if="values.multiple_cancers==0">
                      <option v-for="cancer in dictionnary.cancers_list" :value="cancer.id">
                      {{ cancer.label }}
                      </option>
                  </select>

                  <select v-model="values.cancers" :placeholder="$t('filters').cancers" @change="updateMobileCancer" multiple="multiple" v-if="values.multiple_cancers==1">
                      <option v-for="cancer in dictionnary.cancers_list" :value="cancer.id">
                      {{ cancer.label }}
                      </option>
                  </select>

              </fieldset>

              <fieldset class="container_age_group" v-if="prop_age_groups==1">

                  <h4>Age groups</h4>

                  <select class="age_start" v-model="values.age_start" @change="updateAgeMobile('age_start')">
                      <option v-for="age in values.options_ages_start" :value="age.value" 
                     >{{ age.label }}</option>
                  </select>

                  <select class="age_end" v-model="values.age_end" :disabled="website_is_static" @change="updateAgeMobile('age_end')">
                      <option v-for="age in values.options_ages_end" :value="age.value" 
                    >{{ age.label }}</option>
                  </select>

              </fieldset>

              <fieldset class="container_bar_mode" v-if="prop_bar_mode==1">
                  <h4>{{ $t('filters').bar_mode.label }}</h4>

                  <select class="bar_mode" v-model="values.bar_mode" @change="updateBarMode()">
                      <option value="grouped">{{ $t('filters').bar_mode.titles[0] }}</option>
                      <option value="stacked">{{ $t('filters').bar_mode.titles[1] }}</option>
                  </select>
                  
              </fieldset>

              <fieldset class="container_years" v-if="prop_select_years==1">

                  <h4 class="title_years_1">{{ $t('filters.years.label') }}</h4>

                  <select id="multiselect-years-single-mobile" v-if="prop_multiple_years_select==0" v-model="values.years[0]" @change="updateYearUniqueMobile">
                      <option v-for="year in dictionnary.years_list" :value="year.value">
                          {{ year[values.multiselect_years_label] }}
                      </option>
                  </select>

              </fieldset>

              <fieldset>
                  <a class="btn_clear btn_clear_mobile" v-on:click="clearAllValues">
                      Reset
                  </a>
              </fieldset>

          </form>

      </div>

      <div id="container-filters">

          <select v-if="data_version_list !='' && show_db_switcher == true" placeholder="Change DB Version" id="version_switcher" v-model="data_version_tmp" v-on:change="changeVersionForce">
              <option value="92">9.2</option>
              <option value="91">9.1</option>
              <!-- <option value="90">9.0</option> -->
              <!--<option value="82">8.2</option>-->
          </select>

          <b-tabs content-class="" v-model="tabIndex">
              
              <div :class="'filters tab_content block view_mode_'+values.mode.value+' view_types_'+values.types+' view_sexes_'+values.sexes">
                  
                  <form name="">
                  
                      <b-tab title="Display">

                      <ul id="re-rendering" style="font-size:0.8em;">
                          <li style="text-align: left;" v-for="comp in dynamic_components" :key="comp.id">
                              {{ comp.name }} - [{{comp.time}}] ({{ comp.config.hide }})
                          </li>
                      </ul>
                      
                      

                          <fieldset v-if="prop_mode==1" class="container_mode">
                              <h4>{{ $t('filters').mode }}</h4>
                              <multiselect v-model="values.mode" placeholder="" :options="values.options_mode" track-by='value' label='label' :searchable="true" :show-labels="false" :allowEmpty="false" @input="updateModeSelection">
                              </multiselect>

                          </fieldset>

                          <fieldset v-if="prop_cohort==1" class="container_cohort">

                              <h4>Rates by</h4>

                              <div class="row radios_toggle radios_toggle_item2">

                                  <input  type="radio" name="cohort" value="cohort" v-model="values.cohort" v-on:change="update" id="cohort_0">
                                  <label for="cohort_0"> Cohort </label>

                                  <input type="radio" name="cohort" value="period" v-model="values.cohort" v-on:change="update" id="cohort_1">
                                  <label for="cohort_1"> Period </label>

                              </div>
                                  
                          </fieldset>

                          <fieldset v-if="prop_cohort==2">

                              <h4>{{ $t('filters.cohort.label') }}</h4>

                              <div class="row radios_toggle">

                                  <input  type="radio" name="cohort" value="0" v-model="values.cohort_rate" v-on:change="manageCohort" id="cohort_rate_0">
                                  <label for="cohort_rate_0"> Age </label>

                                  <input  type="radio" name="cohort" value="1" v-model="values.cohort_rate" v-on:change="manageCohort" id="cohort_rate_1">
                                  <label for="cohort_rate_1"> Period </label>

                                  <input type="radio" name="cohort" value="2" v-model="values.cohort_rate" v-on:change="manageCohort" id="cohort_rate_2">
                                  <label for="cohort_rate_2"> Cohort </label>

                              </div>
                                  
                          </fieldset>

                          <fieldset v-if="prop_cohort_type==1">

                              <h4>Versus</h4>

                              <div class="row radios_toggle radios_toggle_item2">

                                  <input  type="radio" name="time" value="time" v-model="values.cohort_type" v-on:change="update" id="cohort_type_0">
                                  <label for="cohort_type_0"> Time </label>

                                  <input type="radio" name="age" value="age" v-model="values.cohort_type" v-on:change="update" id="cohort_type_1">
                                  <label for="cohort_type_1"> Age </label>

                              </div>
                                  
                          </fieldset>

                          <fieldset v-if="prop_cohort_type==2">

                              <h4>{{ $t('filters.cohort_by.label') }}</h4>

                              <div class="row radios_toggle">

                                  <input type="radio" name="age" value="0" v-model="values.cohort_by" v-on:change="manageCohort" id="cohort_by_0" :disabled="values.cohort_by_states[0]">
                                  <label for="cohort_by_0"> Age </label>

                                  <input  type="radio" name="time" value="1" v-model="values.cohort_by" v-on:change="manageCohort" id="cohort_by_1" :disabled="values.cohort_by_states[1]">
                                  <label for="cohort_by_1"> Period </label>

                                  <input  type="radio" name="time" value="2" v-model="values.cohort_by" v-on:change="manageCohort" id="cohort_by_2" :disabled="values.cohort_by_states[2]">
                                  <label for="cohort_by_2"> Cohort </label>

                              </div>
                                  
                          </fieldset>

                          <fieldset v-if="prop_indicator==1" class="container_indicator">
                              <h4>{{ $t('filters').indicators }}</h4>

                               <multiselect v-model="values.indicator_select" track-by="key" label="label" placeholder="" :options="values.options_indicator" :searchable="true" :show-labels="false" :allowEmpty="false" @input="updateIndicatorSelection">
                              </multiselect>

                          </fieldset>

                          <fieldset v-if="prop_types_multiple==1" class="container_types">
                              <h4 v-if="prop_hide_labels.types==false">{{ $t('filters').types.label }}</h4>
                              
                              <div class="row radios_toggle">
                                  <input type="radio" name="type" value="0" v-model="values.types" v-on:change="update" id="input_inc">
                                  <label for="input_inc" v-b-tooltip.hover :title="$t('filters').types.values[0]"> {{ $t('filters').types.values[0] }} </label>

                                  <input type="radio" name="type" value="1" v-model="values.types" v-on:change="update" id="input_mort">
                                  <label for="input_mort" v-b-tooltip.hover :title="$t('filters').types.values[1]"> {{ $t('filters').types.values[1] }} </label>

                                  <input type="radio" name="type" value="0_1" v-model="values.types" v-on:change="update" id="input_inc_mort">
                                  <label for="input_inc_mort" v-b-tooltip.hover :title="$t('filters').types.title[2]"> {{ $t('filters').types.values[2] }} </label>

                              </div>

                          </fieldset>

                          <fieldset v-if="prop_types_single==1" class="container_types_single_1">
                              <h4 v-if="prop_hide_labels.types==false">{{ $t('filters').types.label }}</h4>
                              
                              <div class="row radios_toggle radios_toggle_item2">
                                  <input type="radio" name="type" value="0" v-model="values.types" v-on:change="update" id="input_inc">
                                  <label for="input_inc"> {{ $t('filters').types.values[0] }} </label>

                                  <input type="radio" name="type" value="1" v-model="values.types" v-on:change="update" id="input_mort">
                                  <label for="input_mort"> {{ $t('filters').types.values[1] }} </label>

                              </div>

                          </fieldset>

                          <fieldset v-if="prop_types_single==2">
                              <h4 v-if="prop_hide_labels.types==false">{{ $t('filters').types.label }}</h4>
                              
                              <div class="row radios_toggle">
                                  <input type="radio" name="type" value="0" v-model="values.types" v-on:change="update" id="input_inc">
                                  <label for="input_inc"> {{ $t('filters').types.values[0] }} </label>

                                  <input type="radio" name="type" value="1" v-model="values.types" v-on:change="update" id="input_mort">
                                  <label for="input_mort"> {{ $t('filters').types.values[1] }} </label>

                                  <input type="radio" name="type" value="2" v-model="values.types" v-on:change="update" id="input_prev">
                                  <label for="input_prev"> Prevalence </label>
                                  
                              </div>

                          </fieldset>
                          
                          <fieldset  v-if="prop_survival==1"  class="container_survival">
                              <h4>{{ $t('filters').survival }}</h4>
                              
                              <div class="row radios_toggle radios_toggle_item5">


                                  <input type="radio" name="survival" value="0" v-model="values.survival" v-on:change="update" id="surv_total">
                                  <label for="surv_total"> Total </label>

                                  <input type="radio" name="survival" value="1" v-model="values.survival" v-on:change="update" id="surv_one">
                                  <label for="surv_one"> 1 year </label>

                                  <input type="radio" name="survival" value="3" v-model="values.survival" v-on:change="update" id="surv_three">
                                  <label for="surv_three"> 3 years </label>

                                  <input type="radio" name="survival" value="5" v-model="values.survival" v-on:change="update" id="surv_five">
                                  <label for="surv_five"> 5 years</label>

                                  <input type="radio" name="survival" value="10" v-model="values.survival" v-on:change="update" id="surv_ten">
                                  <label for="surv_ten"> 10 years</label>

                              </div>

                          </fieldset>

                          <fieldset class="container_sexes_0" v-if="prop_sexes_multiple==1">
                              <h4 v-if="prop_hide_labels.sexes==false">{{ $t('filters').sexes }}</h4>
                              
                              <div class="row radios_toggle">
                                  <input type="radio" name="sex" value="1" v-model="values.sexes" v-on:change="update" id="input_males" :disabled="values.disabled_males">
                                  <label for="input_males"> {{ $t('filters').sex.title[0] }} </label>

                                  <input type="radio" name="sex" value="2" v-model="values.sexes" v-on:change="update" id="input_females" :disabled="values.disabled_females">
                                  <label for="input_females"> {{ $t('filters').sex.title[1] }} </label>

                                  <input type="radio" name="sex" value="1_2" v-model="values.sexes" v-on:change="update" id="input_males_females" :disabled="values.disabled_both">
                                  <label for="input_males_females"> {{ $t('filters').sex.title[2] }} </label>

                              </div>

                          </fieldset>

                          <fieldset class="container_sexes_1" v-if="prop_sexes_single==1" >
                              <h4 v-if="prop_hide_labels.sexes==false">{{ $t('filters').sexes }}</h4>
                              
                              <div class="row radios_toggle radios_toggle_item2">
                                  <input type="radio" name="sex" value="1" v-model="values.sexes" v-on:change="update" id="input_males">
                                  <label for="input_males"> Males </label>

                                  <input type="radio" name="sex" value="2" v-model="values.sexes" v-on:change="update" id="input_females">
                                  <label for="input_females"> Females </label>

                              </div>

                          </fieldset>

                          <fieldset class="container_sexes_2" v-if="prop_sexes_single==2" >
                              <h4 v-if="prop_hide_labels.sexes==false">{{ $t('filters').sexes }}</h4>
                              
                              <div class="row radios_toggle">

                                  <input type="radio" name="sex" value="0" v-model="values.sexes" v-on:change="update" id="input_both">
                                  <label for="input_both" :disabled="values.disabled_both"> Both sexes </label>

                                  <input type="radio" name="sex" value="1" v-model="values.sexes" v-on:change="update" id="input_males" :disabled="values.disabled_males">
                                  <label for="input_males" v-b-tooltip.hover :title="$t('filters.sex.tooltip.males')"> Males </label>

                                  <input type="radio" name="sex" value="2" v-model="values.sexes" v-on:change="update" id="input_females" :disabled="values.disabled_females">
                                  <label for="input_females"  v-b-tooltip.hover :title="$t('filters.sex.tooltip.females')"> Females </label>

                              </div>

                          </fieldset>

                          <fieldset class="container_sexes_3" v-if="prop_sexes_single==3" >
                              <h4 v-if="prop_hide_labels.sexes==false">{{ $t('filters').sexes }}</h4>
                              
                              <div class="row radios_toggle radios_toggle_item2">

                                  <input type="radio" name="sex" value=1_2 v-model="values.sexes" v-on:change="update" id="input_by_sex">
                                  <label for="input_by_sex"> {{ $t('filters').sexes_both.label1 }} </label>

                                  <input type="radio" name="sex" value="0" v-model="values.sexes" v-on:change="update" id="input_both">
                                  <label for="input_both"> {{ $t('filters').sexes_both.label2 }} </label>

                              </div>

                          </fieldset>

                          <fieldset class="container_sexes_4" v-if="prop_sexes_multiple==4">
                              <h4 v-if="prop_hide_labels.sexes==false">{{ $t('filters').sexes }}</h4>
                              
                              <div class="row radios_toggle radios_toggle_item4bis">
                                  <input type="radio" name="sex" value="1" v-model="values.sexes" v-on:change="update" id="input_males">
                                  <label for="input_males"> {{ $t('filters').sex.title[0] }} </label>

                                  <input type="radio" name="sex" value="2" v-model="values.sexes" v-on:change="update" id="input_females">
                                  <label for="input_females"> {{ $t('filters').sex.title[1] }} </label>

                                  <input type="radio" name="sex" value="1_2" v-model="values.sexes" v-on:change="update" id="input_males_females">
                                  <label for="input_males_females"> {{ $t('filters').sex.title[2] }} </label>

                                  <input type="radio" name="sex" value="0" v-model="values.sexes" v-on:change="update" id="input_both_sexes">
                                  <label for="input_both_sexes" v-b-tooltip.hover :title="$t('filters.sexes_both.label2')">{{ $t('filters.sexes_both.label2') }}</label>

                              </div>

                          </fieldset>

                          <fieldset class="container_bar_mode" v-if="prop_bar_mode==1">
                              <h4>{{ $t('filters').bar_mode.label }}</h4>
                              
                              <div class="row radios_toggle radios_toggle_item2">
                                  <input type="radio" name="bar_mode" value="grouped" v-model="values.bar_mode" v-on:change="updateBarMode" id="input_bar_grouped">
                                  <label for="input_bar_grouped"> {{ $t('filters').bar_mode.titles[0] }} </label>

                                  <input type="radio" name="bar_mode" value="stacked" v-model="values.bar_mode" v-on:change="updateBarMode" id="input_bar_stacked">
                                  <label for="input_bar_stacked"> {{ $t('filters').bar_mode.titles[1] }} </label>
                              </div>

                          </fieldset>

                          <fieldset class="container_bar_mode" v-if="prop_map_view_per_all==1">
                              <h4>{{ $t('filters').view_per }}</h4>
                              
                              <div class="row radios_toggle">

                                  <input  type="radio" name="map_view_per" value="all" v-model="values.map_view_per" v-on:change="changeViewMap" id="input_view_all">
                                  <label for="input_view_all"> All </label>

                                  <input type="radio" name="map_view_per" value="regions" v-model="values.map_view_per" v-on:change="changeViewMap" id="input_view_regions">
                                  <label for="input_view_regions"> Regions </label>

                                  <input type="radio" name="map_view_per" value="countries" v-model="values.map_view_per" v-on:change="changeViewMap" id="input_view_countries">
                                  <label for="input_view_countries"> Countries </label>
                              </div>

                          </fieldset>

                          <fieldset  v-if="prop_map_view_per_single==1">
                              <h4>{{ $t('filters').view_per }}</h4>
                              
                              <div class="row radios_toggle radios_toggle_item2">

                                  <input type="radio" name="map_view_per" value="regions" v-model="values.map_view_per" v-on:change="changeViewMap" id="input_view_regions">
                                  <label for="input_view_regions"> Regions </label>

                                  <input type="radio" name="map_view_per" value="countries" v-model="values.map_view_per" v-on:change="changeViewMap" id="input_view_countries">
                                  <label for="input_view_countries"> Countries </label>
                              </div>

                          </fieldset>

                          <fieldset class="container_cancers" v-if="prop_cancers==1">
                              <h4>{{ $t('filters').cancer_site}} {{ values.nb_cancer_selected }}</h4>

                              <label class="group_cancers" v-b-tooltip.hover :title="values.group_cancers_title" v-if="prop_cancers_group_button==1">
                                  <div class="pretty p-switch"><!--p-icon p-round p-jelly">-->
                                      <input type="checkbox" class="group_cancers" v-model="values.group_cancers" id="group_cancers" name="group_cancers" :disabled="values.group_cancers_disabled"  v-on:change="updateCancerGroupButton" v-if="website_is_static==false">
                                      <input type="checkbox" class="group_cancers" v-model="values.group_cancers" id="group_cancers" name="group_cancers" disabled="true"  v-on:change="updateCancerGroupButton" v-if="website_is_static==true">
                                      <div class="state p-primary-o">
                                          <!--<i class="icon fa fa-check-circle"></i>-->
                                          <label for="group_cancers"> <span>Grouped</span></label>
                                      </div>
                                  </div>
                              </label>

                              <multiselect id="multiselect-cancer" v-model="values.cancer_select" track-by="cancer" label="label" placeholder="" :close-on-select="values.cancer_select_close_on_select" :hideSelected="true" :options="dictionnary.cancers_list" :multiple="values.multiple_cancers==1" :allowEmpty="false" :searchable="true" :show-labels="false" @input="updateCancerSelection">
                                  <template slot="tag" slot-scope="props">
                                      <span :class="'multiselect__tag '+props.option.class">
                                          <span>{{ props.option.label }} </span>
                                          <i aria-hidden="true" tabindex="1" class="multiselect__tag-icon" @click="props.remove(props.option)"></i>
                                      </span>
                                  </template>
                             
                              </multiselect>

                           </fieldset>

                          <fieldset class="container_population_groups" v-if="prop_populations_groups==1">
                              <h4>{{ $t('filters').population_groups }}</h4>

                              <multiselect v-model="values.population_groups" track-by="label" label="label" placeholder="" :hideSelected="false" :options="dictionnary.predefined_populations" :allowEmpty="false" :searchable="true" :show-labels="false" @input="updatePopulationGroups" placeholder="Pick a predefined region">
                              </multiselect>
                          </fieldset>

                          <fieldset class="container_populations" v-if="prop_populations>=1">
                              <h4>
                                  {{ $t('filters').populations}} {{ values.nb_population_selected }}
                                  <a href="javascript:void(0)" v-on:click="resetPopulations" v-b-tooltip.hover title="Reset populations selection" class="emptyPopButton"><i class="far fa-trash-alt"></i></a>
                              </h4>

                              <label class="group_populations" v-b-tooltip.hover :title="values.group_populations_title" v-if="prop_populations_group_button==1">
                                  <!--<div class="pretty p-icon p-round p-jelly">-->
                                  <div class="pretty p-switch">    
                                      <input type="checkbox" class="group_populations" v-model="values.group_populations" value="1" id="group_populations" name="group_populations" :disabled="values.group_populations_disabled"  v-on:change="updatePopulationGroupButton" v-if="website_is_static==false">
                                      <input type="checkbox" class="group_populations group_button_disabled" v-model="values.group_populations" value="1" id="group_populations" name="group_populations" disabled="true"  v-on:change="updatePopulationGroupButton" v-if="website_is_static==true">
                                      <div class="state">
                                          <!--<i class="icon fa fa-check-circle"></i>-->
                                          <label for="group_populations"> <span>Grouped</span> </label>
                                      </div>
                                  </div>
                              </label>


                              <multiselect class="nested" v-if="prop_populations==1" v-model="values.population_select" track-by="country" label="label" placeholder="" :hideSelected="false" :options="dictionnary.populations_list_grouped" :close-on-select="values.population_select_close_on_select" :multiple="values.multiple_populations==1" :allowEmpty="true" group-values="values" group-label="key" :group-select="false" :searchable="true" :show-labels="false" @tag="removePopulationSelection" @input="updatePopulationSelection" placeholder="Choose population(s)">
                              </multiselect>

                              <multiselect v-if="prop_populations==2" v-model="values.population_select" track-by="country" label="label" placeholder="" :hideSelected="true" :options="dictionnary.populations_list" :multiple="values.multiple_populations==1" :close-on-select="values.population_select_close_on_select" :allowEmpty="false" :searchable="true" :show-labels="false" @input="updatePopulationSelection">
                              </multiselect>

                          </fieldset>

                           <fieldset class="container_registry_group" v-if="prop_registry_group==1" >
                              <h4>{{ 'Regional registry grouping' }}</h4>
                              
                              <div class="row radios_toggle">
                                  <input type="radio" name="registry_group" value="1" v-model="values.registry_group" v-on:change="update" id="input_max_count">
                                  <label for="input_max_count"> {{ 'Max pop' }} </label>

                                  <input type="radio" name="registry_group" value="2" v-model="values.registry_group" v-on:change="update" id="input_max_width">
                                  <label for="input_max_width"> {{'Max nb of reg'}} </label>

                                  <input type="radio" name="registry_group" value="3" v-model="values.registry_group" v-on:change="update" id="input_max_span">
                                  <label for="input_max_span"> {{'Max nb of years'}} </label>

                              </div>

                          </fieldset>

                          <fieldset class="container_age_group"v-if="prop_age_groups==1">

                              <h4>Age groups
                                  <a v-if="suffix.age_groups!=null" href="javascript:void(0)" v-on:click="resetPopulations" v-b-tooltip.hover :title="suffix.age_groups" class="container_fieldset_icon"><i class="fa fa-info-circle" v-if="suffix.age_groups!=null"></i></a>
                              </h4>

                              <multiselect class="age_start" v-model="values.age_select[0]" track-by="value" label="label" :options="values.options_ages_start" 
                                  :searchable="false" :show-labels="false" :allowEmpty="false" :disabled="website_is_static || values.slider_ages_dot_options[0].disabled==true"
                                  placeholder="" @input="updateAgeStart">
                              </multiselect>

                               <multiselect class="age_end" v-model="values.age_select[1]" track-by="value" label="label" :options="values.options_ages_end" 
                                  :searchable="false" :show-labels="false" :allowEmpty="false"
                                  placeholder="" @input="updateAgeEnd" :disabled="website_is_static">
                              </multiselect>

                              <vue-slider ref="slider_ages" v-model="values.ages" :min="0" :max="values.slider_ages_max" :dot-options="values.slider_ages_dot_options" :interval="1" :min-range="prop_age_min_range" :height="10" :enable-cross="false" :adsorb="true" :tooltip-merge="true"
                              :tooltip-formatter="formatter_age" :useKeyboard="true" v-on:change="updateSliderAge" :lazy="true" :disabled="website_is_static">
                                  
                                  <template v-slot:dot="{ value, focus }">
                                      <div :class="['custom-dot', { focus }]"></div>
                                  </template>
                              
                              </vue-slider>

                          </fieldset>

                           <fieldset v-if="prop_age_span==1">

                              <h4>Age interval</h4>


                              <multiselect v-model="values.age_span" track-by="value" label="label" :options="values.options_age_span" 
                                  :searchable="false" :show-labels="false" :allowEmpty="false"
                                  placeholder="" @input="updateAgeSpan">
                              </multiselect>



                           </fieldset>

                          

                          <!--<fieldset class="container_apc" v-if="prop_apc==1">

                              <h4>Annual percentage change</h4>

                              <label class="apc_male">
                                  APC Male
                              </label>

                              <label class="apc_female">
                                  APC Female
                              </label>

                              <multiselect class="apc_male" v-model="values.apc_male" track-by="value" label="label" :options="values.options_apc" :disabled="values.apc_male_disabled"
                                  :searchable="false" :show-labels="false" :allowEmpty="false"
                                  placeholder="APC Male" @input="updateApcMale">
                              </multiselect>

                              <multiselect class="apc_female" v-model="values.apc_female" track-by="value" label="label" :options="values.options_apc" :disabled="values.apc_female_disabled"
                                  :searchable="false" :show-labels="false" :allowEmpty="false"
                                  placeholder="APC Female" @input="updateApcFemale">
                              </multiselect>

                          </fieldset>-->

                          <fieldset class="container_years" v-if="prop_years_range==1">
                              <h4>Years</h4>

                              <multiselect class="range_year_unique" v-if="prop_multiple_years_range==0" track-by="value" label="value" v-model="values.years_select" :options="dictionnary.years_list" :searchable="false" :show-labels="false" :allowEmpty="false"
                                  placeholder="" @input="updateYearUnique">
                              </multiselect>

                              <multiselect class="range_year_start" v-if="prop_multiple_years_range==1" track-by="value" label="value" v-model="values.years_select[0]" :options="dictionnary.years_start" :searchable="false" :show-labels="false" :allowEmpty="false"
                                  placeholder="" @input="updateYearStart">
                              </multiselect>

                              <multiselect class="range_year_end" v-if="prop_multiple_years_range==1" track-by="value" label="value" v-model="values.years_select[1]" :options="dictionnary.years_end" :searchable="false" :show-labels="false" :allowEmpty="false"
                                  placeholder="" @input="updateYearEnd">
                              </multiselect>

                              <vue-slider ref="slider_years" v-if="prop_multiple_years_range==1" v-model="values.years" :height="10" :min="values.years_available[0]" :max="values.years_available[1]" :interval="1" :enable-cross="false" :min-range="prop_init_values.min_range"  :adsorb="true" :tooltip-merge="true" :useKeyboard="true" v-on:change="updateSliderYear" :lazy="true">
                                  <template v-slot:dot="{ value, focus }">
                                      <div :class="['custom-dot', { focus }]"></div>
                                  </template>
                              </vue-slider>

                          </fieldset>

                          <fieldset class="container_years" v-if="prop_select_years==1">

                              <h4 class="title_years_1" v-if="$t('filters.years.label')!=''">{{ $t('filters.years.label') }}</h4>

                              <h4 class="title_years_2" v-else>{{ prop_init_values.years_label }}</h4>

                              <label class="group_years" v-if="prop_years_group_button==1">
                                  <div class="pretty p-icon p-round p-jelly">
                                      <input type="checkbox" class="group_years" v-model="values.group_years" value="1" id="group_years" name="group_years" v-on:change="updateYearGroupButton">
                                      <div class="state p-primary-o">
                                          <i class="icon fa fa-check-circle"></i>
                                          <label for="group_years">Period</label>
                                      </div>
                                  </div>
                              </label>

                              <multiselect id="multiselect-years-single" v-if="prop_multiple_years_select==0" track-by="value" :label="values.multiselect_years_label" v-model="values.years_select" :options="dictionnary.years_list" :searchable="true" :show-labels="false" :allowEmpty="false"
                                  placeholder="" @input="updateYearUnique">
                              </multiselect>


                              <multiselect id="multiselect-years-multiple-start" class="select_year_start" v-if="prop_multiple_years_select==1" track-by="value" :label="values.multiselect_years_label" v-model="values.years_select[0]" :options="dictionnary.years_start" :searchable="true" :show-labels="false" :allowEmpty="false"
                                  placeholder="" @input="updateYearStart">
                              </multiselect>

                              <multiselect id="multiselect-years-multiple-end" class="select_year_end" v-if="prop_multiple_years_select==1" track-by="value" :label="values.multiselect_years_label" v-model="values.years_select[1]" :options="dictionnary.years_end" :searchable="true" :show-labels="false" :allowEmpty="false"
                                  placeholder="" @input="updateYearEnd">
                              </multiselect>


                          </fieldset>

                          <fieldset class="container_multiple_years" v-if="prop_select_years_multiple==1">

                              <h4>{{ $t('filters').years_pop.label }}</h4>

                              <multiselect id="multiselect-years-multiple" track-by="value" label="value" v-model="values.years_select_multiple" :multiple="true" :options="dictionnary.years_list" :searchable="true" :show-labels="false" :allowEmpty="false"
                                  placeholder="" @input="updateYearMultiple">
                              </multiselect>

                          </fieldset>

                          <fieldset class="container_years" v-if="prop_select_year_prediction==1">
                              <h4>{{ $t('filters').year_prediction.label }}</h4>

                              <multiselect id="multiselect-years-single" v-if="prop_multiple_years_select==0" track-by="value" label="value" v-model="values.year_prediction" :multiple="values.single_select_multiple" :options="dictionnary.years_list_prediction" :searchable="true" :show-labels="false" :allowEmpty="false"
                                  placeholder="" @input="updateYearPrediction">
                              </multiselect>


                          </fieldset>

                          <fieldset class="container_age_surv fadeIn" v-if="prop_age_surv==1">

                              <h4>Age groups</h4>

                              <multiselect class="age_surv" v-model="values.age_surv" track-by="value" label="label" :options="values.options_age_surv" 
                                  :searchable="false" :show-labels="false" :allowEmpty="false" 
                                  placeholder="" @input="update">
                              </multiselect>


                          </fieldset>

                          <fieldset  v-if="prop_survival==2">
                              <h4>{{ $t('filters').survival }}</h4>
                              
                              <div class="row radios_toggle">

                                  <input type="radio" name="survival" value="1" v-model="values.survival" v-on:change="update" id="surv_one">
                                  <label for="surv_one"> 1-year </label>

                                  <input type="radio" name="survival" value="5" v-model="values.survival" v-on:change="update" id="surv_five">
                                  <label for="surv_five"> 5-year</label>

                                  <input type="radio" name="survival" value="10" v-model="values.survival" v-on:change="update" id="surv_ten" :disabled="values.survival_10_disabled">
                                  <label for="surv_ten" v-b-tooltip.hover :title="$t('filters.survival_warning')"> 10-year</label>
   
                              </div>

                          </fieldset>

                          <fieldset class="container_surv_period fadeIn" v-if="prop_surv_period==1">

                              <h4>Period of diagnosis span</h4>

                              <multiselect class="surv_period" v-model="values.surv_period" track-by="value" label="label" :options="values.options_surv_period" 
                                  :searchable="false" :show-labels="false" :allowEmpty="false" 
                                  placeholder="" @input="update">
                              </multiselect>

                          </fieldset>

                          <fieldset class="container_items" v-if="prop_eapc_span==1">
                              <h4>{{ $t('filters').eapc_span }}</h4>

                              <div class="row radios_toggle radios_toggle_item5">
                                  <input type="radio" name="eapc_span" value="5" v-model="values.eapc_span" v-on:change="update" id="eapc_span_1">
                                  <label for="eapc_span_1"> 5 </label>
                                  <input type="radio" name="eapc_span" value="10" v-model="values.eapc_span" v-on:change="update" id="eapc_span_2">
                                  <label for="eapc_span_2"> 10 </label>
                                  <input type="radio" name="eapc_span" value="15" v-model="values.eapc_span" v-on:change="update" id="eapc_span_3">
                                  <label for="eapc_span_3"> 15 </label>
                                  <input type="radio" name="eapc_span" value="20" v-model="values.eapc_span" v-on:change="update" id="eapc_span_4">
                                  <label for="eapc_span_4"> 20 </label>
                                  <input type="radio" name="eapc_span" value="-1" v-model="values.eapc_span" v-on:change="update" id="eapc_span_5">
                                  <label for="eapc_span_5"> All </label>
                              </div>

                          </fieldset>

                          <fieldset v-if="prop_uncertainty_limits==1" class="container_uncertainty_limits">
                              <div class="col-md-12">
                                  <h4>{{ $t('filters').uncertainty_limits.label }}</h4>
                                  <div class="pretty p-switch">
                                      <input type="checkbox" v-model="values.ul" id="uncertainty_limits" name="uncertainty_limits" v-on:change="updateUncertaintyLimits">
                                      <div class="state">
                                          <label for="uncertainty_limits"></label>
                                      </div>
                                      
                                  </div>
                              </div>

                          </fieldset>

                          <fieldset class="container_periods" v-if="prop_select_period==1">
                              <h4> {{ $t('filters.period') }}</h4>
                              <multiselect class="select_period" v-if="prop_select_period_start==0" track-by="value" label="label" v-model="values.period" :options="dictionnary.periods" :searchable="true" :show-labels="false" :allowEmpty="false"
                                  placeholder="" @input="updatePeriod">
                              </multiselect>

                              <multiselect class="select_period_start" v-if="prop_select_period_start==1" track-by="value" label="label" v-model="values.period_start" :options="dictionnary.periods_start" :searchable="true" :show-labels="false" :allowEmpty="false"
                                  placeholder="" @input="updatePeriod">
                              </multiselect>

                              <multiselect class="select_period_end" v-if="prop_select_period_start==1" track-by="value" label="label" v-model="values.period" :options="dictionnary.periods" :searchable="true" :show-labels="false" :allowEmpty="false"
                                  placeholder="" @input="updatePeriod">
                              </multiselect>


                          </fieldset>


                          <fieldset class="container_selection"  v-if="prop_top_nb==1">
                              <h4>{{ $t('filters').top_nb }}</h4>

                              <label class="group_selection" v-b-tooltip.hover :title="(!this.values.top_add)?'Add to current selection':'Replace current selection'">
                                  <div class="pretty p-switch"><!--p-icon p-round p-jelly">-->
                                      <input type="checkbox" class="group_selection" v-model="values.top_add" id="top_add" name="top_add">
                                      <div class="state p-primary-o">
                                          <!--<i class="icon fa fa-check-circle"></i>-->
                                          <label for="top_add">Replace selection</label>
                                      </div>
                                  </div>
                              </label>

                              <multiselect v-model="values.top_nb" track-by="value" label="label" :options="values.top_options" :allowEmpty="false" :searchable="true" :show-labels="false" placeholder="" @input="updateTopNb">
                              </multiselect>

                          </fieldset>

                          <!-- start dynamic component in tab 1 -->
                          <component 
                              :is="comp.config.component" 
                              :key="comp.id"
                              v-for="comp in dynamic_components" 
                              v-if="comp.config.tab==1&&comp.config.hide!=true" 
                              v-bind:prop_name="comp.name"
                              v-bind:prop_time="comp.time"
                              v-bind:prop_config="comp.config"
                              v-bind:filter_values="values"
                              @callUpdateComponent="updateDynamicComponent"
                              />

                          <div class="container_warning" v-if="website_is_static==true">
                              <i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>Warning</strong> : due to a maintenance mode, some features are temporarily disabled. For more informations, please read <a href="http://gco.iarc.fr/news-item-gco-website" target="_blank">http://gco.iarc.fr/news-item-gco-website</a>
                          </div>

                          <a class="btn_clear" v-on:click="clearAllValues" v-b-tooltip.hover title="Reset all to default values">
                              {{ $t('filters').init_values }}
                          </a>

                      </b-tab>

                      <b-tab :title="$t('filters').scaling.label" v-if="props_hide_tab_advanced!=1">
                          
                          <!-- start dynamic component in tab 1 -->
                          <component 
                              :key="comp.id"
                              v-for="comp in dynamic_components" 
                              v-if="comp.config.tab==2&&comp.config.hide!=true" 
                              :is="comp.config.component" 
                              v-bind:prop_name="comp.name"
                              v-bind:prop_config="comp.config"
                              v-bind:filter_values="values"
                              @callUpdateComponent="updateDynamicComponent"
                              />

                          <fieldset v-if="prop_scale==1">

                              <h4>{{ $t('filters').scale.label }}</h4>

                              <div class="row radios_toggle radios_toggle_item2">
                                  <input type="radio" name="scale" value="linear" v-model="values.scale" v-on:change="updateScale" id="input_scale_1">
                                  <label for="input_scale_1"> {{ $t('filters').scale.values[0] }} </label>

                                  <input type="radio" name="scale" value="log" v-model="values.scale" v-on:change="updateScale" id="input_scale_2">
                                  <label for="input_scale_2"> {{ $t('filters').scale.values[1] }} </label>

                              </div>
                              
                          </fieldset> 

                          <fieldset v-bind:class="{'container_smoothing':true ,'container_smoothing_opened':values.toggle_smoothing==1}" v-if="prop_smoothing==1 && ( props_merge_tab==1 || values.merge_tab == 1 )">
                              <h4>
                                  <div class="pretty p-switch" style="padding-right:3px;">
                                      <input type="checkbox" name="enable_smoothing" value="1" v-model="values.toggle_smoothing" id="toggle_smoothing" v-on:change="toggleSmoothing">
                                      <div class="state">
                                          <label for="toggle_smoothing"></label>
                                      </div>
                                      
                                  </div> &nbsp;

                                  Smoothing  <a href="javascript:void(0);" v-b-tooltip.hover title="The proportion of points in the plot which influence the smooth at each value. Larger values give more smoothness."><i class="fas fa-info-circle"></i></a></h4>

                              <label class="show_dots" v-if="values.smoothing > 0 || values.toggle_smoothing == 1">
                                  <div class="pretty p-icon p-round p-jelly">
                                      <input type="checkbox" class="show_dots" v-model="values.show_dots" value="1" id="show_dots" name="show_dots" v-on:change="showDots">
                                      <div class="state p-primary-o">
                                          <i class="icon fa fa-check-circle"></i>
                                          <label for="show_dots"> Show observed values</label>
                                      </div>
                                  </div>
                              </label>

                              <div v-if="values.toggle_smoothing==1" >
                                  <vue-slider ref="slider_smoothing" v-model="values.smoothing" :marks="values.marks" :included="true" :piecewise="true" :process-dragable="true" :piecewise-label="true" :tooltip-formatter="formatSmoothing" :enable-cross="false" v-on:change="update" :lazy="true"></vue-slider>
                              </div>

                          </fieldset>

                          <fieldset v-if="prop_map_scale==1">

                              <h4>Map scale</h4>

                              <multiselect v-model="values.map_scale" placeholder="" :options="values.options_map_scale" track-by='value' label='label' :searchable="true" :show-labels="false" :allowEmpty="false" @input="updateMapScale">
                              </multiselect>
                          
                          </fieldset> 

                          <fieldset class="container_bin" v-if="prop_map_nb_color==1">
                              <h4>Number of bins: {{ values.map_nb_color }} </h4>

                              <div class="row radios_toggle radios_toggle_item6">
                                  <input type="radio" name="map_nb_color" value="3" v-model="values.map_nb_color" v-on:change="updateNbColors" id="map_nb_color_3">
                                  <label for="map_nb_color_3"> 3 </label>
                                  <input type="radio" name="map_nb_color" value="4" v-model="values.map_nb_color" v-on:change="updateNbColors" id="map_nb_color_4">
                                  <label for="map_nb_color_4"> 4 </label>
                                  <input type="radio" name="map_nb_color" value="5" v-model="values.map_nb_color" v-on:change="updateNbColors" id="map_nb_color_5">
                                  <label for="map_nb_color_5"> 5 </label>
                                  <input type="radio" name="map_nb_color" value="6" v-model="values.map_nb_color" v-on:change="updateNbColors" id="map_nb_color_6">
                                  <label for="map_nb_color_6"> 6 </label>
                                  <input type="radio" name="map_nb_color" value="7" v-model="values.map_nb_color" v-on:change="updateNbColors" id="map_nb_color_7">
                                  <label for="map_nb_color_7"> 7 </label>
                                  <input type="radio" name="map_nb_color" value="8" v-model="values.map_nb_color" v-on:change="updateNbColors" id="map_nb_color_8">
                                  <label for="map_nb_color_8"> 8 </label>
                              </div>

                          </fieldset>

                          <fieldset class="container_items" v-if="prop_nb_items==1">
                              <h4>{{ $t('filters').number_of_items }}</h4>

                              <div class="row radios_toggle radios_toggle_item5">
                                  <input type="radio" name="nb_items" value="5" v-model="values.nb_items" v-on:change="update" id="nb_items_1">
                                  <label for="nb_items_1"> 5 </label>
                                  <input type="radio" name="nb_items" value="10" v-model="values.nb_items" v-on:change="update" id="nb_items_2">
                                  <label for="nb_items_2"> 10 </label>
                                  <input type="radio" name="nb_items" value="15" v-model="values.nb_items" v-on:change="update" id="nb_items_3">
                                  <label for="nb_items_3"> 15 </label>
                                  <input type="radio" name="nb_items" value="20" v-model="values.nb_items" v-on:change="update" id="nb_items_4">
                                  <label for="nb_items_4"> 20 </label>
                                  <input type="radio" name="nb_items" value="-1" v-model="values.nb_items" v-on:change="update" id="nb_items_5">
                                  <label for="nb_items_5"> All </label>
                              </div>

                          </fieldset>

                          <fieldset class="container_items" v-if="prop_single_unit==1">
                              <h4>{{ $t('filters').single_unit.label }}</h4>

                              <div class="row radios_toggle radios_toggle_item4">
                                  <div class="cell" v-for="(single,i) in values.single_unit_list">
                                      <input type="radio" name="single_unit" :value="single.value" v-model="values.single_unit" v-on:change="update" :id="'nb_single_unit_'+i">
                                      <label :for="'nb_single_unit_'+i"> {{ single.label }} </label>
                                  </div>

                                  <!--<input type="radio" name="single_unit" value="50000" v-model="values.single_unit" v-on:change="update" id="nb_single_unit_1">
                                  <label for="nb_single_unit_1"> 50000 </label>
                                  <input type="radio" name="single_unit" value="10000" v-model="values.single_unit" v-on:change="update" id="nb_single_unit_2">
                                  <label for="nb_single_unit_2"> 10000 </label>
                                  <input type="radio" name="single_unit" value="5000" v-model="values.single_unit" v-on:change="update" id="nb_single_unit_3">
                                  <label for="nb_single_unit_3"> 5000 </label>-->
                              </div>
                          </fieldset>


                           <fieldset v-if="prop_lock_scale==1">

                              <h4>Lock scale</h4>

                              <div class="row">

                                  <div class="col-md-12">
                                      <div class="pretty p-switch">
                                          <input type="checkbox" value="1" v-model="values.lock_scale" id="lock_scale" name="lock_scale" v-on:change="updateLockScale">
                                          <div class="state">
                                              <label for="lock_scale"></label>
                                          </div>
                                          
                                      </div>
                                  </div>

                              </div>

                          </fieldset>

                          <fieldset v-if="prop_round_numbers==1">

                              <h4>{{ $t('filters').round_numbers.label }}</h4>

                              <div class="row">

                                  <div class="col-md-3">
                                      <div class="pretty p-switch">
                                          <input type="checkbox" value="1" v-model="values.round_numbers" id="round_numbers" name="round_numbers" v-on:change="updateRoundNumbers">
                                          <div class="state">
                                              <label for="round_numbers"></label>
                                          </div>
                                      </div>
                                  </div>
                                  <div class="col-md-9">
                                      <p class="desc">
                                          <i class="fas fa-info-circle"></i>&nbsp; {{ $t('filters').round_numbers.desc }}
                                      </p>
                                  </div>

                              </div>

                          </fieldset>


                          <fieldset v-if="prop_set_scale==1" class="container_set_scale">
                              <h4>{{ $t('filters').set_scale.label }}</h4>
                              <div class="row">

                                  <div class="col-md-6">

                                      <div class="pretty p-icon p-round p-plain p-smooth">
                                          <input type="checkbox" v-model="values.set_scale" value="0" id="set_scale" name="set_scale" v-on:change="EnableSetScale">
                                          <div class="state p-primary-o">
                                              <i class="icon fa fa-lock"></i>
                                              <label for="set_scale">{{ $t('filters').lock_scale }}</label>
                                          </div>
                                      </div>
                                  </div>

                                  <div class="col-md-6">
                                      <div class="pretty p-switch">
                                          <input type="checkbox" value="1" v-model="values.min_zero" id="min_zero" name="min_zero" :disabled="values.disabled_min_zero_prop" v-on:change="updateAxisY">
                                          <div class="state">
                                              <label for="min_zero"> {{ $t('filters').lock_min_zero }} </label>
                                          </div>
                                          
                                      </div>
                                  </div>

                              </div>

                              <div class="row">

                                  <div class="col-md-6 mt-2">

                                      <label>{{ $t('filters').set_scale.min }}</label>
                                      <input class="input_set_scale" type="text" v-b-tooltip.focus="'Min. value can\'t be negative'" v-model="values.y_min" placeholder="" v-on:change="updateAxisY" :disabled="values.disabled_set_y_min">
                                  </div>

                                  <div class="col-md-6 mt-2">

                                      <label>{{ $t('filters').set_scale.max }}</label>
                                      <input class="input_set_scale" type="text" v-model="values.y_max" placeholder="" v-on:change="updateAxisY" :disabled="values.disabled_set_y_max">
                                          
                                  </div>

                              </div>

                          </fieldset>

                          <fieldset v-if="prop_lock_x_scale==1" class="container_set_scale">
                              <h4>{{ $t('filters').lock_x_scale.label }}</h4>
                              <div class="row">
                                  <div class="col-md">

                                      <div class="pretty p-icon p-round p-plain p-smooth">
                                          <input type="checkbox" v-model="values.lock_x_scale" value="0" id="lock_x_scale" name="lock_x_scale" v-on:change="updateXscale">
                                          <div class="state p-primary-o">
                                              <i class="icon fa fa-lock"></i>
                                              <label for="lock_x_scale">{{ $t('filters').lock_scale }}</label>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </fieldset>




                          <fieldset v-if="prop_pop_indicator==1" class="container_indicator">
                              <h4>{{ $t('filters').pop_indicator.label }}</h4>

                              <div class="row radios_toggle radios_toggle_item2">
                                  <input type="radio" name="pop_indicator" value="num" v-model="values.pop_indicator" v-on:change="update" id="pop_indicator_1">
                                  <label for="pop_indicator_1"> {{ $t('filters').pop_indicator.values[0] }} </label>
                                  <input type="radio" name="pop_indicator" value="percent" v-model="values.pop_indicator" v-on:change="update" id="pop_indicator_2">
                                  <label for="pop_indicator_2"> {{ $t('filters').pop_indicator.values[1] }} </label>
                              </div>

                          </fieldset>

                          <fieldset v-if="prop_shape==1">

                              <h4>{{ $t('filters').square.label }}</h4>

                              <div class="row radios_toggle radios_toggle_item2">
                                  <input type="radio" name="square" value="0" v-model="values.square" v-on:change="updateShape" id="input_square_1">
                                  <label for="input_square_1"> {{ $t('filters').square.values[0] }} </label>

                                  <input type="radio" name="square" value="1" v-model="values.square" v-on:change="updateShape" id="input_square_2">
                                  <label for="input_square_2"> {{ $t('filters').square.values[1] }} </label>
                              </div>

                          </fieldset>


                          <!-- Duplicated template specific to fusionned tabs --> 
                          <div v-if="props_merge_tab==1 || values.merge_tab==1">
                              <fieldset  v-if="prop_sort_by==1">
                                  <h4>{{ $t('filters').sort_by.label }}</h4>
                                  
                                  <select name="sort_by" class="sort" ref="select" v-model="values.sort_by" v-on:change="update">
                                      <option v-for="sorting in values.sortings" v-bind:key="sorting.value" :value="sorting.value" :disabled="sorting.disabled">{{ sorting.label }}</option>
                                  </select>

                                  <label for="sort-asc" class="sort_icon">
                                      <input type="radio" name="sort" id="sort-asc" v-model="values.sort_dir" value="desc" v-on:change="update">
                                      <i class="fas fa-sort-amount-up"></i>
                                  </label>

                                  <label for="sort-desc" class="sort_icon">
                                      <input type="radio" name="sort" id="sort-desc" v-model="values.sort_dir" value="asc" v-on:change="update">
                                      <i class="fas fa-sort-amount-up fa-down"></i>
                                  </label>


                              </fieldset>

                              <fieldset v-if="prop_symbols==1" class="container_symbols">

                                  <h4>{{ $t('filters').symbols.label }}</h4>

                                  <div class="row radios_toggle">
                                      <div class="item_symbol" v-for="(symbol,key) in $t('filters').symbols.values" v-bind:key="key">
                                          <input type="radio" name="symbol" :value="symbol" v-model="values.symbol" v-on:change="updateSymbol" :id="'input_values_position_'+key">
                                          <label :for="'input_values_position_'+key">
                                              <img :src="getSymbolUrl(symbol)">
                                          </label>
                                      </div>

                                  </div>

                              </fieldset>

                              <fieldset v-if="prop_dual_position==1">

                                  <h4>{{ $t('filters').dual_position.label }}</h4>

                                  <div class="row radios_toggle radios_toggle_item2">
                                      <input type="radio" name="dual_position" value="0" v-model="values.dual_position" v-on:change="update" id="input_dual_position_1">
                                      <label for="input_dual_position_1"> {{ $t('filters').dual_position.values[0] }} </label>

                                      <input type="radio" name="dual_position" value="1" v-model="values.dual_position" v-on:change="update" id="input_dual_position_2">
                                      <label for="input_dual_position_2"> {{ $t('filters').dual_position.values[1] }} </label>
                                  </div>

                              </fieldset>

                              <fieldset v-if="prop_color==1">

                                  <h4>{{ $t('filters').color.label }}</h4>

                                  <div class="row radios_toggle">
                                      <input type="radio" name="color" value="0" v-model="values.color" v-on:change="updateColor" id="input_color_0">
                                      <label for="input_color_0"> {{ $t('filters').color.values[0] }} </label>

                                      <input type="radio" name="color" value="1" v-model="values.color" v-on:change="updateColor" id="input_color_1">
                                      <label for="input_color_1"> {{ $t('filters').color.values[1] }} </label>

                                      <input type="radio" name="color" value="2" v-model="values.color" v-on:change="updateColor" id="input_color_2">
                                      <label for="input_color_2"> {{ $t('filters').color.values[2] }} </label>

                                      <input type="radio" name="color" value="3" v-model="values.color" v-on:change="updateColor" id="input_color_3">
                                      <label for="input_color_3"> {{ $t('filters').color.values[3] }} </label>

                                      <input type="radio" name="color" value="4" v-model="values.color" v-on:change="updateColor" id="input_color_4">
                                      <label for="input_color_4"> {{ $t('filters').color.values[4] }} </label>

                                      <input type="radio" name="color" value="5" v-model="values.color" v-on:change="updateColor" id="input_color_5">
                                      <label for="input_color_5"> {{ $t('filters').color.values[5] }} </label>
                                  </div>

                              </fieldset>

                              <fieldset v-if="prop_num_path==1">

                                  <h4>Line thickness</h4>

                                  <div class="row" id="lines_thickness">

                                      <div class="col-md-3">
                                          <input type="radio" class="num_path" v-model="values.num_path" value="1" id="num_path_1" name="num_path" v-on:change="setStroke">
                                          <label for="num_path_1"> 1 </label>
                                          <svg height="20" width="46" class="first">
                                              <line x1="3" y1="10" x2="40" y2="10" style="stroke:#000000;stroke-width:1;" ></line>
                                          </svg>
                                      </div>

                                      <div class="col-md-3">
                                          <input type="radio" class="num_path" v-model="values.num_path" value="2" id="num_path_2" name="num_path" v-on:change="setStroke">
                                          <label for="num_path_2"> 2 </label>
                                          <svg height="20" width="46">
                                              <line x1="3" y1="10" x2="40" y2="10" style="stroke:#000000;stroke-width:2px;" ></line>
                                          </svg>
                                      </div>

                                      <div class="col-md-3">
                                          <input type="radio" class="num_path" v-model="values.num_path" value="3" id="num_path_3" name="num_path" v-on:change="setStroke">
                                          <label for="num_path_3"> 3 </label>
                                          <svg height="20" width="46">
                                              <line x1="3" y1="10" x2="40" y2="10" style="stroke:#000000;stroke-width:3px;" ></line>
                                          </svg>
                                      </div>

                                      <div class="col-md-3">
                                          <input type="radio" class="num_path" v-model="values.num_path" value="4" id="num_path_4" name="num_path" v-on:change="setStroke">
                                          <label for="num_path_4"> 4 </label>
                                          <svg height="20" width="46">
                                              <line x1="3" y1="10" x2="40" y2="10" style="stroke:#000000;stroke-width:5px;" ></line>
                                          </svg>
                                      </div>

                                  </div>

                              </fieldset>

                             <fieldset v-if="prop_show_area==1" class="container_show_area">

                                  <h4>Show areas</h4>

                                  <div class="col-md-12">
                                      <div class="pretty p-switch">
                                          <input type="checkbox" v-model="values.show_area" id="show_area" name="uncertainty_limits" v-on:change="updateShowArea">
                                          <div class="state">
                                              <label for="show_area"></label>
                                          </div>
                                          
                                      </div>
                                  </div>

                              </fieldset>

                              

                              <fieldset class="container_color_palette" v-if="prop_color_palette==1">
                                  <h4>{{ $t('filters').colour_palette.label }}</h4>

                                  <select name="palette" ref="select" v-model="values.palette" v-on:change="changeColor">
                                      <optgroup v-for="group in dictionnary.chromatic" v-bind:key="group.key" :label="group.key">
                                          <option v-for="color in group.values" v-bind:key="color.name" :value="color.name">
                                              {{ color.name }}
                                          </option>
                                      </optgroup>
                                  </select>

                              </fieldset>

                              <fieldset class="container_label_position" v-if="prop_label_position==1">
                                  <h4>{{ $t('filters').label_position.label }}</h4>
                                  
                                  <div class="row radios_toggle">
                                      <input type="radio" name="label_position" value="left" v-model="values.label_position" v-on:change="updateLabelPosition" id="input_label_position_1">
                                      <label for="input_label_position_1"> {{ $t('filters').label_position.values[0] }} </label>

                                      <input type="radio" name="label_position" value="middle" v-model="values.label_position" v-on:change="updateLabelPosition" id="input_label_position_2">
                                      <label for="input_label_position_2"> {{ $t('filters').label_position.values[1] }} </label>

                                      <input type="radio" name="label_position" value="right" v-model="values.label_position" v-on:change="updateLabelPosition" id="input_label_position_3">
                                      <label for="input_label_position_3"> {{ $t('filters').label_position.values[2] }} </label>
                                  </div>

                              </fieldset>

                              <fieldset class="container_values_position" v-if="prop_values_position==1">
                                  <h4>{{ $t('filters').values_position.label }}</h4>
                                  
                                  <div class="row radios_toggle">
                                      <input type="radio" name="values_position" value="0" v-model="values.values_position" v-on:change="updateValuesPosition" id="input_values_position_1">
                                      <label for="input_values_position_1"> {{ $t('filters').values_position.values[0] }} </label>

                                      <input type="radio" name="values_position" value="in" v-model="values.values_position" v-on:change="updateValuesPosition" id="input_values_position_2">
                                      <label for="input_values_position_2"> {{ $t('filters').values_position.values[1] }} </label>

                                      <input type="radio" name="values_position" value="out" v-model="values.values_position" v-on:change="updateValuesPosition" id="input_values_position_3"">
                                      <label for="input_values_position_3" v-if="$t('filters').values_position.values[2]!=''"> {{ $t('filters').values_position.values[2] }} </label>
                                  </div>

                              </fieldset>

                          </div>

                      </b-tab>

                      <b-tab :title="($t('filters').tabs.tab3.label!=undefined)?$t('filters').tabs.tab3.label:'Look'" v-if="props_hide_tab_look!=1 && values.hide_tab_look != 1">
                          
                          <div v-if="props_merge_tab==0">


                              <!-- start dynamic component in tab 3 -->
                              <component 
                                  :key="comp.id"
                                  v-for="comp in dynamic_components" 
                                  v-if="comp.config.tab==3&&comp.config.hide!=true" 
                                  :is="comp.config.component" 
                                  v-bind:prop_name="comp.name"
                                  v-bind:prop_config="comp.config"
                                  v-bind:filter_values="values"
                                  @callUpdateComponent="updateDynamicComponent"
                                  />

                              <fieldset  v-if="prop_sort_by==1" class="container_sort">
                                  <h4>{{ $t('filters').sort_by.label }}</h4>
                                  
                                  <select name="sort_by" class="sort" ref="select" v-model="values.sort_by" v-on:change="update">
                                      <option v-for="sorting in values.sortings" v-bind:key="sorting.value" :value="sorting.value" :disabled="sorting.disabled">{{ sorting.label }}</option>
                                  </select>

                                  <label for="sort-asc" class="sort_icon">
                                      <input type="radio" name="sort" id="sort-asc" v-model="values.sort_dir" value="desc" v-on:change="update">
                                      <i class="fas fa-sort-amount-up"></i>
                                  </label>

                                  <label for="sort-desc" class="sort_icon">
                                      <input type="radio" name="sort" id="sort-desc" v-model="values.sort_dir" value="asc" v-on:change="update">
                                      <i class="fas fa-sort-amount-up fa-down"></i>
                                  </label>


                              </fieldset>

                              <fieldset v-if="prop_symbols==1" class="container_symbols">

                                  <h4>{{ $t('filters').symbols.label }}</h4>

                                  <div class="row radios_toggle">
                                      <div class="item_symbol" v-for="(symbol,key) in $t('filters').symbols.values" v-bind:key="key">
                                          <input type="radio" name="symbol" :value="symbol" v-model="values.symbol" v-on:change="updateSymbol" :id="'input_values_position_'+key">
                                          <label :for="'input_values_position_'+key">
                                              <img :src="getSymbolUrl(symbol)">
                                          </label>
                                      </div>

                                  </div>

                              </fieldset>

                              

                              <fieldset v-if="prop_dual_position==1">

                                  <h4>{{ $t('filters').dual_position.label }}</h4>

                                  <div class="row radios_toggle radios_toggle_item2">
                                      <input type="radio" name="dual_position" value="0" v-model="values.dual_position" v-on:change="update" id="input_dual_position_1">
                                      <label for="input_dual_position_1"> {{ $t('filters').dual_position.values[0] }} </label>

                                      <input type="radio" name="dual_position" value="1" v-model="values.dual_position" v-on:change="update" id="input_dual_position_2">
                                      <label for="input_dual_position_2"> {{ $t('filters').dual_position.values[1] }} </label>
                                  </div>

                              </fieldset>

                              <fieldset v-if="prop_color==1">

                                  <h4>{{ $t('filters').color.label }}</h4>

                                  <div class="row radios_toggle">
                                      <input type="radio" name="color" value="0" v-model="values.color" v-on:change="updateColor" id="input_color_0">
                                      <label for="input_color_0"> {{ $t('filters').color.values[0] }} </label>

                                      <input type="radio" name="color" value="1" v-model="values.color" v-on:change="updateColor" id="input_color_1">
                                      <label for="input_color_1"> {{ $t('filters').color.values[1] }} </label>

                                      <input type="radio" name="color" value="2" v-model="values.color" v-on:change="updateColor" id="input_color_2">
                                      <label for="input_color_2"> {{ $t('filters').color.values[2] }} </label>

                                      <input type="radio" name="color" value="3" v-model="values.color" v-on:change="updateColor" id="input_color_3">
                                      <label for="input_color_3"> {{ $t('filters').color.values[3] }} </label>

                                      <input type="radio" name="color" value="4" v-model="values.color" v-on:change="updateColor" id="input_color_4">
                                      <label for="input_color_4"> {{ $t('filters').color.values[4] }} </label>

                                      <input type="radio" name="color" value="5" v-model="values.color" v-on:change="updateColor" id="input_color_5">
                                      <label for="input_color_5"> {{ $t('filters').color.values[5] }} </label>
                                  </div>

                              </fieldset>

                              <fieldset v-if="prop_num_path==1">

                                  <h4>Line thickness</h4>

                                  <div class="row" id="lines_thickness">

                                      <div class="col-md-3">
                                          <input type="radio" class="num_path" v-model="values.num_path" value="1" id="num_path_1" name="num_path" v-on:change="setStroke">
                                          <label for="num_path_1"> 1 </label>
                                          <svg height="20" width="46" class="first">
                                              <line x1="3" y1="10" x2="40" y2="10" style="stroke:#000000;stroke-width:1;" ></line>
                                          </svg>
                                      </div>

                                      <div class="col-md-3">
                                          <input type="radio" class="num_path" v-model="values.num_path" value="2" id="num_path_2" name="num_path" v-on:change="setStroke">
                                          <label for="num_path_2"> 2 </label>
                                          <svg height="20" width="46">
                                              <line x1="3" y1="10" x2="40" y2="10" style="stroke:#000000;stroke-width:2px;" ></line>
                                          </svg>
                                      </div>

                                      <div class="col-md-3">
                                          <input type="radio" class="num_path" v-model="values.num_path" value="3" id="num_path_3" name="num_path" v-on:change="setStroke">
                                          <label for="num_path_3"> 3 </label>
                                          <svg height="20" width="46">
                                              <line x1="3" y1="10" x2="40" y2="10" style="stroke:#000000;stroke-width:3px;" ></line>
                                          </svg>
                                      </div>

                                      <div class="col-md-3">
                                          <input type="radio" class="num_path" v-model="values.num_path" value="4" id="num_path_4" name="num_path" v-on:change="setStroke">
                                          <label for="num_path_4"> 4 </label>
                                          <svg height="20" width="46">
                                              <line x1="3" y1="10" x2="40" y2="10" style="stroke:#000000;stroke-width:5px;" ></line>
                                          </svg>
                                      </div>

                                  </div>

                              </fieldset>

                             <fieldset v-if="prop_show_area==1" class="container_show_area">

                                  <h4>Show areas</h4>

                                  <div class="col-md-12">
                                      <div class="pretty p-switch">
                                          <input type="checkbox" v-model="values.show_area" id="show_area" name="uncertainty_limits" v-on:change="updateShowArea">
                                          <div class="state">
                                              <label for="show_area"></label>
                                          </div>
                                          
                                      </div>
                                  </div>

                              </fieldset>

                              <fieldset class="container_smoothing" v-if="prop_smoothing==1">
                                  <h4>Smoothing  <a href="javascript:void(0);" v-b-tooltip.hover title="The proportion of points in the plot which influence the smooth at each value. Larger values give more smoothness."><i class="fas fa-info-circle"></i></a></h4>

                                  <label class="show_dots" v-if="values.smoothing > 0">
                                      <div class="pretty p-icon p-round p-jelly">
                                          <input type="checkbox" class="show_dots" v-model="values.show_dots" value="1" id="show_dots" name="show_dots" v-on:change="showDots">
                                          <div class="state p-primary-o">
                                              <i class="icon fa fa-check-circle"></i>
                                              <label for="show_dots"> Show observed values</label>
                                          </div>
                                      </div>
                                  </label>

                                  <vue-slider ref="slider_smoothing" v-model="values.smoothing" :marks="values.marks" :included="true" :piecewise="true" :process-dragable="true" :piecewise-label="true" :tooltip-formatter="formatSmoothing" :enable-cross="false" v-on:change="update" :lazy="true"></vue-slider>

                              </fieldset>

                              <!-- simple slider used for pie corder radius -->
                              <fieldset class="container_slider" v-if="prop_slider==1">
                                  <h4>{{ values.slider.label }} </h4>

                                  <vue-slider ref="slider" v-model="values.slider.value" :marks="values.slider.marks" :included="false" :piecewise="true" :process-dragable="true" :piecewise-label="true" :tooltip-formatter="formatTooltipSlider" :enable-cross="false" v-on:change="updateSlider(values.slider.key)" :lazy="true"></vue-slider>
                              </fieldset>

                              <!-- simple slider used for pie inner radius (doughnnut or not) -->
                              <fieldset class="container_radius" v-if="prop_radius==1">
                                  <h4>{{ values.radius.label }} </h4>

                                  <vue-slider ref="radius" v-model="values.radius.value" :marks="values.radius.marks" :included="true" :piecewise="true" :process-dragable="true" :piecewise-label="true" :tooltip-formatter="formatTooltipSlider" :enable-cross="false" v-on:change="updateSlider(values.radius.key)" :lazy="true"></vue-slider>
                              </fieldset>

                              <fieldset class="container_color_palette" v-if="prop_color_palette==1">
                                  <h4>{{ $t('filters').colour_palette.label }}</h4>

                                  <select name="palette" ref="select" v-model="values.palette" v-on:change="changeColor">
                                      <optgroup v-for="group in dictionnary.chromatic" v-bind:key="group.key" :label="group.key">
                                          <option v-for="color in group.values" v-bind:key="color.name" :value="color.name">
                                              {{ color.name }}
                                          </option>
                                      </optgroup>
                                  </select>

                              </fieldset>

                              <fieldset class="container_color_palette" v-if="prop_color_palette==2">
                                  <h4>{{ $t('filters').colour_palette.label }}</h4>

                                  <div class="group_color_palette" v-for="group in dictionnary.chromatic" v-bind:key="group.key" :label="group.key">
                                      <h5> {{ group.key }}</h5>
                                      <label :for="'color-'+color.name" v-for="color in group.values" v-bind:key="color.name" class="label_color_palette">
                                          <input type="radio" :id="'color-'+color.name" name="name-color-palette" :value="color.name" v-model="values.palette" v-on:click="changeColor">
                                          <img :src="'./img/d3-chromatic/'+color.name+'.png'">
                                      </label>
                                  </div>                                            
                              </fieldset>

                              <fieldset class="container_label_position" v-if="prop_label_position==1">
                                  <h4>{{ $t('filters').label_position.label }}</h4>
                                  
                                  <div class="row radios_toggle">
                                      <input type="radio" name="label_position" value="left" v-model="values.label_position" v-on:change="updateLabelPosition" id="input_label_position_1">
                                      <label for="input_label_position_1"> {{ $t('filters').label_position.values[0] }} </label>

                                      <input type="radio" name="label_position" value="middle" v-model="values.label_position" v-on:change="updateLabelPosition" id="input_label_position_2">
                                      <label for="input_label_position_2"> {{ $t('filters').label_position.values[1] }} </label>

                                      <input type="radio" name="label_position" value="right" v-model="values.label_position" v-on:change="updateLabelPosition" id="input_label_position_3">
                                      <label for="input_label_position_3"> {{ $t('filters').label_position.values[2] }} </label>
                                  </div>

                              </fieldset>

                              <fieldset class="container_values_position" v-if="prop_values_position==1">
                                  <h4>{{ $t('filters').values_position.label }}</h4>
                                  
                                  <div class="row radios_toggle">
                                      <input type="radio" name="values_position" value="0" v-model="values.values_position" v-on:change="updateValuesPosition" id="input_values_position_1">
                                      <label for="input_values_position_1"> {{ $t('filters').values_position.values[0] }} </label>

                                      <input type="radio" name="values_position" value="in" v-model="values.values_position" v-on:change="updateValuesPosition" id="input_values_position_2">
                                      <label for="input_values_position_2"> {{ $t('filters').values_position.values[1] }} </label>

                                      <input type="radio" name="values_position" value="out" v-model="values.values_position" v-on:change="updateValuesPosition" id="input_values_position_3">
                                      <label for="input_values_position_3" v-if="$t('filters').values_position.values[2]!=''"> {{ $t('filters').values_position.values[2] }} </label>
                                  </div>

                              </fieldset>

                          </div>

                      </b-tab>

                      <b-tab :title="$t('filters').extra_tab.title" v-if="prop_show_extra_tab==1" :disabled="website_is_static">

                          <fieldset class="container_apcs">
                              <h4>
                                  % change (global)
                              </h4>

                              <div v-if="values.apc_custom0" class="row slider-main">
                                  <div class="col-md-12">
                                      <vue-slider ref="apc_slider" :min="-5" :max="5" v-model="values.apc" :tooltip="'active'" :interval="0.1" :marks="values.apc_marks" :dotSize="10" :process="false" :included="false"  v-on:change="updateApcs()" :lazy="true"></vue-slider>
                                  </div>
                              </div>


                              <h4 v-show="values.apc_split_bool.some(function(e){return e ==1})">
                                  % change (based on selection)
                                  <div class="pretty p-switch">
                                      <input type="checkbox" v-model="values.apc_custom1"  id="apc_custom1" name="apc_custom1" v-on:change="updateApcCustom(1)">
                                      <div class="state">
                                          <label for="apc_custom1"></label>
                                      </div>
                                  </div>

                              </h4>
                              
                              <div v-if="values.apc_custom1" class="container_apc_custom1">
                                  <div class="row radios_toggle radios_toggle_item4bis"  >

                                      <input type="radio" name="apc_split" value="3" v-model="values.apc_split" v-show="values.apc_split_bool[2]==1" v-on:change="updateApcCustom(1)" id="apc_split_3">
                                      <label for="apc_split_3" v-show="values.apc_split_bool[2]==1"> Pop </label>
                                      <input type="radio" name="apc_split" value="4" v-model="values.apc_split" v-show="values.apc_split_bool[3]==1" v-on:change="updateApcCustom(1)" id="apc_split_4">
                                      <label for="apc_split_4" v-show="values.apc_split_bool[3]==1"> Cancer </label>
                                      <input type="radio" name="apc_split" value="1" v-model="values.apc_split" v-show="values.apc_split_bool[0]==1" v-on:change="updateApcCustom(1)" id="apc_split_1">
                                      <label for="apc_split_1" v-show="values.apc_split_bool[0]==1"> Sex </label>
                                      <input type="radio" name="apc_split" value="2" v-model="values.apc_split" v-show="values.apc_split_bool[1]==1" v-on:change="updateApcCustom(1)" id="apc_split_2">
                                      <label for="apc_split_2" v-show="values.apc_split_bool[1]==1"> I/M </label>
                                      
                                      <!--<input type="radio" name="apc_split" value="5" v-model="values.apc_split" v-show="values.apc_split_bool.reduce((a,b) => a+b) > 1" v-on:change="updateApcCustom(1)" id="nb_items_5">
                                      <label for="nb_items_5" v-show="values.apc_split_bool.reduce((a,b) => a+b) > 1"> All </label>-->
   

                                  </div>  


                                  <div class="slider" v-for="apc in values.apcs_dataset" v-model="values.apcs_dataset" :id="apc.id"
                                   v-bind:key="apc.id">
                                      <label class="main" v-if="apc.show_ui==true" :style="'border-bottom-color:'+apc.color+';border-bottom-style:'+apc.border_style"> {{ apc.extra_label }} </label>

                                      <i class="fas fas-toggle fa-sliders-h" :style="'color:'+apc.color" v-if="apc.show_ui==true"></i>

                                      <div class="row slider-block">
                                          <div class="col-md-4">
                                              <label class="sub">{{ apc.sub_label }}</label>
                                          </div>
                                          <div class="col-md-12">
                                              <vue-slider :ref="apc.key_slider" :min="-5" :max="5" v-model="apc.value_slider" :tooltip="'active'" :interval="0.1" :marks="values.apc_marks" :dotSize="10" :process="false" :included="false" :lazy="true" v-on:change="updateApcs()" ></vue-slider>
                                          </div>
                                      </div>
                                  </div>

                              </div>

                              <h4>
                                  % change (user defined)
                                  <div class="pretty p-switch">
                                      <input type="checkbox" v-model="values.apc_custom2" id="apc_custom2" name="apc_custom2" v-on:change="updateApcCustom(2)">
                                      <div class="state">
                                          <label for="apc_custom2"></label>
                                      </div>
                                  </div>

                              </h4>

                              <div v-if="values.apc_custom2" class="specific_apc_rates container_apc_custom2">

                                  <div class="row" v-for="apc in values.apcs_textbox" v-model="values.apcs_textbox" :id="apc.id"
                                       v-bind:key="apc.id" >
                                      <div class="col-md-8">
                                          <label> {{ apc.label }} </label>
                                      </div>
                                      <div class="col-md-4">
                                          <input class="input_set_scale" :ref="apc.id" type="text"  v-model="apc.value"  placeholder="" v-on:change="updateApcs()">
                                      </div>
                                   </div>
                               </div>

                              <!--<h4>
                                  % change (based on combinaison selection)
                                  <div class="pretty p-switch">
                                      <input type="checkbox" v-model="values.apc_custom3" id="apc_custom3" name="apc_custom2" v-on:change="updateApcCustom(3)">
                                      <div class="state">
                                          <label for="apc_custom3"></label>
                                      </div>
                                  </div>

                              </h4>

                              <div v-if="values.apc_custom3" class="container_apc_custom3">
                                  <div class="row checkbox_toggle checkbox_toggle_item4bis">

                                      <input type="checkbox" name="apc_combination" value="3" v-model="values.apc_combination" v-show="values.apc_split_bool[2]==1" v-on:change="updateApcCustomCombination()" id="apc_comb_pop">
                                      <label for="apc_comb_pop" v-show="values.apc_split_bool[2]==1"> Pop </label>
                                      
                                      <input type="checkbox" name="apc_combination" value="4" v-model="values.apc_combination" v-show="values.apc_split_bool[3]==1" v-on:change="updateApcCustomCombination()" id="apc_comb_cancer">
                                      <label for="apc_comb_cancer" v-show="values.apc_split_bool[3]==1"> Cancer </label>
                                      
                                      <input type="checkbox" name="apc_combination" value="1" v-model="values.apc_combination" v-show="values.apc_split_bool[0]==1" v-on:change="updateApcCustomCombination()" id="apc_comb_sex">
                                      <label for="apc_comb_sex" v-show="values.apc_split_bool[0]==1"> Sex </label>
                                      
                                      <input type="checkbox" name="apc_combination" value="2" v-model="values.apc_combination" v-show="values.apc_split_bool[1]==1" v-on:change="updateApcCustomCombination()" id="apc_comb_im">
                                      <label for="apc_comb_im" v-show="values.apc_split_bool[1]==1"> I/M </label>
                                  
                                  </div>

                                  <div class="slider" v-for="apc in values.apcs_dataset" v-model="values.apcs_dataset" :id="apc.id"
                                   v-bind:key="apc.id">
                                      <label class="main" v-if="apc.show_ui==true" :style="'border-bottom-color:'+apc.color+';border-bottom-style:'+apc.border_style"> {{ apc.extra_label }} </label>

                                      <i class="fas fas-toggle fa-sliders-h" :style="'color:'+apc.color" v-if="apc.show_ui==true"></i>

                                      <div class="row slider-block">
                                          <div class="col-md-4">
                                              <label class="sub">{{ apc.sub_label }}</label>
                                          </div>
                                          <div class="col-md-12">
                                              <vue-slider :ref="apc.key_slider" :min="-5" :max="5" v-model="apc.value_slider" :interval="0.5" :marks="values.apc_marks" :dotSize="10" :process="false" :included="false" :lazy="true" v-on:change="updateApcs()"></vue-slider>
                                          </div>
                                      </div>
                                  </div>

                              </div>-->


                          </fieldset>

                      </b-tab>


                      <b-tab class="tab_pred" ref="tab_method" title="tab method" v-if="prop_show_predictions_tab==1" :disabled="website_is_static">
                          
                          <template #title>
                              <b-spinner type="grow" small></b-spinner>{{ $t('filters').method }} 
                          </template>

                          <fieldset class="container_prediction_model" v-if="prop_prediction_model==1">

                              <h4>{{ $t('filters').pred_method.label }}</h4>

                              <!--<div class="row">

                                  <div class="col-md-12">
                                      <div class="pretty p-switch">
                                          <input type="checkbox" value="1" v-model="values.pred_constant" id="pred_constant" name="pred_constant" v-on:change="updatePredMethod">
                                          <div class="state">
                                              <label for="pred_constant">Show prediction with constant rates</label>
                                          </div>
                                          
                                      </div>
                                  </div>
                              </div>-->

                              <div class="row radios_toggle radios_toggle_item2">
                                  <input type="radio" name="pred_method" value="nordpred" v-model="values.pred_method" v-on:change="updatePredMethod" id="input_method_1">
                                  <label for="input_method_1"> {{ $t('filters').pred_method.values[0] }} </label>

                                  <input type="radio" name="pred_method" value="constant" v-model="values.pred_method" v-on:change="updatePredMethod" id="input_method_2">
                                  <label for="input_method_2"> {{ $t('filters').pred_method.values[1] }} </label>
                              </div>

                          </fieldset>

                          <fieldset class="container_prediction_year_base" v-if="prop_prediction_model==1">

                              <h4>{{ $t('filters').pred_year_base.label }}</h4>


                              <multiselect class="year_base" track-by="value" label="value" v-model="values.year_base" :options="dictionnary.years_base_list" :searchable="false" :show-labels="false" :allowEmpty="false"
                          placeholder="" @input="updateYearBase">
                              </multiselect>

                          </fieldset>

                          <fieldset class="container_prediction_nb_period" v-if="prop_prediction_model==1 && values.pred_method=='nordpred'">
                              <h4>{{ $t('filters').pred_nb_period.label }}</h4>

                              <div class="row radios_toggle">


                                  <input type="radio" name="pred_nb_period" value="" v-model="values.pred_nb_period" v-on:change="updatePredNbPeriod" id="input_pred_nb_period_0">
                                  <label for="input_pred_nb_period_0" v-b-tooltip.hover title="Number of period used in the prediction base determine by goodness of fit evaluation">Default</label>

                                  <input type="radio" name="pred_nb_period" value="3" v-model="values.pred_nb_period" v-on:change="updatePredNbPeriod" id="input_pred_nb_period_1">
                                  <label for="input_pred_nb_period_1">3</label>

                                  <input type="radio" name="pred_nb_period" value="4" v-model="values.pred_nb_period" v-on:change="updatePredNbPeriod" id="input_pred_nb_period_2">
                                  <label for="input_pred_nb_period_2">4</label>

                                  <input type="radio" name="pred_nb_period" value="5" v-model="values.pred_nb_period" v-on:change="updatePredNbPeriod" id="input_pred_nb_period_3">
                                  <label for="input_pred_nb_period_3">5</label>
                              </div>

                          </fieldset>

                          <fieldset class="container_prediction_recent" v-if="prop_prediction_model==1">
                              <h4>{{ $t('filters').pred_recent.label }}</h4>
                              
                              <div class="row radios_toggle">
                                  <input type="radio" name="pred_recent" value="" v-model="values.pred_recent" v-on:change="updatePredRecent" id="pred_recent_1">
                                  <label for="pred_recent_1" v-b-tooltip.hover title="The choice is based on a significance test for departure from linear trend">Default</label>

                                  <input type="radio" name="pred_recent" value="0" v-model="values.pred_recent" v-on:change="updatePredRecent" id="pred_recent_2">
                                  <label for="pred_recent_2" v-b-tooltip.hover title="Average trend from the whole observation period is used">Average</label>

                                  <input type="radio" name="pred_recent" value="1" v-model="values.pred_recent" v-on:change="updatePredRecent" id="pred_recent_3">
                                  <label for="pred_recent_3" v-b-tooltip.hover title="The slope from the last 10 years is used">Slope</label>
                              </div>

                          </fieldset> 

                      </b-tab>

                  </form>

              </div><!-- end div class .filters -->

          </b-tabs>

      </div><!-- end div container filters -->

  </div>

</template>

<script>

import 'url-search-params-polyfill';
import axios from 'axios'
import md5 from 'md5'
import Constant from '@/const.js'
import VueSlider from 'vue-slider-component'
import Multiselect from 'vue-multiselect'
import 'vue-slider-component/theme/antd.css'
import Vue from 'vue'
import { TabsPlugin } from 'bootstrap-vue'
import { ToastPlugin } from 'bootstrap-vue'
import { VBTooltip } from 'bootstrap-vue'
import { BSpinner } from 'bootstrap-vue'
import DatavizFootnote from '@/csu-vue-components/components/DatavizFootnote'

// dynamic sub item
import FilterMultiselect from '@/csu-vue-components/components/filters/FilterMultiselect'
import FilterButtons from '@/csu-vue-components/components/filters/FilterButtons'
import FilterSwitch from '@/csu-vue-components/components/filters/FilterSwitch'
import FilterInput from '@/csu-vue-components/components/filters/FilterInput'

// by default, set Constant.check_availability to true if do not exist
Constant.check_availability = ( Constant.check_availability == undefined ) ? true : Constant.check_availability ;

// by default, set Constant.isPrediction to false if do not exist
Constant.isPrediction = ( Constant.isPrediction == undefined ) ? false : Constant.isPrediction ;

export default {
  name: 'dataviz_filters',
  props: {

      // speficic sub components 
      'prop_default_template' : '' , 

      // init
      'prop_mode' : Number, 
      'prop_indicator': Number ,
      'prop_sexes_multiple': Number ,
      'prop_sexes_single' : Number , 
      'prop_types_multiple' : Number ,
      'prop_types_single' : Number ,
      'prop_survival': Number , 
      'prop_cancers' : Number ,
      'prop_populations_groups' : Number , 
      'prop_populations' : Number, 
      'prop_age_groups' : Number, 
      'prop_age_span': Number, 
      'prop_age_surv' : Number, 
      'prop_surv_period' : Number, 
      'prop_age_min_range' : { type: Number, default: 0 },
      'prop_years_range' : Number ,
      'prop_select_years' : Number,
      'prop_select_years_multiple' : Number ,
      'prop_select_year_prediction' : Number,
      'prop_shape' : Number , 
      'prop_num_path' : Number , 
      'prop_set_scale' : Number,
      'prop_lock_x_scale' : Number,
      'prop_lock_scale' : Number , 
      'prop_smoothing' : Number ,
      'prop_map_scale' : Number , 
      'prop_map_nb_color' : Number , 
      'prop_nb_items' : Number , 
      'prop_single_unit' : Number , 
      'prop_apc' : Number , 
      'prop_scale' : Number , 
      'prop_eapc_span' : Number , 
      'prop_map_view_per_all' : Number , 
      'prop_map_view_per_single' : Number , 
      'prop_cohort' : Number , 
      'prop_cohort_type' : Number , 
      'prop_sort_by' : Number , 
      'prop_populations_group_button' : Number ,
      'prop_years_group_button' : Number ,
      'prop_cancers_group_button' : Number,
      'prop_multiple_years_select' : Number,
      'prop_multiple_years_range' : Number,
      'prop_label_position' : Number , 
      'prop_pop_indicator' : Number , 
      'prop_values_position' : Number , 
      'prop_dual_position' : Number , 
      'prop_color' : Number, 
      'prop_color_palette' : Number, 
      'prop_registry_group' : Number , 
      'prop_symbols' : Number , 
      'prop_uncertainty_limits' : Number ,
      'prop_select_period' : Number , 
      'prop_select_period_start' : Number , 
      'prop_top_nb' : Number , 
      'prop_bar_mode' : Number ,
      'prop_show_area' : Number ,
      'prop_prediction_model' : Number , 
      'prop_round_numbers' : Number , 
      'prop_is_prediction' : { type: Number, default: 0 },
      'prop_is_survival' : { type: Number, default: 0 },
      'prop_slider' : Number , 
      'prop_radius' : Number ,

      // tabs
      'props_hide_tab_advanced': Number , 
      'props_hide_tab_look' :  { 
          type : Number ,
          default : (Constant.dataviz_filters!= undefined)?Constant.dataviz_filters.hide_tab_look:0 ,
      } ,
      'prop_show_extra_tab' : Number , 
      'prop_show_predictions_tab' : Number,
      'prop_hide_labels' : {
          type : Object , 
          default(){
              return {
                  types : false , 
                  sexes : false
              }
          }
      } , 
      // default, tab 3, look exists
      // for nordcan
      'props_merge_tab' : { 
          type : Number ,
          default : (Constant.dataviz_filters!= undefined)?Constant.dataviz_filters.merge_tab3_to_tab2:0 ,
      },
      // global init values for conf
      'prop_init_values' : { // prop value need default to avoid vue warnings
          type: Object,
          default() {
              return {
              }
          }
      }
  },
  components: {
      VueSlider,
      Multiselect,
      BSpinner,
      DatavizFootnote , 
      FilterMultiselect , 
      FilterButtons , 
      FilterSwitch , 
      FilterInput
  },
  directives: {
      'b-tooltip': VBTooltip
  },
  data: function(){  

      return {
          website_is_static : ( process.env.VUE_APP_STATIC != undefined && process.env.VUE_APP_STATIC == 1 ) ? true : false ,
          url_api : process.env.VUE_APP_API , 
          show_db_switcher : process.env.VUE_APP_SHOW_DB_SWITCHER , 
          data_version_tmp : Constant.data_version , 
          data_version_list : Constant.data , 
          current_route : '' , 
          print : 0 , 
          format : 1 , 
          tabIndex : 0 , 
          // specific var to prevent from watch doing double update action
          filter_done : false , 
          formatter_age: function(v) 
          {    

              v = v*5; // default is first point

              let temp = this.$parent.$children;
              let mark_el = temp[temp.length-2];

              if ( mark_el != undefined)
              {
                  if (typeof mark_el.mark === 'undefined') // slider is completly loaded => second point is loaded
                  {
                      if (this._uid > mark_el._uid)   // 'this' is the last element of the slider => second point
                      {
                          if (v == 85) return '85+';
                          return v+4;
                      }
                  }
              }

              return v;
          },

          dynamic_components : [] ,

          suffix : {

          }, 

          values : {

              data_version : ( Constant.data_version != undefined ) ? Constant.data_version : undefined , 

              x_min : 0 , 
              x_max : 0 ,
              y_min : 0 , 
              y_max : 1000 ,
              selected_lines : [] , 
              age_select: [],

              // bool_intent
              bool_intent_age : 1,
              
              population_select: '',
              population_select_close_on_select : true , 
              population_groups: '',
              nb_population_selected : '(0)' , 

              cancer_select: '',
              indicator_select: '',
              square: 1,
              label_position: 'left',
              round_numbers : 0 , 
              round_numbers_significant_digits : 2 , 
              lock_x_scale : 0,
              cohort_type: 'time',
              cohort_rate : 0 ,
              cohort_by : 1 ,
              cohort_by_states : [ true , false , false ] ,
              bar_mode : 'grouped' , // grouped | stacked

              // options
              options_mode: [
                  { value: 'population', label: 'Population' },
                  { value: 'cancer', label: 'Cancer type' }
                ],

              options_indicator: [
                  {key : 'total' ,        label : 'Numbers' } ,
                  {key : 'crude_rate' ,   label : 'Crude Rate' } ,
                  {key : 'asr' ,          label : 'ASR (World)' } ,
                  {key : 'asr_e' ,        label : 'ASR (European)' } ,
                  {key : 'asr_n' ,        label : 'ASR (Nordic)' } ,
                  {key : 'cum_risk' ,     label : 'Cumulative risk' }
              ],

              container_smoothing_opened : '' , 

              options_map_scale: [
                  {value: 'quantize', label: 'Absolute' },
                  {value: 'quantile', label: 'Ranked' }
                ],

              options_ages_start: [
                  { value: 0, label: '0' },
                  { value: 1, label: '5' },
                  { value: 2, label: '10' },
                  { value: 3, label: '15' },
                  { value: 4, label: '20' },
                  { value: 5, label: '25' },
                  { value: 6, label: '30' },
                  { value: 7, label: '35' },
                  { value: 8, label: '40' },
                  { value: 9, label: '45' },
                  { value: 10, label: '50' },
                  { value: 11, label: '55' },
                  { value: 12, label: '60' },
                  { value: 13, label: '65' },
                  { value: 14, label: '70' },
                  { value: 15, label: '75' },
                  { value: 16, label: '80' },
                  { value: 17, label: '85'}
                  
              ],

              options_ages_end: [
                  { value: 0, label: '4' },
                  { value: 1, label: '9' },
                  { value: 2, label: '14' },
                  { value: 3, label: '19' },
                  { value: 4, label: '24' },
                  { value: 5, label: '29' },
                  { value: 6, label: '34' },
                  { value: 7, label: '39' },
                  { value: 8, label: '44' },
                  { value: 9, label: '49' },
                  { value: 10, label: '54' },
                  { value: 11, label: '59' },
                  { value: 12, label: '64' },
                  { value: 13, label: '69' },
                  { value: 14, label: '74' },
                  { value: 15, label: '79' },
                  { value: 16, label: '84' },
                  { value: 17, label: '85+'}
                  
              ],

              options_age_span: [
                  { value: 1, label: '5' },
                  { value: 2, label: '10' },
                  { value: 3, label: '15' },
                  { value: 4, label: '20' },
                  { value: 5, label: '25' },
                  { value: 6, label: '30' }
                  
              ],

              options_survival_ages : [
                  { value: 0, label: 'Total' },
                  { value: 1, label: '1-year' },
                  { value: 3, label: '3-year' },
                  { value: 5, label: '5-year' },
                  { value: 10, label: '10-year' }
              ] , 

              single_unit_list : [10,50,100,500,1000,5000,10000,50000,100000,500000,1000000] , 

              apc_male_disabled : false , 
              apc_female_disabled : false , 

              options_age_surv: [
                  { value: 0, label: '0-89' },
                  { value: 1, label: '0-49' },
                  { value: 2, label: '50-59' },
                  { value: 3, label: '60-69' },
                  { value: 4, label: '70-79' },
                  { value: 5, label: '80-89' } 
              ],

              options_surv_period: [
                  { value: 5, label: '5 years' },
                  { value: 10, label: '10 years' }
              ],

              options_apc : [
                  { value: 5, label: '+5.0%' },
                  { value: 4.5, label: '+4.5%' },
                  { value: 4, label: '+4.0%' },
                  { value: 3.5, label: '+3.5%' },
                  { value: 3, label: '+3.0%' },
                  { value: 2.5, label: '+3.5%' },
                  { value: 2, label: '+2.0%' },
                  { value: 1.5, label: '+1.5%' },
                  { value: 0.5, label: '+0.5%' },
                  { value: 0, label: '0.0%' },
                  { value: -0.5, label: '-0.5%' },
                  { value: -1, label: '-1.0%' },
                  { value: -1.5, label: '-1.5%' },
                  { value: -2, label: '-2.0%' },
                  { value: -2.5, label: '-2.5%' },
                  { value: -3, label: '-3.0%' },
                  { value: -3.5, label: '-3.5%' },
                  { value: -4, label: '-4.0%' },
                  { value: -4.5, label: '-4.5%' },
                  { value: -5, label: '-5.0%' }
              ] , 

              top_options : [
                  
                  { 'value' : '0'  , 'label' : ' ' } , 
                  { 'value' : 'key_5_p'  , 'label' : 'Top 5 values ' } , 
                  { 'value' : 'key_10_p'  , 'label' : 'Top 10 values ' } , 
                  { 'value' : 'key_5_m'  ,'label' :  'Bottom 5 values ' },
                  { 'value' : 'key_10_m'  ,'label' :  'Bottom 10 values ' },
                  { 'value' : 'eapc_5_p'  , 'label' : 'Top 5 EAPCs ' } , 
                  { 'value' : 'eapc_10_p'  , 'label' : 'Top 10 EAPCs ' } , 
                  { 'value' : 'eapc_5_m'  ,'label' :  'Bottom 5 EAPCs ' }, 
                  { 'value' : 'eapc_10_m'  ,'label' :  'Bottom 10 EAPCs ' },
                  { 'value' : 'clear'  , 'label' : 'Clear selection' } ,    
              ] , 

              top_add:0,

              select_age_start_disabled: false,

              slider_ages_max : 17 , 
              slider_ages_dot_options : [{ disabled: false },{ disabled: false }] ,

              // cancer select
              cancer_select : '' , 
              cancer_select_close_on_select : false ,
              nb_cancer_selected : '(0)' , 

              // colors
              colors : Constant.colors , 
              color : 0 , // incremental value, to be used freely depending on viz
              color_list : [
                  [ 'red' , 'blue' ] , 
                  Constant.colors_types , // red / blue
                  Constant.colors_sexes , // 
                  [ '#263f44' , '#ffd369'] , 
                  [ '#2B8756' , '#F2A900'] , 
                  [ '#230444' , '#D782FF'] , 
              ] , 
              color_mode : 'default' , // default | sexes | types (textures)
              show_dash_types_legend : false , 
              show_dash_sexes_legend : false , 

             
              years_available : clone_array(Constant.years_available)  , 
              multiselect_years_label : 'value', 

              // map
              map_projection : "equidistant",

              // @to clarify
              ages_start : Constant.ages_start , 

              // grouping
              group_cancers_disabled : false ,  
              group_populations_disabled : false ,
              group_cancers_title : '' ,  
              group_populations_title : '' ,  

              multiple_years : 0 , 

              // sorting
              sortings : [],

              //show component
              show_cancers_prop : 1 ,   
              show_indicator_prop : 1 , 
              show_populations_prop : 0,
              show_years_range_prop : 0,
              show_years_select_prop : 1,
              show_lock_x_scale : 0,
              show_map_view_per_prop : 0,
              show_select_period_prop : 1,
              show_sex_multiple_prop : 1,
              show_sex_single_prop : 0,
              show_nb_items_prop : 0,
              show_survival_prop : 0, 
              show_bar_mode_prop : 0 , 
              show_populations_groups : 0 ,
              show_age_span_prop : 0 ,
              show_dual_position : 1 , 

              // // disabled component
              disabled_min_zero_prop : true ,   
              disabled_set_y_min : true ,   
              disabled_set_y_max : true ,   
              disabled_males : false , 
              disabled_females : false , 
              disabled_both : false , 

              // single unit
              single_unit : 100000 , 

              // smoothing
              marks : {
                '0': '0',
                '10' : '0.1',
                '20' : '0.2' ,
                '25' : '',
                '30': '0.3',
                '50': '0.5',
                '75': '0.75',
                '100': '1'
              } , 
              toggle_smoothing : 0 ,
              slider : { label : 'Slider' , marks : [] , value : 50 } , 
              radius : { label : 'Radius' , marks : [] , value : 0 } , 

              // apc tabs
              apc_marks : {} ,
              apc : 0 ,  
              apc_custom0 : true ,
              apc_custom1 : false ,
              apc_custom2 : false ,
              apc_custom3 : false ,
              apc_split : 1 ,
              apc_split_bool : [0, 0, 0, 0],
              apc_combination : [3] , 
              apcs : [] , 
              apc_notes : '' , 
              apcs_dataset : [] , 
              apcs_textbox : [] , 
              apcs_list : {},
              apcs_specific : {},
              apc_checkbox : [],
              apcs_keys  :[],
              apc_cancer_list : [], 
              overide_apc : false , 

              // survival
              period : {},
              period_start : {},
              age_surv : {},
              age_span : {},
              surv_period : {},
              survival_10_disabled : true, 
              bool_reset_cancer: true,
              show_area : 0 , 

              // predictions
              pred_method : 'nordpred' , 
              pred_constant : 0 ,
              year_base : 2018 ,  
              year_prediction : 2040 , 
              pred_nb_period : '' , 
              pred_recent : '',     

              // tabs
              hide_tab_look : 0 , 
              hide_tab_age_specific_numbers : false , 

              footnote:'' , 
              regional_footnote: ''
          } , 

          formatSmoothing: value => `${value/100}`,

          formatTooltipSlider: value => `${value}` ,

          dictionnary  : {
              ages : Constant.ages_labels , 
              cancers : [] , 
              cancers_list : [] , 
              populations : [] , 
              populations_list : [] ,
              populations_list_grouped : [] , 
              years_start : [] , 
              years_end   : [] , 
              years_list  : [] , 
              years_list_prediction  : [] , 
              years_base_list : [] , 
              sexes_labels : [ 'Both sexes','Males','Females' ] , 
              types_labels : [ 'Incidence','Mortality' ] , 
              sexes_sorting : ['Males','Females'], 
              curves : ['curveBasis','curveLinear'] , 
              cancers_available : [] ,
              populations_available : [] ,
              periods : [] , 
              predefined_populations : [] , 
              periods_start : [] , 
              // years_available : [] ,
              
              interpolators : [
                  { "name" : "Default" , "value" : undefined , "grouping" : "Default" , "excl" : false } ,
                  { "name" : "Blues" , "grouping" : "Sequential (Single hue)" , "excl" : true } ,
                  { "name" : "Greens" , "grouping" : "Sequential (Single hue)" , "excl" : true } ,
                  { "name" : "Greys" , "grouping" : "Sequential (Single hue)" , "excl" : true } ,
                  { "name" : "Oranges" , "grouping" : "Sequential (Single hue)" , "excl" : true } ,
                  { "name" : "Purples" , "grouping" : "Sequential (Single hue)" , "excl" : true } ,
                  { "name" : "Reds" , "grouping" : "Sequential (Single hue)" , "excl" : true } ,

                  { "name" : "BuGn" , "grouping" : "Sequential (Multi-hue)"  , "excl" : true } ,
                  { "name" : "BuPu" , "grouping" : "Sequential (Multi-hue)"  , "excl" : true } ,
                  { "name" : "GnBu" , "grouping" : "Sequential (Multi-hue)"  , "excl" : true } ,
                  { "name" : "OrRd" , "grouping" : "Sequential (Multi-hue)"  , "excl" : true } ,
                  { "name" : "PuBuGn" , "grouping" : "Sequential (Multi-hue)"  , "excl" : true } ,
                  { "name" : "PuBu" , "grouping" : "Sequential (Multi-hue)"  , "excl" : true } ,
                  { "name" : "PuRd" , "grouping" : "Sequential (Multi-hue)"  , "excl" : true } ,
                  { "name" : "RdPu" , "grouping" : "Sequential (Multi-hue)"  , "excl" : true } ,
                  { "name" : "YlGnBu" , "grouping" : "Sequential (Multi-hue)"  , "excl" : true } ,
                  { "name" : "YlGn" ,  "grouping" : "Sequential (Multi-hue)"  , "excl" : true } ,
                  { "name" : "YlOrBr" , "grouping" : "Sequential (Multi-hue)"  , "excl" : true } ,
                  { "name" : "YlOrRd" , "grouping" : "Sequential (Multi-Hue)"  , "excl" : true } 

              ] ,

          },

          oGraphic     : {} ,
          oTrend       : {} , 
          dataset      : [] ,
          api_cache :[]
      }
  },
  created(){
      
      /* if ( this.$store.state.const.dataviz_filters != undefined )
      {
          this.props_hide_tab_look = this.$store.state.const.dataviz_filters.props_hide_tab_look ; 
          this.prop_show_extra_tab = this.$store.state.const.dataviz_filters.prop_show_extra_tab ; 
      }*/

      if ( this.$store.state.const != undefined ){
      
          this.values.data_version = this.$store.state.const.data_version ; 

          if ( this.$store.state.const.cancer_select_close_on_select != undefined )
              this.values.cancer_select_close_on_select = this.$store.state.const.cancer_select_close_on_select;

          if ( this.$store.state.const.population_select_close_on_select != undefined )
              this.values.population_select_close_on_select = this.$store.state.const.population_select_close_on_select ; 

          //if ( this.$store.state.const.multiselect_years_label != undefined ) this.values.multiselect_years_label = this.$store.state.const.multiselect_years_label ; 

          // overide by const age
          if ( this.$store.state.const.options_ages_start != undefined )
              this.values.options_ages_start = this.$store.state.const.options_ages_start ; 

          if ( this.$store.state.const.options_ages_end != undefined )
              this.values.options_ages_end = this.$store.state.const.options_ages_end ; 

          if ( this.$store.state.const.slider_ages_max != undefined )
              this.values.slider_ages_max = this.$store.state.const.slider_ages_max ; 
            
      } 

      // console.info("this.values.multiselect_years_label",this.values.multiselect_years_label) ; 

      // console.info("=> this.prop_init_values ",this.prop_init_values , Object.keys(this.prop_init_values));
      Object.keys(this.prop_init_values).forEach(d => { // values from json default

          if (d == 'years')
          {
              this.values[d] = JSON.parse(JSON.stringify(this.prop_init_values[d]));
          }
          else 
          {
           this.values[d] = this.prop_init_values[d];
          }
           
      }); 

      // overtide by conf
      if ( this.prop_init_values.multiselect_years_label != undefined ) 
          this.values.multiselect_years_label = this.prop_init_values.multiselect_years_label ; 

      // console.info("this.values.multiselect_years_label",this.values.multiselect_years_label) ; 
      if ( this.values.years != undefined){
          this.values.years_select = [{value:this.values.years[0]},{value:this.values.years[1]}]; 
          this.values.years_mobile = this.values.years[0] ; 
          this.values.mode_mobile = this.values.mode.value ; 
      }
      // init year select from prop init values 

      // this.values.years_multiple_select = this.values.years_multiple ; 

      // console.info(" this detectUriParams ")  ; 
      this.detectUriParams(); // update with values in URL

      this.mountDynamicComponent() ; 
      // this.rewriteRoute(); 

      // mobile use
      

  },

  watch:{ 

      /*
      * Watch specificaly browsers next/prev action
      */
      $route : function(){

      }
  } ,

  mounted() {

      this.$store.commit('clearGraphicFootnote') ;
      
      this.values.data_version    = this.values.data_version ; // this.$store.state.const.data_version ; 

      // overide constant by store (except data_version)
      this.values.colors          = this.$store.state.const.colors ; 
      this.values.ages_start      = this.$store.state.const.ages_start ;  
      
      this.dictionnary.ages       = this.$store.state.const.ages_labels ;  

      if ( this.$store.state.const.dataviz_filters != undefined ){
          this.values.hide_tab_look = this.$store.state.const.dataviz_filters.hide_tab_look ; 
          this.values.merge_tab            = this.$store.state.const.dataviz_filters.merge_tab3_to_tab2 ;
      }

      this.mountDefaultValues() ; 

      setTimeout( function(){
          // adjust min height on page content depending on dataviz filters height
          let filters_height = $('#container-filters .filters').height() + 80  ; // 50 is height of tabs
          if ( filters_height > 500 )$('body #app .page .page_content').css('min-height',`${filters_height}px`) ;
      },2000);

  } , 

  methods: {

      /**
      * Force component to reload and refresh all values
      * @param (no param)
      * @return (no return)
      */
      refresh(){

          console.info("refresh datavizFilters") ;
          this.$forceUpdate();

      }, 

      forceRerender() {
          //this.componentKey += 1;
          console.info("forceRerender datavizFilters") ;
      },


      refreshSubComponents: function(){

          // this.dynamic_components

      },

      /**
      * Depending on constant projects, replace/merge/move some fieldset from one viz to another
      * Temporary function waiting for a more flexible feature
      * @param (no param)
      */
      configureTabs : function(){

          if ( this.$store.state.const.dataviz_filters != undefined )
          {
              if ( this.$store.state.const.dataviz_filters.merge_tab3_to_tab2 == true )
              {
                  let content_tab3 = $('.filters.tab_content div.tab-pane:nth-child(3)').html() ; 
                  $('.filters.tab_content div.tab-pane:nth-child(2)').append( content_tab3 ) ; 
                      
                  this.refresh();
                  // this.values.props_hide_tab_look = 1 ; 
              }   
          }
      },

      /**
      * Redirect to current url without parameters so everything is cleared
      * @param (no param)
      * @return (boolean)
      */
      clearAllValues : function(){

          let uri     = window.location ; 
          this.current_route = this.$router.currentRoute.name ;

          //console.log("this.$router.currentRoute", this.$router.currentRoute.path , document.location) ; 
          
          //return; 
          
          if ( this.$parent.default_route != undefined )
              document.location.href = this.$parent.default_route ; 
          else
              document.location.href = document.location.pathname ; //this.$router.currentRoute.path ; 
      },  

      /**
      * Dynamic component, built on top of configuration file
      * @param (no param)
      * @retun (array)
      */
      mountDynamicComponent : function(){

          // clean local defaut config, and fetch all dynamic components builder 
          this.dynamic_components = Object.keys(this.prop_init_values)
              .filter( d => {
                  let type = typeof(this.prop_init_values[d]) , conf = this.prop_init_values[d] ; 
                  return ( type == 'object' && conf.mode == 'dynamic') ; 
              })
              .map( d => { 
                  const time = Date.now();
                  return { 
                      id : `dynamic-component-${d}-${time}` , 
                      name : d , 
                      time : time ,
                      config : this.prop_init_values[d] 
                  }})
              .sort((a,b)=>{ return a.config.position-b.config.position; })

          // then init init values delegate to component
          this.dynamic_components.forEach( comp => {

              let var_ = comp.name ; 

              // console.info("var_",var_,"this.params.get(var_)",this.params.get(var_)) ;
              if ( var_ != undefined && this.params.get(var_) != undefined ){

                  // !!! to be discussed - should be nest into current ?? (else it goes to route, when we loose init values)

                  // specific to bool, transtype
                  if ( comp.config.type == 'bool' ){
                      this.values[var_].current = parseFloat(this.params.get(var_));
                  }
                  // init value in key pair select mode (specific to MultiSelect)
                  else if ( comp.config.component == 'FilterMultiselect'){
                      this.values[var_].current = comp.config.options.find( c => c.value == this.params.get(var_) ) 
                  }
                  // default mode is simple values
                  else
                  {
                       // if multiple mode then value is x_y_z
                      if ( comp.config.multiple == true )
                          this.values[var_].current = this.params.get(var_)
                      else
                          this.values[var_].current = this.params.get(var_)  ; 
                  }
              }
              // init var into values
              // this.values[var_] = current ; 
          })
          // console.info("this.dynamic_components",this.dynamic_components) ; 
      },

      /**
      * On change dynamic component
      * @param (object)
      * @return (no return)
      */
      updateDynamicComponent : function ( local_component ){

          // console.info("updateDynamicComponent local_component.data",local_component.data) ; 
          // let comp = this.dynamic_components.find( c => c.name == local_component.prop_name );
          
          // bind new value value and set to store
          this.values[local_component.data.prop_name].current = ( local_component.data.url_param != undefined) ?local_component.data.url_param : local_component.data.value ; 

          // this.values[var_] = current ; 
          // console.info("=>",local_component.data.prop_name,local_component.data.prop_config.remote) ; 

          // if remote
          if ( local_component.data.prop_config.remote == false ) {

              // update without calling again remote 
              this.updateRemoteless( local_component.data.prop_name );
          }
          else{
              // default mode
              this.update();
          }

          //
          /*this.dynamic_components.forEach((d,i)=>{
              // force id to re-rendered
              d.id = d.id + '-'- Date.now();
          });*/

          this.$forceUpdate();
      },

      /**
      * Extract mount values in method to re-usable
      * @param (no param)
      * @return (boolean)
      */
      mountDefaultValues : function(){

          this.obj_parameters = { 
              'mode' : this.values.mode.value , 
              'types' : this.values.types , 
              'sexes' : this.values.sexes ,
              'populations' : this.values.populations , 
              'cancers' : this.values.cancers , 
              'age_start' : this.values.age_start , 
              'age_end' : this.values.age_end , 
              'year_start' : (this.values.years != undefined) ? this.values.years[0] : 0, 
              'year_end' : (this.values.years != undefined) ? this.values.years[1] : 0, 
              'range' : true
          } ; 

          let sexes_str   = this.values.sexes ; 
          let types_str   = this.values.types ; 
          let populations_str = this.values.populations.join('_') ; 
          if ( this.values.group_populations == 1) populations_str = '('+populations_str+')';
          let cancer_str = this.values.cancers.join('_') ; 
          if ( this.values.group_cancers == 1) cancer_str = '('+cancer_str+')';

          let year_str 
          if (this.values.years!=undefined) year_str= this.values.years.join('_') ; 

          let map_populations_str = '208_234_246_304_352_578_752'
          if (this.values.map_view_per == 'regions')
          {
              map_populations_str = '234_304_2080_2081_2082_2083_2084_2460_2461_2462_2463_2464_3520_3521_5780_5781_5782_5783_7520_7521_7522_7523_7524_7525';
          }
             
          if (this.$store.state.const.project_slug == "overtime") map_populations_str = populations_str;

          if (this.$store.state.const != undefined) map_populations_str = this.$store.state.const.all_populations.join('_') ; 
          
          this.values.sortings = (this.values.sexes.length > 1 && this.values.types == 1 ) ? this.dictionnary.sexes_sorting : this.dictionnary.types_labels ;

          // eslint-disable-next-line
          $('body')
              .addClass(( this.print == 1 ) ? 'is_print' : '' ) 
              .addClass(( this.values.format == 2 ) ? 'standard_monitor' : '' ) 
              .addClass( `ext_${this.values.ext}` ) 
          ; 

          //this.url_api = this.buildUrlApi( this.obj_parameters ) 

          this.base_url_api = ( this.url_api_DICTIONNARY != undefined ) ? this.url_api_DICTIONNARY : this.url_api ;

          // dynamic promises building
          // by default, always true

          let promises ;
          let promises_name; 

          // if store already have loaded dictionnary, don't load agaiin
          if ( this.$store.state.dictionnary != undefined)
          {

              promises = [] ; 
              promises_name = [] ; 

          }
          else
          {
              promises = [

                  // cancer site list 
                  this.base_url_api + 'meta/cancers/all/' ,

                  // pops list 
                  this.base_url_api + 'meta/populations/all/'

              ] ; 

              promises_name = ['cancers', 'populations'];

                 
          }

          // console.info("this.values",this.values) ; 

          this.values.toggle_smoothing = ( this.values.smoothing > 0 ) ? 1 : 0 ; 
          
          if ( this.$store.state.const.check_availability == true )
          {

              if (sexes_str == "0" ) sexes_str = "1_2"

              let str_pop =  this.base_url_api +'/meta/availability/'+types_str+'/'+sexes_str+'/'
              let str_cancer =   this.base_url_api +'/meta/availability/'+types_str+'/'+sexes_str+'/'+populations_str+'/'

              if (this.prop_is_prediction == 1)
              {
                  str_pop = str_pop+'?prediction=1'
                  str_cancer = str_cancer+'?prediction=1'
              }

              if (this.prop_is_survival == 1)
              {
                  types_str = "3"
                  str_pop = this.base_url_api +'/meta/availability/'+types_str+'/'+sexes_str+'/'
                  str_cancer = this.base_url_api +'/meta/availability/'+types_str+'/'+sexes_str+'/'+populations_str+'/'
              }


              // population_available test
              promises.push(str_pop)
              promises_name.push('populations_available')

              // cancer_available
              promises.push(str_cancer)
              promises_name.push('cancers_available')

              // year available (all countries for map)
              promises.push(this.base_url_api +'/meta/availability/'+types_str+'/'+sexes_str+'/'+map_populations_str+'/'+cancer_str+'/')

              promises_name.push('map_years_available')


              // year available  general
              promises.push(this.base_url_api +'/meta/availability/'+types_str+'/'+sexes_str+'/'+populations_str+'/'+cancer_str+'/')
              promises_name.push('years_available')

              // country not available
              promises.push(this.base_url_api +'/meta/availability/'+types_str+'/'+sexes_str+'/'+populations_str+'/'+cancer_str+'/'+year_str+'/')
              promises_name.push('not_available')

               ; 
          }

          if ( this.$store.state.const.predefined_population == true )
          {
              promises.push(this.base_url_api + 'meta/predefined_populations/all/')
              promises_name.push('predefined_populations')
          }

          if (this.website_is_static)
          {
              promises = promises.map(item => this.getCachedLimitedFile(item,'globocan', false));
          }
         
          axios.all( promises.map(l => axios.get(l)) )

          // .then( axios.spread(( cancers_promise , populations_promise, population_available_promise,cancer_available_promise, map_years_available_promise, years_available_promise, not_available_promise, predefined_populations_promise) => {

          // move to dynamic calls instead of predefined numbers or arguments 
          .then( axios.spread(( ...responses ) => {


              if (this.$store.state.dictionnary != undefined)
              {
                  this.dictionnary.cancers = clone_array(this.$store.state.dictionnary.cancers_promise);
                  this.dictionnary.populations = clone_array(this.$store.state.dictionnary.populations_promise);
                  this.dictionnary.cancers_available = clone_array(this.$store.state.dictionnary.cancers_available_promise);

              }

              responses.forEach((item, index) =>{


                  this.dictionnary[promises_name[index]] = item.data

              });

              if ( this.$store.state.const.check_availability == true )
              {
                  this.$emit('callUpdatePromisesAvailable',this) ; 
              }
              else
              {
                  this.dictionnary.populations_available  = this.dictionnary.populations.map( pop => pop.country ) ;

                  if ( this.$store.state.dictionnary.cancers_available_promise == undefined)
                      this.dictionnary.cancers_available      = this.dictionnary.cancers.map( cancer => cancer.id ) ;
              } 

              // build dictionnary population list (for simple component)
              this.dictionnary.populations_list = this.dictionnary.populations ; 

              // create nested population dictionnary (for nested component)
              this.dictionnary.populations_list_grouped = d3.nest()
                  .key((d)=>{ return d.grouping ; })
                  .entries(this.dictionnary.populations_list);
              
              //emit to filter population for specific view (methods depends on view)
              this.$emit('callUpdatePopulationList',this) ; 

              // console.log(this.dictionnary.populations_list)

              // console.log(filters);
              if (this.$store.state.const.project_slug == "overtime")
              {
                  let bool_reset = this.filterPopulationList() ;
                  // console.log('test');
                  if (bool_reset) 
                  {
                      this.update()
                  }
                  else {
                      this.filterCancerSitesList() ;   
                  }

              } 
              else 
              {
                  this.filterCancerSitesList() ;   
              }
              

               // select population
              this.values.population_select = this.dictionnary.populations.filter((d) => {
                  return ( this.values.populations.includes(d.country));
              });

              // select cancer
              this.values.cancer_select = this.dictionnary.cancers_list.filter((d) => {
                  return ( this.values.cancers.includes(d.cancer));
              });   

              this.manageCurrentSelectedCancerList() ;

              this.manageCurrentSelectedPopulationList();

              this.dictionnary.chromatic = d3.nest()
                  .key((d)=>{ return d.grouping ; })
                  .entries( this.dictionnary.interpolators ) ;

              // reinitialize display by mode if previous mode not included.
              let bool_mode = false
              this.values.options_mode.some(item => {
                  if (item.value === this.values.mode.value) 
                  {
                      bool_mode= true;
                  }
              })

              // console.log("this.values.options_mode",bool_mode,this.values.mode.value,this.values.options_mode[0]) ; 

              if (!bool_mode)
              {
                  this.values.mode = this.values.options_mode[0]
                  // this.rewriteRoute();
              }

               // reinitialize indicator if previous indicator not included.
              let bool_indicator = false
              this.values.options_indicator.some(item => {
                  if (item.key === this.values.key) 
                  {
                      bool_indicator= true;
                  }
              })

              if (!bool_indicator)
              {
                  this.values.key = this.values.options_indicator[0].key
                  // this.rewriteRoute();
              }

              // indicatort
              if (this.prop_indicator == 1)
              {       
                  this.values.indicator_select = this.values.options_indicator.filter((d) => {
                      return ( this.values.key == d.key);
                  }); 
              }
              

              if (this.prop_mode == 1)
              {
                  this.values.mode = this.values.options_mode.filter((d) => {
                       return ( this.values.mode.value == d.value);
                  })[0];
              }

              if (this.prop_map_scale == 1)
              {
                  this.values.map_scale = this.values.options_map_scale.filter((d) => {
                       return ( this.values.map_scale.value == d.value);
                  })[0];
              }

              if ( this.prop_age_surv == 1)
              {
                  this.values.age_surv = this.values.options_age_surv.filter((d) => {
                       return ( this.values.age_surv.value == d.value);
                  })[0];
              } 

              if (this.values.age_span.value != undefined) // because can not detect prop don't know why.. but this is working better in fact
              {
                  this.values.age_span = this.values.options_age_span.filter((d) => {
                       return ( this.values.age_span.value == d.value);
                  })[0];

              }

              if ( this.prop_surv_period == 1)
              {
                  this.values.surv_period = this.values.options_surv_period.filter((d) => {
                       return ( this.values.surv_period.value == d.value);
                  })[0];
              } 

              if ( this.prop_apc == 1)
              {
                  this.values.apc_male = this.values.options_apc.filter((d) => {
                       return ( this.values.apc_male.value == d.value);
                  })[0];

                  this.values.apc_female = this.values.options_apc.filter((d) => {
                       return ( this.values.apc_female.value == d.value);
                  })[0];
              }

              if( this.prop_sexes_multiple == 1) {
                  if ( this.values.sexes == '0' ) this.values.sexes = '1_2' ; 
              } 

              if( this.prop_sexes_single == 2) {
                  if (this.$store.state.const != undefined && this.$store.state.const.allow_both_sexes_combined != true ){
                      if ( this.values.sexes == '1_2') this.values.sexes = '0' ;
                  } 
              }

              if (this.$store.state.const.data != undefined)
              {
                  this.values.years_available = clone_array(this.$store.state.const.data[this.values.data_version].years_available);

              }
              
              for ( let y = this.values.years_available[1] ; y >= this.values.years_available[0] ; y-- ) {
                  this.dictionnary.years_start.push( {'value':y} ) ; 
              }

              for ( let yi = this.values.years_available[1] ; yi >= this.values.years_available[0]+1 ;  yi-- ) {
                  this.dictionnary.years_end.push( {'value':yi} ) ; 
              }

              let counteurYear = ( this.$store.state.const.year_counter != undefined ) ? this.$store.state.const.year_counter : 1 ; 
              for ( let y = this.values.years_available[1] ; y >= this.values.years_available[0] ; y-=counteurYear ) {
                  this.dictionnary.years_list.push( {'value':y} ) ; 
              }

              for ( let y = this.$store.state.const.data[this.values.data_version].year_prediction ; y > this.values.years_available[1] ;y-- ) {
                  this.dictionnary.years_list_prediction.push( {'value':y} ) ; 
              }

              //console.log(this.dictionnary.years_list_prediction);

              for ( var y = this.values.years_available[1] ; y >= 1975 ; y-- ){
                this.dictionnary.years_base_list.push( {'value':y} ) ; 
              }
              
              // overide if all years is declared
              if ( this.$store.state.const.all_years != undefined ){
                  this.dictionnary.years_list = [] ; 

                  this.$store.state.const.all_years.forEach( ( year) => {
                      this.dictionnary.years_list.push( {'value':  year } ) ; 
                  });
              }

              // overide all years if defined in specific conf of viz (ex: Nordcan -> Quality Tables) 
              /*if ( this.prop_init_values != undefined && this.prop_init_values.years_available != undefined ){

                  // console.info("overide",this.prop_init_values.years_available) ; 

                  this.dictionnary.years_list = [] ; 
                  this.prop_init_values.years_available.forEach((y)=>{
                      // console.info("typeof(y)",typeof(y)) ;
                      let obj = ( typeof(y) == 'object' ) ? y : {'value':  y } ;
                      this.dictionnary.years_list.push( obj ) ; 
                  })
                  this.values.years_available = [this.prop_init_values.years_available[0].value,this.prop_init_values.years_available[this.prop_init_values.years_available.length-1].value] ; 
              }*/
              
              this.values.age_select = [this.values.options_ages_start[this.values.ages[0]],this.values.options_ages_end[this.values.ages[1]]]; 

              // console.log("this.values.age_select",this.values.age_select[0].label,this.values.age_select[1].label) ;


              // scale Y axis option


              // if log: min zero false / 0 value lock false
              if (this.values.scale == 'log') 
              {
                  this.values.min_zero = false;
                  this.values.disabled_min_zero_prop = true;
                  if (this.values.set_scale == 1 ) {
                      if (this.values.y_min == 0) 
                      {
                          this.values.set_scale = 0
                      }
                  }

              } // if linear, min zero option available
              else {

                  this.values.disabled_min_zero_prop = false;

              }

             
             // if min_zero
              if (this.values.min_zero)
              {
                  // set min value is disabled
                  this.values.disabled_set_y_min = true;
              }
              else {
                   this.values.disabled_set_y_min = (this.values.set_scale==0);
                   
              }

              this.values.disabled_set_y_max = (this.values.set_scale==0);

                  

              if ( this.$store.state.const.check_availability == true )
              {
                  // check data available
                  this.checkNotAvailable(this.dictionnary.not_available);
              }

              // update age range on refresh
              this.$emit('callUpdateAgeRange',this) ; 
              
              this.$emit('callUpdateFilterState',this) ;
              // this.$emit('callAfterUpdateModeSelection',this) // NOT SURE IT IS NEEDED TO CHECK
              this.rewriteRoute();

              this.filterYearList() ; 
              this.filterAgeList();

               // rewrite route updating filters
              // this.rewriteRoute();
              setTimeout(()=>{

                  // eslint-disable-next-line
                  if ( typeof $('select[name="palette"]').selectize=== "function") 
                  {
                      // eslint-disable-next-line
                      this.selectize_palette = $('select[name="palette"]').selectize( {
                          sortField : 'grouping' , 
                          onChange: ( value ) => {
                              
                              this.values.palette = value ; 
                              // run update func
                              this.changeColor() ;
                          },
                          render: {
                              option: function(data, escapeFunc) {
                                  // console.info("data",data) ; 
                                  let img = ( data.value == 'reset' || data.value == 'default') ? '' : '<img src="./img/d3-chromatic/'+data.value+'.png">' ;
                                  return '<div class="option_chromatic">' +
                                              '<span class="title">' + escapeFunc( data.text ) + '</span>' +
                                              img +
                                          '</div>';
                              }
                          }
                      } );
                  }
                                  
                  if ( this.prop_show_extra_tab == 1 )
                  {   
                      if ( this.$store.state.const.project == 'CancerTomorrow')
                      {
                          if ( this.values.mode.value == 'cancer' && this.$router.currentRoute.name == 'tables')
                          {
                              let c_ = [] ; 
                              this.dictionnary.cancers.forEach( (c)=>{  c_.push( c.cancer ); })

                              // to be externalized
                              // if table, cancer mode, CancerTomorrow, then we want all cancerrs
                              this.values.apc_cancer_list = c_ ;
                          } 
                      }

                      this.generateApcsList(); 
                      this.updateApcAPI();
                      this.manageSimpleApc() ; 
                  }

                  // emit dataviz to let dataviz know doc is ready
                  this.$emit('callCreateFromDatavizFilter', this ) ; 


                  this.updateTitle();

                  this.checkColorMode() ; 

                  // @todo: the settimeout is a workaround to wait for js launching in dataviz
                  // @todo: the 1500 might not be sufficient is some cases 
                  // console.info( "wait before launch" ) ; 

                  // merge tabs if need depending on project
                  // this.configureTabs() ; 

                  // commit changes to store
                  this.$store.commit('setFilters',this) ; 
                  
                  this.manageFootnote() ; 

              }, 2000 ) ;
              
              // set to input val for permakink
              // eslint-disable-next-line
              // console.info("===>",document.location.href);
              $('input[id="permalink_dl_lk"]').val( document.location.href ) ; 
              
          }))
          // eslint-disable-next-line
          .catch( error => {
              console.error("Error catched",error) ; 
              this.error = true
          })
          .finally(() => {
          })

      } , 

      /**
      * @deprecated to be checked in Tomorrow
      * manageFootnote : function(notes){

          this.values.footnote = ""
          if (this.values.populations.length > 1 & this.values.group_populations == 1)
          {
              this.values.footnote = this.$t('caution') ; 
          }
      }
      *
      * Centalize footnote management (regional, dictionnary, loess, log scale .. )
      * @param(no param)
      */
      manageFootnote : function(){

          if ( this.$store.state.const.label_regional != undefined && this.$store.state.const.label_regional == true )
          {
              let footnote_regional = '' , subnational = "* Subnational data" ;  
              //console.log("this.$parent.graphic_type",this.$parent.graphic_type) ; 
              
              switch( this.values.types ){
                  case '0': 
                  case 0 : 
                      footnote_regional = "* Subnational data" ; 
                      break ;
                  case '1': 
                  case 1 : 
                      footnote_regional = '' ; 
                      break ; 
                  case '0_1' :   
                      footnote_regional = subnational ; 
                      if ( ['bar','eapc',].includes( this.$parent.graphic_type) )
                          footnote_regional = "* Subnational incidence data" ; 
                      break ; 
              }

              this.$store.commit('setGraphicFootnote',footnote_regional) ; 

              // DatavizFootnote.methods.updateSvg([footnote_regional]);
          }

      }, 

      /**
      * detect intent
      * @param (no param)
      * @return (boolean)
      */

      detectIntent : function(param){
          let uri     = window.location.search.substring(1); 
          let params  = new URLSearchParams(uri);
          return params.get(param) != null

      },   


       /**
      * Externalize reading query string values when sending permalink
      * @param (no param)
      * @return (boolean)
      */

      detectUriParams : function(){

          let uri     = window.location.search.substring(1); 
          let params  = new URLSearchParams(uri);

          this.params = params ; 

          if ( params.get('data_version') != null)    
          {
              this.values.data_version = params.get('data_version')  ;
              //console.info(" A params.get('data_version')",params.get('data_version'));
              this.data_version_tmp = this.values.data_version ; 
              /*console.info(" B " , { 
                  'data_version_tmp' : this.data_version_tmp , 
                  'this.values.data_version' : this.values.data_version 
              });*/
          }

          // overwrite default by database 
          if (this.prop_init_values.data != undefined && this.prop_init_values.data[this.values.data_version] != undefined )
          {
              // console.info("this.prop_init_values.data",this.prop_init_values.data[this.values.data_version]) ; 

              Object.keys(this.prop_init_values.data[this.values.data_version]).forEach(d => { // values from json default
                  if (d == 'years')
                  {
                      this.values[d] = JSON.parse(JSON.stringify(this.prop_init_values.data[this.values.data_version][d]));

                      this.values.years_select = [{value:this.values.years[0]},{value:this.values.years[1]}];
                  }
                  else if ( d == 'years_multiple')
                  {
                      this.values[d] = JSON.parse(JSON.stringify(this.prop_init_values.data[this.values.data_version][d]));

                      this.values.years_select_multiple = this.values.years_multiple.map((y)=>{
                          return{value : y }
                      })
                  }
                  else 
                  {
                   this.values[d] = this.prop_init_values.data[this.values.data_version][d];
                  }
                  // console.log(this.prop_init_values.data[this.values.data_version][d])
                  // console.log(this.values[d])
              });
          }

          if ( this.url_api != undefined )
              this.url_api = this.url_api.replace('[vdb]',this.values.data_version) ; 

          if ( params.get('mode') != null)            this.values.mode.value         = params.get('mode') ;
                      
          if ( params.get('key') != null)             this.values.key         = params.get('key') ; 

          if ( params.get('types') != null)           this.values.types       = params.get('types') ;
          if ( params.get('survival') != null)        this.values.survival       = params.get('survival') ;

          if ( params.get('sexes') != null)           this.values.sexes       = params.get('sexes') ; 

          if ( params.get('populations') != null)     this.values.populations = params.get('populations').split('_').map(Number) ; 
          if ( params.get('cancers') != null)         this.values.cancers     = params.get('cancers').split('_').map(Number) ; 

          if ( params.get('age_start') != null)       this.values.age_start   = Number( params.get('age_start') ) ; 
          if ( params.get('age_end') != null)         this.values.age_end     = Number( params.get('age_end') ) ; 

          // prevent from age start > age end
          if ( this.values.age_start > this.values.age_end )
          {
              this.values.age_start   = Number( params.get('age_end') ) ; 
              this.values.age_end     = Number( params.get('age_start') ) ; 
          }

          // prevent from value > val max slider
          if ( this.values.age_end > this.values.slider_ages_max ) this.values.age_end = this.values.slider_ages_max ; 

          this.values.ages = [ this.values.age_start , this.values.age_end ] ; 

          if ( params.get('year_start') != null)      this.values.year_start  = params.get('year_start') ; 
          if ( params.get('year_end') != null)        this.values.year_end    = params.get('year_end') ; 
          // this.values.years = [ this.values.year_start , this.values.year_end ] ; 

          if ( params.get('years') != null){

              this.values.years = params.get('years').split('_').map(Number) ; 
              this.values.years_select = [];
              this.values.years.forEach(y => {
                  this.values.years_select.push({value:y})
              });
          }

          if ( params.get('years_multiple') != null){
              this.values.years_multiple = params.get('years_multiple').split('_').map(Number) ; 
              this.values.years_select_multiple = [];
              this.values.years_multiple.forEach(y => {
                  this.values.years_select_multiple.push({value:y})
              });
          }

          // specific position of group years to check in url
          if ( params.get('group_years') != null)   this.values.group_years = Number(params.get('group_years'))  ; 

          // do not erase this.values.years if years from url is 2 values
          // console.info("this.values.group_years",this.values.group_years) ; 
          if ( this.values.group_years == 0 ){

              if ( this.values.single_select_multiple == true ){
                  this.values.years_select = this.values.years ; 
              }

              //console.info("A this.values.years",this.values.years,[this.prop_multiple_years_select,this.prop_multiple_years_range]) ; 

              // exception to overide select years
              if ( this.values.mode.value != 'year' && this.$router.currentRoute.name != 'tables' /* && this.$router.currentRoute.name != 'quality_table' && this.$router.currentRoute.name != 'survival_quality_table' */ )
              {
                  
                  if ((this.prop_multiple_years_select == undefined || this.prop_multiple_years_select ==0) && 
                      (this.prop_multiple_years_range ==undefined || this.prop_multiple_years_range ==0)) 
                  {
                      this.values.years = [this.values.years[this.values.years.length-1]];
                      this.values.years_select = [{value:this.values.years[this.values.years.length-1]}];
                  }
              }
          }
          else
          {
              this.values.multiple_years = 1;
          }

          

          if ( params.get('map_scale') != null)       this.values.map_scale.value   = params.get('map_scale') ; 

          if ( params.get('square') != null)          this.values.square      = params.get('square') ; 
          if ( params.get('num_path') != null)        this.values.num_path    = params.get('num_path') ; 
          
          if ( params.get('lock_y_max') != null)      this.values.lock_y_max  = Number(params.get('lock_y_max'))  ; 
          if ( params.get('show_dots') != null)       this.values.show_dots   = Number(params.get('show_dots'))  ; 

          if ( params.get('palette') != null)         this.values.palette     = params.get('palette')  ; 
          if ( params.get('map_nb_color') != null)    this.values.map_nb_color  = params.get('map_nb_color')  ; 
          if ( params.get('map_view_per') != null)    this.values.map_view_per  = params.get('map_view_per')  ; 

          if ( params.get('sort_by') != null)         this.values.sort_by     = params.get('sort_by')  ; 
          if ( params.get('sort_dir') != null)        this.values.sort_dir    = params.get('sort_dir')  ; 
          
          if ( params.get('eapc_span') != null)        this.values.eapc_span   = params.get('eapc_span')  ; 
          if ( params.get('nb_items') != null)        this.values.nb_items   = params.get('nb_items')  ; 
          if ( params.get('smoothing') != null)       this.values.smoothing  = Number(params.get('smoothing')) ; 

          if ( params.get('lock_scale') != null)      this.values.lock_scale   = Number(params.get('lock_scale'))  ; 

          if ( params.get('label_position') != null)  this.values.label_position = params.get('label_position')  ;
          if ( params.get('values_position') != null)  this.values.values_position = params.get('values_position')  ; 
          if ( params.get('pop_indicator') != null)   this.values.pop_indicator = params.get('pop_indicator')  ; 
          if ( params.get('group_populations') != null)   this.values.group_populations = Number(params.get('group_populations'))  ;
          if ( params.get('multiple_populations') != null)   this.values.multiple_populations = Number(params.get('multiple_populations'))  ; 
          if ( params.get('group_cancers') != null)   this.values.group_cancers = Number(params.get('group_cancers'))  ; 
          if ( params.get('multiple_cancers') != null)   this.values.multiple_cancers = Number(params.get('multiple_cancers'))  ; 
          
          if ( params.get('multiple_years') != null)   this.values.multiple_years = Number(params.get('multiple_years'))  ; 
          
          
          if ( params.get('dual_position') != null)   this.values.dual_position  = Number( params.get('dual_position') ) ; 

          if ( params.get('bar_mode') != null)   this.values.bar_mode  = params.get('bar_mode') ; 

          if ( params.get('age_span') != null)           this.values.age_span.value = params.get('age_span')  ;
          if ( params.get('cohort') != null)          this.values.cohort  =  params.get('cohort') ; 
          if ( params.get('cohort_type') != null)          this.values.cohort_type  =  params.get('cohort_type') ; 
          if ( params.get('cohort_rate') != null)  this.values.cohort_rate  =  params.get('cohort_rate') ; 
          if ( params.get('cohort_by') != null)  this.values.cohort_by  =  params.get('cohort_by') ; 
          

          if ( params.get('color') != null)           this.values.color  =  params.get('color') ; 
          if ( params.get('ul') != null)              this.values.ul  =  Number(params.get('ul')) ; 
          if ( params.get('period') != null)           this.values.period.value = params.get('period')  ;
          if ( params.get('period_start') != null)           this.values.period_start.value = params.get('period_start')  ;
          if ( params.get('top_nb') != null)           this.values.top_nb.value = params.get('top_nb')  ;
          if ( params.get('age_surv') != null)           this.values.age_surv.value = params.get('age_surv')  ;
          if ( params.get('surv_period') != null)           this.values.surv_period.value = Number(params.get('surv_period'))  ;

          if ( params.get('apc_male') != null)        this.values.apc_male.value = params.get('apc_male')  ;
          if ( params.get('apc_female') != null)       this.values.apc_female.value = params.get('apc_female')  ;
          if ( params.get('show_area') != null)       this.values.show_area = Number(params.get('show_area'))  ;

          if ( params.get('print') != null)           this.print = Number(params.get('print'))  ; 
          if ( params.get('format') != null)           this.values.format = Number(params.get('format'))  ; 
          if ( params.get('ext') != null)           this.values.ext = params.get('ext')  ; 
          if ( params.get('pred_constant') != null)  this.values.pred_constant = params.get('pred_constant')  ;
          if ( params.get('pred_method') != null)  this.values.pred_method = params.get('pred_method')  ;

          if ( params.get('pred_nb_period') != null)  this.values.pred_nb_period = Number(params.get('pred_nb_period'))  ;
          if ( params.get('year_base') != null && typeof(this.values.year_base) == 'object')  {
              this.values.year_base.value = params.get('year_base')  ;
          }
          if ( params.get('year_prediction') != null && typeof(this.values.year_prediction) == 'object')  this.values.year_prediction.value = params.get('year_prediction')  ;
          if ( params.get('pred_recent') != null)  this.values.pred_recent = params.get('pred_recent')  ;
          if ( params.get('round_numbers') != null)  this.values.round_numbers = params.get('round_numbers')  ;

          // registry grouping
          if ( params.get('registry_group') != null)   this.values.registry_group = Number(params.get('registry_group'))  ;

          // specific to apcs object
          if ( params.get('apc') != null)    this.values.apcs_url = params.get('apc')  ;
          // if ( params.get('apc_split') != null)     this.values.apc_split = Number(params.get('apc_split'))  ;

          if ( params.get('scale') != null)           this.values.scale       = params.get('scale') ; 
          
          // get apc value from url
          if (this.values.apcs_url === undefined)
          {
              this.values.apc_custom0 = true
              this.values.apc_custom1 = false
              this.values.apc_custom2 = false
              this.values.apc= 0
          }
          else if (+this.values.apcs_url === +this.values.apcs_url)
          {
              this.values.apc_custom0 = true
              this.values.apc_custom1 = false
              this.values.apc_custom2 = false
              this.values.apc= +this.values.apcs_url

          }
          else if (this.values.apcs_url.substring(0,3) == 'cat')
          {
              this.values.apc_custom0 = false
              this.values.apc_custom1 = true
              this.values.apc_custom2 = false
              let apcs_url_ = this.values.apcs_url.substring(4)
              let apc_array_ = apcs_url_.split('_')
              apc_array_.forEach((key) => {
                  let d = key.split('v') ;
                  this.values.apcs_list[d[0]] = Number(d[1])
              })
          }
          else if (/\d+c\d+c\d+/.test(this.values.apcs_url))
          {

              this.values.apc_custom0 = false
              this.values.apc_custom1 = false
              this.values.apc_custom2 = true

              let apc_array_ = this.values.apcs_url.split('_')
              apc_array_.forEach((key) => {
                  let d = key.split('v') ;
                  this.values.apcs_specific[d[0]] = Number(d[1])
              })
          }

          if ( params.get('single_unit') != null)     this.values.single_unit = params.get('single_unit')  ;

          // exception for : 
          let reset = 0 ; 
          if ( params.get('reset') != null)        reset  = Number( params.get('reset') ) ;

          // if reset == 1, then we are coming from left menu 
          if ( reset == 0 )
          {

              if ( params.get('y_min') != null)        this.values.y_min  = Number( params.get('y_min') ) ;
              if ( params.get('y_max') != null)        this.values.y_max  = Number( params.get('y_max') ) ;
              if ( params.get('set_scale') != null)      this.values.set_scale  = Number(params.get('set_scale'))  ;
              if ( params.get('min_zero') != null)        this.values.min_zero  = Number( params.get('min_zero') ) ;
          }   
          // console.info("route this.values.group_populations " , this.values.group_populations ) ; 
      } , 

      /**
      * Build url api string and send it to dataviz
      * @param (object) list of parameters 
      * @return (string)
      */
      buildUrlApi : function( p ){    

          let error = false ; 
          let message_error = '' ; 

          let src_api = ( p.src_api == undefined ) ? 'data' : p.src_api ; 

          //depending on mode, force params
          // if ( p.mode == 'cancer' )
          // {
          //     this.values.group_populations = 1 ; 
          // }

          // bind sexes and types
          let sexes_str   = p.sexes ; 
          let types_str   = p.types ; 

          // bind populations values
          let populations_str = p.populations.join('_') ; 
          if ( this.values.group_populations == 1 ||
              ( p.mode == "cancer" && p.populations.length > 0 && this.values.group_populations == 0 ) )
              populations_str = '('+populations_str+')';

          // bind cancer site values
          let cancers_str = p.cancers ; 

          if ( p.cancers != undefined ){
              if ( p.group_cancers == 1 || p.mode == 'population')
                  cancers_str = '('+p.cancers.join('_')+')' ; 
              else if ( p.multiple_cancers == 1 )
                  cancers_str = p.cancers.join('_') ; 
              else
                  cancers_str = p.cancers[0] ; 

              // console.info(" => cancers_str ",p.group_cancers , p.muliple_cancers , p.cancers ,  cancers_str); 
              // if ( p.cancers.length > 1 && p.group_cancers == 1 ) ? '('+p.cancers.join('_')+')' : p.cancers.join('_') ; 
          }
          
          // force all cancers if cancer mode
          // if ( p.mode == 'cancer' ) cancers_str = 'all' ; 

          // years 
          let years_str   = (p.years != '' && p.years != undefined) ? '&years='+p.years.join('_') : '' ; 
          let cohort_str  = (p.cohort != undefined && p.cohort == 'cohort') ? '&cohort=1' : '' ;

          // let age_span_str =( p.mode == "age" ) ? '&age_span='+this.values.age_span.value:'';

          let age_span_str =( p.mode == "age" ) ? '&age_span='+this.values.age_span.value:'';

          // error messages
          if ( populations_str == '' && this.values.top_nb == undefined )
          {
              error = true ; 
              message_error = 'Please select at least one population';
          }

          if ( cancers_str == '')
          {
              error = true ; 
              message_error = 'Please select at least one cancer site';
          }

          // handler if error
          if ( error == true )
          {
              this.$bvToast.toast(message_error, {
                title: `Warning`,
                variant: 'warning',
                toaster : 'b-toaster-top-left',
                solid: true
              })
              this.$emit('emitNoData',this) ; 
              return false ; 
          
          }

          let  bool_top = false;

          if (this.values.top_nb != undefined) 
          {
              if (this.values.top_nb.value != undefined && this.values.top_nb.value != 'clear' && this.values.top_nb.value != '0')
              {
                  bool_top = true;
              }
          }

          let str_pred_year_base = '' ; 

          if ( this.values.year_base != undefined )
          {
              str_pred_year_base = '&year_base='+this.values.year_base.value ;
          }

          let str_pred_nb_period = '' ; 

          if ( this.values.pred_nb_period != '' )
          {
              str_pred_nb_period = '&nordpred_np='+this.values.pred_nb_period ;
          }

          let str_pred_recent = '' ; 
          if ( this.values.pred_recent != '' )
          {
              str_pred_recent = '&nordpred_recent='+this.values.pred_recent ;
          }
                      
          if (bool_top) {
              
              let all_pops = ( this.values.top_add & this.values.mode.value == 'population') ? '0' : populations_str ; 
              let all_cancers = ( this.values.top_add & this.values.mode.value == 'cancer') ? '0' : cancers_str ; 
              // let top_mode_str = ( this.values.mode.value == 'population' ) ? 

              let temp_group = this.values.top_nb.value.split('_')
              let top_key_str = ''
              let top_nb_str = ''
              let top_add = (!this.values.top_add)?'&top_add=1':''

              if (temp_group[0] == "key") 
              {
                  top_key_str = this.values.key
              }
              else  if (temp_group[0] == "eapc")
              {
                  top_key_str = 'asr_eapc'
              } 

              if (temp_group[2] == 'p') 
              {
                  top_nb_str = temp_group[1]
              }
              else if (temp_group[2] == "m") 
              {
                  top_nb_str = temp_group[1]*(-1)
              }

              // when top is requested with no populations (reset), ensure all_pops is not null to avoid crash app
              if ( all_pops == '' ) all_pops = '0' ;

              return  this.url_api +'/'+src_api+'/population/'+types_str+'/'+sexes_str+'/'+all_pops+'/'+all_cancers+'/?ages_group='+p.age_start+'_'+p.age_end+years_str+'&year_start='+p.year_start+'&year_end='+p.year_end+cohort_str+'&top_mode='+this.values.mode.value+'&top_key='+top_key_str+'&top_nb='+top_nb_str+top_add  ;

              
          }
          else
          {   
              if ( p.is_prediction == true )
              {
                  //  cancers_str = cancers_str.replace(')',''); // ??? 
                  // cancers_str = cancers_str.replace('(',''); // ??? 
                  
                  return  this.url_api +'/'+src_api+'/prediction/'+types_str+'/'+sexes_str+'/'+populations_str+'/'+cancers_str+'/?prediction_annual=1&ages_group='+p.age_start+'_'+p.age_end+str_pred_nb_period+str_pred_year_base+str_pred_recent ; 
              }
              else
              {
                  return  this.url_api +'/'+src_api+'/population/'+types_str+'/'+sexes_str+'/'+populations_str+'/'+cancers_str+'/?ages_group='+p.age_start+'_'+p.age_end+years_str+'&year_start='+p.year_start+'&year_end='+p.year_end+cohort_str+age_span_str; 
              }
          }

      }, 

      /**
      * Update routes after changing filter data
      * @param (no param)
      * @return (bool)
      */
      rewriteRoute : function(){

          // console.info("rewriteRoute ",this.values) ; 

          // if (this.values.multiple_populations == 0) this.values.populations = [this.values.populations[0]];  
          let query = {};
          let bool_reset = false 
          

          // inherit url params from params
          let uri     = window.location.search.substring(1); 
          let params  = new URLSearchParams(uri);

          // get value already in url
          for (let param of params) {

              if (param[0] == "reset" && param[1] == "1")
              {
                  bool_reset = true
              }

              let key_label = param[0];

              // I do not get when does it happend!
              if (typeof(this.values[key_label]) === 'object') // if is object
              {
                  // if is array
                  if (Array.isArray(this.values[key_label])) 
                  {
                       query[key_label] = this.values[key_label].join('_');
                  }
                  else // keep only value
                  {
                      query[key_label] = this.values[key_label].value;

                  }
              }
              else if (typeof(this.values[key_label]) == "boolean")
              { // type boolean
                  query[key_label] = Number(this.values[key_label]);

              }
              else 
              {
                  query[key_label] = this.values[key_label];
              }
              
          }

          if (bool_reset)
          {
              delete query['set_scale'];
              delete query['y_min'];
              delete query['y_max'];
              // delete query['scale'];
              delete query['min_zero'];

          }

          // console.info("A query",query) ; 
          if (this.prop_init_values.data != undefined && this.prop_init_values.data[this.values.data_version] != undefined )
          {
              Object.keys(this.prop_init_values.data[this.values.data_version]).forEach(d => {

                  this.prop_init_values[d] = this.prop_init_values.data[this.values.data_version][d];
              });
          }


          // console.info("before object keys",this.values.years_select) ; 
          // for each values different than default values, add to url params

          Object.keys(this.prop_init_values).forEach(d => { // values from json default

              // special for APC because values key in url different values key (jsut to make it complicated I guess)
              if ( d == 'apc')
              {
                  // intent: if APC defined, intent on pop cancer etc..
                  if ( this.values.apcs_url != undefined &&   this.values.apcs_url != "")
                  {
                      query['sexes'] = this.values.sexes;
                      query['types'] = this.values.types;
                      query['populations'] = this.values.populations.join('_');
                      query['cancers'] = this.values.cancers.join('_');
                      query[ d ] = this.values.apcs_url ;  

                  }
                  else 
                  {
                      delete query['apc'];

                  }
                  return ; 
              }

              // if is object
              if (typeof(this.values[d]) === 'object')
              {
                  
                  // if dynamic component
                  if ( this.prop_init_values[d].mode != undefined && this.prop_init_values[d].mode == 'dynamic')
                  {
                      // console.info("dynamic",d,this.values[d].current,this.prop_init_values[d].current)
                      //. console.info("A dynamic",d,this.values[d].current ,this.prop_init_values[d].default.value)
                      // specific to select 
                      if ( this.prop_init_values[d].component == 'FilterMultiselect' && this.values[d].current != undefined ){
                          if ( this.values[d].current.value != this.prop_init_values[d].default.value )
                          {
                              //console.info("B this.values[d].value.value",this.values[d].value) ; 
                              query[d] = this.values[d].current.value ;
                          }
                      }
                      else // basic case with key | value
                      {
                          if ( this.values[d].current != this.prop_init_values[d].default )
                          {
                              query[d] = this.values[d].current ;
                          }
                      }

                  }
                  // if is array
                  else if (Array.isArray(this.values[d])) 
                  {
                      // test if array different
                      if (this.values[d].length != this.prop_init_values[d].length) 
                      {
                          /*if ( d == 'years_available' ){
                              let y_start = (typeof(this.prop_init_values.years_available[0])=='object')?this.prop_init_values.years_available[0].value:this.prop_init_values.years_available[0];
                              let y_end = (typeof(this.prop_init_values.years_available[this.prop_init_values.years_available.length-1])=='object')?this.prop_init_values.years_available[this.prop_init_values.years_available.length-1].value:this.prop_init_values.years_available[this.prop_init_values.years_available.length-1];
                              query[d] = `${y_start}_${y_end}`;
                          }
                          else*/
                              query[d] = this.values[d].join('_');
                      }
                      else 
                      {
                          
                          for (var i = 0, l=this.values[d].length; i < l; i++) {
                              if (this.values[d][i] !==  this.prop_init_values[d][i])
                              {
                                  let q_years = this.values[d] ; 
                                  if ( d == 'years'){
                                      // console.info("this.values[d]",this.values[d][i],typeof(this.values[d][i])) ; 
                                      if ( typeof(this.values[d][i]) == 'object'){
                                          q_years = [] ;
                                          this.values[d].forEach((k)=>{
                                              if ( k.value != undefined )
                                                  q_years.push(k.value) ; 
                                          })
                                      }
                                  }
                                  query[d] = q_years.join('_');
                                  break;
                              }
                          }
                          
                      }
                  } // if no array but object, compare key:value
                  else if (this.values[d].value !== this.prop_init_values[d].value)
                  {
                      query[d] = this.values[d].value;
                  }
                  

              }
              else if (typeof(this.values[d]) == "boolean") // if boolean 
              { 
                  if (Number(this.values[d]) !== this.prop_init_values[d])
                  {
                       query[d] = Number(this.values[d]);
                  }
              }
              else if (this.values[d] !== this.prop_init_values[d])
              {
                  query[d] = this.values[d];
              }

          }); 

          // console.info("B query",this.values.cancers,query) ; 

          // if cumrisk change age remove intent on age

          if (this.values.bool_intent_age == 0)
          {
              delete query['age_start'];
              delete query['age_end'];

          }

          // if scale is not set, remove y_min and ymax_value
          if(this.values.set_scale == 0)
          {
              delete query['y_min'];
              delete query['y_max'];
          }

          let query_string = [] ; 

          // exclude top_nb 
          delete query.top_nb ; 

          // always push value of print
          if ( this.print == 1 ) query['print'] = this.print  ; 

          for ( var q in query ) 
          {
              if ( typeof(query[q]) == 'object'){
                  // console.log("q",q,Object.keys(query[q])) ; 
              }
              else
                  query_string.push( q+"="+query[q] ) ;
          }            

          // if( this.values.data_version != undefined ) query['data_version'] = this.values.data_version ;  
          // console.info("query_string",query_string);

          // rewrite only if query from is different from query to
          if( uri != query_string.join('&')  ) 
          {
              this.$router.push({ 'query' : query })  ; 
          }
          else
          {
              this.$router.push({ 'query' : query })  ; 
          }
          
          // set to input val
          // eslint-disable-next-line
          $('input[name="permalink"]').val( document.location.href ) ; 
      } , 

      /**
      * If no dataset return, then pop a toast
      * @param (object) data promise
      * @return (bool)
      */
      manageNoData : function( dataset ){

          let pop_toast = false ; 
          let list_values = [] ; 
          let html_message = '' ; 

          if ( Array.isArray(dataset) )
              list_values = dataset.map(d=>{ return d[this.values.key] ;  }) ; 
          
          //
          if (this.dictionnary.years_available == undefined || this.dictionnary.years_available.year_start === undefined)
          {
              html_message = '<p class="no_data"> There is no data for this selection</p>'
          }
          else
          {
              html_message = '<p class="no_data">For this selection data are available only</br>from ' + this.dictionnary.years_available.year_start + ' until '+ this.dictionnary.years_available.year_end +'</p>'
          }

          if ( list_values.length == 0 )
          {
              pop_toast = true ; 
              this.$bvToast.toast(`There is no data for this selection`, {
                title: `Error`,
                variant: 'danger',
                solid: true
              })

              // generic message on top of the graphic
              if ( this.$store.state.const.display_no_data_message != undefined && this.$store.state.const.display_no_data_message == true ){

                  // 
                  setTimeout(()=>{
                      $('.graphic')
                          .addClass('container_no_data')
                          .prepend(html_message)
                      ;

                  },50)
              }

              this.$emit('emitNoData',this) ; 
          }

          return pop_toast ; 
      } , 

      /**
      * Depending on sex, the list of cancer site should be filter accordingly
      * @param (no param)
      * @return (no return)
      */
      filterCancerSitesList : function(){

          let pop_toast = false ; 
          this.values.bool_reset_cancer = true ;
          
          if ( this.dictionnary.cancers_available.length > 0 ){
              this.dictionnary.cancers.map(cancer =>
              {   
                  cancer.$isDisabled = false;
                  if (!this.dictionnary.cancers_available.includes(cancer.cancer)) cancer.$isDisabled = true;
              });
          }



          this.dictionnary.cancers_list = this.dictionnary.cancers ; 
          this.dictionnary.cancers_list.sort((a,b) => (a.$isDisabled - b.$isDisabled) || (a.cancer_order - b.cancer_order)); 

          // specific message from view (for survival) 
          this.$emit('callCancerAvailableMessage',this) ;

          // console.info("this.$store.state.const.prevent_sex_specific",this.$store.state.const.prevent_sex_specific) ;

          if ( this.$store.state.const.prevent_sex_specific != undefined && this.$store.state.const.prevent_sex_specific == true ){

              let control = false ; 
              let cancer_info ; 

              this.values.cancers.forEach((cancer_id)=>{
                  cancer_info= this.dictionnary.cancers_list.find(c=>{
                      return c.cancer==cancer_id ; 
                  })
                  if ( cancer_info != undefined ) control = true ; 
              })
              
              // work for prop_sexes_multiple == 1
              if ( control == true )
              {   
                  // reset
                  this.values.disabled_males = false ; 
                  this.values.disabled_females = false ; 
                  // this.values.disabled_both = cancer_info.gender != 0 ; 

                  // disable if needed
                  if ( cancer_info.gender == 1 ) this.values.disabled_females = true ; 
                  if ( cancer_info.gender == 2 ) this.values.disabled_males =  true ; 

                  // force sexes specific 
                  /*if ( this.values.sexes != cancer_info.gender.toString() )
                  {
                      console.log("A this.values.sexes",this.values.sexes) ; 
                      this.values.sexes = cancer_info.gender.toString() ; 
                      console.log("B this.values.sexes",this.values.sexes) ; 
                  }*/
              }
          }
          
          // loop on selected cancer, and non- available - just mark them differently

          if (this.values.bool_reset_cancer)
          {
              // reset component if wrong selection
              if (!Array.isArray(this.values.cancer_select))
              { 
              // if single select
                  if (this.values.cancer_select.$isDisabled)
                  {
                      pop_toast = true ; 
                      this.values.cancers = [this.$store.state.const.data[this.values.data_version].all_cancers_id]; // reiniatilise to all sites
                  }
              }
              else 
              {
                  this.values.cancer_select.forEach(item => {
                      if (item.$isDisabled)
                      {
                          pop_toast = true ; 
                          var index = this.values.cancers.indexOf(item.cancer);
                          if (index !== -1) 
                          {
                              // avoid removing cancer but put a marker
                              this.values.cancers.splice(index, 1);
                          }
                      }
                  });

                  // reiniatilise to all sites
                  // console.info("///",this.values.cancers,this.$store.state.const.data,this.values.data_version);
                  if (this.values.cancers.length == 0) {
                      this.values.cancers = [this.$store.state.const.data[this.values.data_version].all_cancers_id] ; 

                      // console.info("this.values.cancers",this.values.cancers) ; 
                  }
              }

              // console.info(" pop_toast => " , pop_toast ) ; 
              if (pop_toast)
              {

                  this.values.cancer_select = this.dictionnary.cancers_list.filter((d) => {
                      return ( this.values.cancers.includes(d.cancer));
                  });

                  this.$bvToast.toast(`Cancer not available have been removed`, {
                    title: `Warning`,
                    variant: 'warning',
                    // toaster : 'b-toaster-top-left',
                    solid: true
                  })
                  this.$emit('emitNoData',this) ; 
              }
          }


      }, 

      /**
      * Set totals with multiselect labels
      * @param (no param)
      * @return (no return)
      */
      setTotalsMultiselect : function(){

          // set nb cancer sites selected intro a string
          this.values.nb_cancer_selected = ( this.values.cancer_select.length != undefined ) ? `(${this.values.cancer_select.length})` : '(1)' ;

          // set nb cancer sites selected intro a string
          this.values.nb_population_selected = ( this.values.population_select.length != undefined ) ? `(${this.values.population_select.length})` : '(1)' ;  
      } , 

      /**
      * For cancer site list, loop on it a instead of removing it, just higlight
      * @param (no param) 
      * @return (bool)
      */
      manageCurrentSelectedCancerList : function(){

          // console.info("manageCurrentSelectedCancerList",this.values.cancer_select,this.dictionnary.cancers_available) ; 

          let pop_toast = false ; 

          if ( this.values.cancer_select.length > 0 && this.dictionnary.cancers_available.length > 0  )
          {
              this.values.cancer_select.forEach(item => {
                  
                  var index = this.dictionnary.cancers_available.indexOf(item.cancer);
                  item.class = "tag_hide" ; 
                  if (index !== -1) item.class = "tag_show" ; 
              });
          }

          this.setTotalsMultiselect() ;

          return true ; 
      }, 

      /**
      * Hook on population list select
      * @param (no param) 
      * @return (bool)
      */
      manageCurrentSelectedPopulationList : function(){

          this.setTotalsMultiselect() ;

          return true ; 
      },

       /**
      * Depending on sex, the list of cancer site should be filter accordingly
      * @param (no param)
      * @return (no return)
      */
      filterPopulationList : function(){

          let pop_toast = false ; 

          // keep only country if overtime 
          this.dictionnary.populations = this.dictionnary.populations.filter((d) => {
                  return (d.grouping == "Countries");
              });
          
          this.dictionnary.populations.map(el =>
          {   
              el.$isDisabled = false;
              if (!this.dictionnary.populations_available.includes(el.country)) el.$isDisabled = true;
          });

          this.dictionnary.populations_list = this.dictionnary.populations ; 
          this.dictionnary.populations_list.sort((a,b) =>  (a.$isDisabled - b.$isDisabled) || (a.order - b.order)); 
         

          // this.values.population_select = this.dictionnary.populations_list.filter((d) => {
          //     return ( this.values.populations.includes(d.country));
          // });

          // this part was for updating countries, no need anymore
          if (Array.isArray(this.values.population_select))
          {   

              if (this.values.populations.length > 1)
              { 
                  this.values.population_select.forEach(item => {
                      if (item.$isDisabled)
                      {
                          pop_toast = true ; 
                          var index = this.values.populations.indexOf(item.country);
                          if (index !== -1) this.values.populations.splice(index, 1);
                      }
                  });
              }

          }

          if (pop_toast)
          {

              this.values.population_select = this.dictionnary.populations_list.filter((d) => {
                  return ( this.values.populations.includes(d.country));
              });

              this.$bvToast.toast(`Population not available have been removed`, {
                title: `Warning`,
                variant: 'warning',
                // toaster : 'b-toaster-top-left',
                solid: true
              })
              this.$emit('emitNoData',this) ; 
          }

          return pop_toast;

      }, 

      filterYearList : function(){
          
          let emit_stop = this.$emit('callAfterfilterYearList',this) ;
          if ( emit_stop == true ) return ; 
      }, 

      checkNotAvailable : function(data) {

          if (data.length > 0) {
              this.$emit('callWarningDataNotAvailable',this,data) ;
          }

      },

      filterAgeList : function(){

          this.values.options_ages_start.map(key => 
          {
              key.$isDisabled = false;
              if (key.value > this.values.ages[1] ) key.$isDisabled = true;
          });

          this.values.options_ages_end.map(key => 
          {
              key.$isDisabled = false;
              if (key.value < this.values.ages[0] ) key.$isDisabled = true;
          });

          this.values.slider_ages_dot_options = [{disabled:false},{disabled:false}] ;
          
          if ( this.values.key == 'cum_risk') {
              this.values.slider_ages_dot_options = [{disabled:true},{disabled:false}] ;
              // console.info("values.age_select[]",this.values.age_select) ;
              
              this.suffix.age_groups = 'Cumulative risk is expressed from age 0 years.' ; 

              /*this.$bvToast.toast( "Cumulative risk is expressed from age 0 years.", {
                title: `Warning`,
                variant: 'warning',
                toaster : 'b-toaster-top-right',
                solid: true
              })*/
          }
      }, 

      /**
      * Manage cohort while init and update
      * @param (bool) on init or not
      * @return (no return)
      */
      manageCohort : function( init ){

          // age by period   
          if ( this.values.cohort_rate == 0 ){
              this.values.cohort_by_states = [true, false, false] ;
              if ( this.values.cohort_by == 0 ) this.values.cohort_by = 1 ; 
              if ( this.values.cohort_by == 1 ){
                  this.values.cohort = 'cohort' ;
                  this.values.cohort_type = 'time' ;
              // age by cohort
              } else if ( this.values.cohort_by == 2 ){
                  this.values.cohort = 'cohort' ;
                  this.values.cohort_type = 'age' ;
              }

          // period by age
          } else if ( this.values.cohort_rate == 1 ){
              this.values.cohort_by_states = [false, true, true] ; 
              this.values.cohort_by = 0 ; 
              this.values.cohort = 'period' ;
              this.values.cohort_type = 'time' ;
          // cohort by age
          } else if ( this.values.cohort_rate == 2 ){
              this.values.cohort_by_states = [false, true, true] ; 
              this.values.cohort_by = 0 ; 
              this.values.cohort = 'cohort' ;
              this.values.cohort_type = 'age' ;
          }

          // if create mode, do not update
          if ( init != true ) this.update(); 
      },

      /**
      * Update dataviz when reaction to filter
      * @param (bool) rewrite or not routes with new query, by default: true
      * @return (bool)
      */
      updateAgeStart : function(){

          this.values.bool_intent_age = 1
          // console.log('test_start')
          if ( this.values.age_select[0].value > this.values.age_select[1].value )
          {
              this.values.age_select = [this.values.age_select[1],this.values.age_select[0]]; 
          }

          this.values.age_start = this.values.age_select[0].value
          this.$refs.slider_ages.setIndex([this.values.age_start,this.values.age_end]) ;
          this.update() ; 
      } , 

      updateAgeEnd : function(){

          // console.log('test_end')
          this.values.bool_intent_age = 1
          if ( this.values.age_select[0].value > this.values.age_select[1].value) 
          {
              this.values.age_select = [this.values.age_select[1],this.values.age_select[0]]; 
          }


          this.values.age_end = this.values.age_select[1].value
          this.$refs.slider_ages.setIndex([this.values.age_start,this.values.age_end]) ;
          this.update() ; 
      } , 

      updateAgeSpan : function(){

          this.update() ; 
      } , 


      updateSliderAge : function(){
          
          // console.log('test_range')
          this.values.bool_intent_age = 1
          this.values.age_select = [this.values.options_ages_start[this.values.ages[0]],this.values.options_ages_end[this.values.ages[1]]]; 
          this.update() ; 
      } , 

      updateSliderYear : function(){
          
          //this.values.age_select = [this.values.options_ages_start[this.values.ages[0]],this.values.options_ages_end[this.values.ages[1]]];
         if (!Array.isArray(this.values.years)) 
          {
              this.values.years = [this.values.years]

          }
          this.values.years_select = [{value:this.values.years[0]}, {value:this.values.years[1]}]
          this.update() ; 
      } ,

      /**
      * Update dataviz when reaction to filter
      * @param (no param) 
      * @return (bool)
      */
      updateYearUnique : function(){

          // console.info("new value",this.values.years_select.value);
          
          if ( this.values.single_select_multiple == true )
              this.values.years = this.values.years_select.map((y)=>y.value) ; 
          else
              this.values.years = [this.values.years_select.value];

          if (!Array.isArray(this.values.years)) 
          {
              this.values.years = [this.values.years]
          }  

          this.update() ; 

          this.$emit('callAfterUpdateYearUnique',this) ;
          
          if ( this.values.mode.value == 'cancer')
          {
              /*setTimeout(() => {
                  console.info("Fire!!!") ; 
                  this.values.years_select.value = 2010 ; 
              }, 1000 ) ;*/ 
          }
      } ,

      /**
      * Update dataviz when reaction to filter, specific to multiple
      * @param (no param)
      * @return (bool)
      */
      updateYearMultiple : function(){

          this.values.years_multiple = this.values.years_select_multiple.map((y)=>y.value) ; 

          this.update() ;
      },

      /**
      * Update dataviz when reaction to filter
      * @param (bool) rewrite or not routes with new query, by default: true
      * @return (bool)
      */
      updateYearBase : function(){

          //this.values.year_base = this.values.year_base.value ;
          this.update() ; 
      } ,

      updateYearPrediction : function(){

          //this.values.year_base = this.values.year_base.value ;
          this.update() ; 
      } ,


      updateYearStart : function(){
          
          this.values.years[0] = this.values.years_select[0].value;
          let emit_stop = this.$emit('callAfterUpdateYearStart',this) ;
          if ( emit_stop == true ) return ; 

          if ( Number(this.values.years[0]) > Number(this.values.years[1]) )
          {   
              this.values.years = [this.values.years[1],this.values.years[0]]; 
          }
          if (this.$refs.slider_years != undefined) this.$refs.slider_years.setValue([this.values.years[0], this.values.years[1]]) ;

          this.update() ; 
      } , 

      updateYearEnd : function(){

          this.values.years[1] = this.values.years_select[1].value;
          let emit_stop = this.$emit('callAfterUpdateYearEnd',this) ;
          if ( emit_stop == true ) return ; 

          if ( Number(this.values.years[0]) > Number(this.values.years[1]) )
          {   
              this.values.years = [this.values.years[1],this.values.years[0]]; 
          }

          if (this.$refs.slider_years != undefined) this.$refs.slider_years.setValue([this.values.years[0], this.values.years[1]]) ;

          this.update() ; 
      } , 

      //
      // Constant.year_available[1] -Constant.year_available[0]

      updateModeSelection : function(run_update = true)
      {               
          // console.info("A updateModeSelection",this.values.mode.value) ;
          this.$emit('callAfterUpdateModeSelection',this) ;

          if (run_update) this.update();
      },

      updateIndicatorSelection : function(){

          this.$emit('callBeforeUpdateIndicatorSelection',this) ;

          this.values.key = this.values.indicator_select.key;
          this.values.set_scale = 0;
          this.updateScale(); 
          this.update();
      },

      updateMobileMode : function(){

          
          this.values.mode = this.values.options_mode.find( v => v.value == this.values.mode_mobile )
          
          /*console.info("mode",this.values.options_mode,{
              value : this.values.mode.value , 
              label : this.values.mode.label
          });*/ 

          this.update();
      },

      updateMobileSelect : function(){

          this.$emit('callBeforeUpdateIndicatorSelection',this) ;

          // this.values.key = this.values.indicator_select.key ;
          this.values.set_scale = 0;
          this.updateScale(); 
          this.update();

      },

      updateMobilePopulation : function(){

          //this.values.populations = [this.values.populations] ; 
          // console.info("this.values.populations",this.values.populations[0]) ; 
          // this.values.populations = [this.values.populations[0]]
          this.update();
      },

      updateYearUniqueMobile : function(){

          //console.info("New values",this.values.years_mobile) ; 
          
          //this.values.years = [this.values.years_mobile] ; 

          //console.info("===>",this.values.years,this.values.years_mobile)
          this.update();

      },

      updateMobileCancer : function(){

          // force single select mobile
          // this.values.cancer_select.cancer = this.values.cancer_select[0].cancer ; 

          // this.updateCancerSelection();
          this.update();
      },

      updateAgeMobile : function ( type_age ){
          // console.info(" => " , this.values[type_age] , this.values.age_start , this.values.age_end ) 
          this.values.ages = [this.values.age_start,this.values.age_end] ;
          
          this.values.age_select = [ this.values.options_ages_start.find( a => a.value == this.values.age_start ) , this.values.options_ages_end.find( a => a.value == this.values.age_end ) ]

          /*this.values.age_select[0].label = this.values.options_ages_start.find( a => a.value == this.values.age_start ).label
          this.values.age_select[1].label = this.values.options_ages_end.find( a => a.value == this.values.age_end ).label ;*/ 
          this.update();
      },

      updateAgeRange : function(key_value='cum_risk', set_value=14, max_value=16, start_value_disabled=true)
      {
          if ( this.values.key == key_value )
          {
              if (this.values.age_end == this.prop_init_values['age_end']) 
              {
                this.values.age_end = set_value
                this.$refs.slider_ages.setIndex([this.values.age_start,this.values.age_end]) ;
                this.values.bool_intent_age = 0
              }

              if (start_value_disabled)
              {
                  if (this.values.age_start > 0) 
                  {
                      this.values.age_start = 0
                      this.$refs.slider_ages.setIndex([this.values.age_start,this.values.age_end]) ;
                      this.values.select_age_start_disabled = true;

                  }
              }

              this.values.slider_ages_max = max_value;
              

              this.values.options_ages_end = 
              [
                { value: 0, label: '4' },
                { value: 1, label: '9' },
                { value: 2, label: '14' },
                { value: 3, label: '19' },
                { value: 4, label: '24' },
                { value: 5, label: '29' },
                { value: 6, label: '34' },
                { value: 7, label: '39' },
                { value: 8, label: '44' },
                { value: 9, label: '49' },
                { value: 10, label: '54' },
                { value: 11, label: '59' },
                { value: 12, label: '64' },
                { value: 13, label: '69' },
                { value: 14, label: '74' },
                { value: 15, label: '79' },
                { value: 16, label: '84' }
              ]
          } 
          else 
          {   
              this.values.bool_intent_age = 1
              this.values.slider_ages_max = this.prop_init_values['age_end'];
              this.values.select_age_start_disabled = false;

              this.values.options_ages_end = 
              [
                { value: 0, label: '4' },
                { value: 1, label: '9' },
                { value: 2, label: '14' },
                { value: 3, label: '19' },
                { value: 4, label: '24' },
                { value: 5, label: '29' },
                { value: 6, label: '34' },
                { value: 7, label: '39' },
                { value: 8, label: '44' },
                { value: 9, label: '49' },
                { value: 10, label: '54' },
                { value: 11, label: '59' },
                { value: 12, label: '64' },
                { value: 13, label: '69' },
                { value: 14, label: '74' },
                { value: 15, label: '79' },
                { value: 16, label: '84' },
                { value: 17, label: '85+' }
              ]
          }

      },

      updateYearSelection : function(){

          if (!Array.isArray(this.values.years))
          {
              this.values.years = [this.values.years] 
          }

          this.update();
      },

      updatePopulationSelection : function(run_update = true){

          if (Array.isArray(this.values.population_select))
          {
              this.values.populations = this.values.population_select.map(d => d.country);
          }
          else 
          {
              this.values.populations = [this.values.population_select.country];
          }

          // reset predefined selection list
          this.values.population_groups = '' ;    

          this.setTotalsMultiselect() ; 

          this.update();
      }, 

      /**
      * Reset all selection of populations (which allow now to be empty)
      * @param (no param)
      * @return 
      */
      resetPopulations : function(){

          this.values.populations = [] ; 
          this.values.population_select = [] ;

          // this.update();
      }, 

      /**
      * Fire when remove a population in multiple list
      * @param (no param)
      * @return 
      */
      removePopulationSelection : function(){

          console.info("this.values.populations",this.values.populations) ; 

      } , 

      /**
      * Trigger event when selecting a population group & prepopulate populations list by group
      * ex: Continents -> Asia, America, Europe, Africa, Oceania
      * @param (no param)
      * @return (no return)
      */
      updatePopulationGroups : function(){



          if ( this.values.population_groups.country_code != [] )
          {   

              this.values.group_populations = 1
              this.values.multiple_populations = 1

              this.$emit('callPredefinedPopulationUpdate',this)


              this.values.populations = this.values.population_groups.country_code;
              this.values.population_select = this.dictionnary.populations.filter((d) => {
                  return ( this.values.populations.includes(d.country));
              });



              this.update();
          }

      } , 

      updateCancerSelection : function(){

          if (Array.isArray(this.values.cancer_select))
          {
              this.values.cancers = this.values.cancer_select.map(d => d.cancer);
          }
          else 
          {
              this.values.cancers = [this.values.cancer_select.cancer];
          }

          this.values.apc_cancer_list = this.values.cancers ; 

          this.$emit('callCancerSelectionUpdate',this)

          this.setTotalsMultiselect() ; 

          this.update();
      },


      updateCancerGroupButton : function(){

          if ( this.values.mode.value != 'cancer') {

              this.values.multiple_cancers = Number(this.values.group_cancers);
          }
          
          this.update();
      },

      updatePopulationGroupButton : function(){

          if ( this.values.mode.value != 'population' ) {

              this.values.multiple_populations = Number(this.values.group_populations);
          }
          
          this.update();
      },

      updateYearGroupButton : function(){

          // console.info("updateYearGroupButton",this.values.group_years) ; 

          if (this.values.group_years) 
          {
              this.values.multiple_years = 1;
              this.values.years = [this.values.years[0]-4,this.values.years[0]];
              this.values.years_select = [{value:this.values.years[0]}, {value:this.values.years[1]}]

          }
          else 
          {   
              this.values.multiple_years = 0;
              this.values.years = [this.values.years[1]];
              this.values.years_select = [{value:this.values.years[0]}]
              // console.log(this.values.years)
          }

          //this.values.multiple_years = Number(this.values.group_years);
          this.update();
      },

      /**
      * Handler on smoothing toggle
      * @param (no param)
      * @return (no return)
      */ 
      toggleSmoothing : function(){

          if( this.values.toggle_smoothing == 0 ) 
          {
              this.values.smoothing = 0 ; 
              this.update();
          }

      }, 

      checkColorMode : function( default_mode ){

          // console.info("checkColorMode");

          // doing stuff
          this.values.show_dash_types_legend = false ; 
          this.values.show_dash_sexes_legend = false ; 

          // active color blue and red 
          this.values.color_mode = ( default_mode == undefined ) ? "default" : default_mode ; 

          let array_types =  this.values.types.split('_');
          let array_sexes =  this.values.sexes.split('_');

          // console.info( " this.values.sortings " , this.values.sortings ) ; 
          
          // if more than one population
          if ( array_sexes.length > 1 && array_types.length > 1 ){

              // update population select mode
              // force population to be grouped amd cancer to be grouped
              // if (this.values.populations.length > 1) this.values.group_populations = 1; // @to check with mathieu
              
              // commented: @todo: to be checked for further projects.
              //if (this.values.cancers.length > 1) this.values.group_cancers = 1;


              // update population select mode
              this.values.population_select = this.dictionnary.populations.filter((d) => {
                  return ( this.values.populations.includes(d.country));
              });

              this.values.color_mode = "sexes" ; 
              this.values.show_dash_types_legend = true ;

          }
          // case only multiple sexes
          else if ( array_sexes.length > 1 && array_types.length == 1){

              this.values.color_mode = "sexes" ; 
              if (( this.values.populations.length > 1 && this.values.mode.value == 'population') || ( this.values.cancers.length > 1 && this.values.mode.value == 'cancer'))
              {

                  this.values.color_mode = "default" ;
                  this.values.show_dash_sexes_legend = true ; 
              }
          }
          // case only multiple types
          else if ( array_types.length > 1 && array_sexes.length == 1){

              // this.populations = [this.populations[0]] ; 
              this.values.color_mode = "types" ; 
              if (( this.values.populations.length > 1 && this.values.mode.value == 'population') || ( this.values.cancers.length > 1 && this.values.mode.value == 'cancer'))
              {
                  this.values.color_mode = "default" ;
                  this.values.show_dash_types_legend = true ; 
              }
          }

          // sortings lists


          // console.info( array_types , array_sexes , "this.values.color_mode" , this.values.color_mode ) ; 

      } , 

      buildTopList : function( dataset ){

   

        if (this.values.top_nb != undefined)
        {
           
           // console.info("this.values.top_nb",this.values.top_nb.value) ; 

          if ( this.values.top_nb.value != 'clear'  && this.values.top_nb.value != 0)
          {
            if ( this.values.mode.value == 'population' )
            {
              // console.info("=>",this.values.population_select,this.values.populations); 
              let updated_populations = d3.nest()
                .key(d=>d.country)
                .entries( dataset ) ;

              let population_ids = updated_populations.map(d=>Number(d.key)) ; 

              this.values.populations = population_ids ; 

              this.values.population_select = this.dictionnary.populations.filter((d) => {
                  return ( population_ids.includes(d.country));
              });

            }
            else if ( this.values.mode.value == 'cancer' )
            {
              let updated_cancers = d3.nest()
                .key(d=>d.cancer)
                .entries( dataset ) ;

              let cancers_ids = updated_cancers.map(d=>Number(d.key)) ; 

              this.values.cancers = cancers_ids ; 

              this.values.cancer_select = this.dictionnary.cancers.filter((d) => {
                  return ( cancers_ids.includes(d.cancer));
              });
            }

          this.rewriteRoute() ;   
          }



          // everytime reset top/bottom list
          this.values.top_nb = {"value":'0',"label":" "} ; 
        }


      } , 

      /**
      * Run update and go back to viz without calling remote
      * @param (string) component_name 
      * @return (no return)
      */
      updateRemoteless : function ( component_name ) {

          this.$store.commit('clearGraphicFootnote') ;

          // clear no data message if available
          $('.graphic.block').removeClass('container_no_data') ; 
          $('.graphic.block  p.no_data').remove() ;

          // first emit hook
          this.$emit('callBeforeUpdateFromDatavizFilter',this) ; 

          
          // update age range for cumulative risk (not for cohort plot)
          this.$emit('callUpdateAgeRange',this) ; 


          // update selectfilter state
          this.$emit('callUpdateRemotelessFilterState',this) ; 

          this.rewriteRoute();
          
          this.filterYearList();

          this.filterAgeList();

          // check color globally
          this.checkColorMode() ; 

          // then 
          this.$emit('callAfterUpdateRemotelessFromDatavizFilter',this,component_name) ; 

          // this.manageFootnote();
          this.updateTitle();

          // commit changes to store
          this.$store.commit('setFilters',this) ; 

          this.manageFootnote() ;

          // tell watch not to re-do update
          // this.filter_done = true ; 

          // @todo: change everywhere: force to rewrite if click on filter else, routes changes from reloading or prev/next browser buttons
          // if ( rewrite != false  ) 
          this.rewriteRoute() ; 
              
      } ,

      /**
      * Update dataviz when reaction to filter
      * @param (bool) rewrite or not routes with new query, by default: true
      * @return (bool)
      */
      update : function ( rewrite ) {

          this.$store.commit('clearGraphicFootnote') ;

          // clear no data message if available
          $('.graphic.block').removeClass('container_no_data') ; 
          $('.graphic.block  p.no_data').remove() ;


          // first emit hook
          this.$emit('callBeforeUpdateFromDatavizFilter',this) ; 

          let sexes_str   = this.values.sexes ; 
          let types_str   = this.values.types ; 
          let populations_str = this.values.populations.join('_') ; 
          if ( Number(this.values.group_populations) == 1) populations_str = '('+populations_str+')';
          let cancer_str = this.values.cancers.join('_') ; 
          if (  Number(this.values.group_cancers) == 1) cancer_str = '('+cancer_str+')';
          let year_str ;
          if ( this.values.years != undefined ) year_str= this.values.years.join('_') ; 
          
          let map_populations_str = '208_234_246_304_352_578_752'
          if (this.values.map_view_per == 'regions')
          {
              map_populations_str = '234_304_2080_2081_2082_2083_2084_2460_2461_2462_2463_2464_3520_3521_5780_5781_5782_5783_7520_7521_7522_7523_7524_7525';
          }

          if (this.$store.state.const.project_slug == "overtime") map_populations_str = this.values.populations.join('_');

          this.base_url_api = ( this.url_api_DICTIONNARY != undefined ) ? this.url_api_DICTIONNARY : this.url_api ;

          let promises = [] ; 
          let promises_name = [];

          if ( this.$store.state.const.check_availability == true )
          {

              if (sexes_str == "0" ) sexes_str = "1_2"

              let str_pop =  this.base_url_api +'/meta/availability/'+types_str+'/'+sexes_str+'/'
              let str_cancer =   this.base_url_api +'/meta/availability/'+types_str+'/'+sexes_str+'/'+populations_str+'/'


              if (this.prop_is_prediction == 1)

              {
                  str_pop = str_pop+'?prediction=1'
                  str_cancer = str_cancer+'?prediction=1'
              }

              if (this.prop_is_survival == 1)
              {
                  types_str = "3"
                  str_pop = this.base_url_api +'/meta/availability/'+types_str+'/'+sexes_str+'/'
                  str_cancer = this.base_url_api +'/meta/availability/'+types_str+'/'+sexes_str+'/'+populations_str+'/'
              }



              promises = [

                  // population available
                  str_pop,
              
                  // cancer_available
                  str_cancer,

                  // years available for maps
                  this.base_url_api +'/meta/availability/'+types_str+'/'+sexes_str+'/'+map_populations_str+'/'+ cancer_str+'/',

                  // years available general
                  this.base_url_api +'/meta/availability/'+types_str+'/'+sexes_str+'/'+populations_str+'/'+ cancer_str+'/',

                  // not available
                  this.base_url_api +'/meta/availability/'+types_str+'/'+sexes_str+'/'+populations_str+'/'+cancer_str+'/'+year_str+'/'
              ] ; 


              promises_name = ['populations_available', 'cancers_available', 'map_years_available', 'years_available', 'not_available'];



          }

          axios.all( promises.map(l => axios.get(l)) )

          .then( axios.spread(( ...responses ) => {
              
              responses.forEach((item, index) =>{

                  this.dictionnary[promises_name[index]] = item.data

              });

              if ( this.$store.state.const.check_availability == true )
              {
                  // check data available
                  this.checkNotAvailable(this.dictionnary.not_available);
              }

              if (this.$store.state.const.project_slug == "overtime")
              {
                  let bool_reset = this.filterPopulationList() ;
                  // console.log('test');
                  if (bool_reset) 
                  {
                      this.update()
                  }
                  else {
                      this.filterCancerSitesList() ;   
                  }

              } 
              else 
              {
                  this.filterCancerSitesList() ;   
              }

              this.manageCurrentSelectedCancerList() ;

              // console.info( "this.values.indicar",this.values.indicator_select.key,this.values.ages[1])
          
              // if ( this.values.indicator_select.key == 'cum_risk' && this.values.ages[1] >= 17)
              // {
              //     this.values.age_select[1] = 16 ;
              //     //this.values.ages[1] = 16 ;
              //     this.values.age_end = 16 ;
              //     this.$refs.slider_ages.setIndex([this.values.age_start,this.values.age_end]) ;
              //     // @todo: pop in a notification to inform why 85+ is forbidden for cum risk
              // }

              this.values.age_start = this.values.ages[0] ; 
              this.values.age_end = this.values.ages[1] ; 

              if ( this.values.smoothing > 0 ) 
              {
                  // eslint-disable-next-line
                  $('.point').addClass('shown') ;
              }
              else
              {
                  this.values.show_dots = 0
                  // eslint-disable-next-line   
                  $('.point').removeClass('shown') ;
              }

             

              // update age range for cumulative risk (not for cohort plot)
              this.$emit('callUpdateAgeRange',this) ; 


              // update selectfilter state
              this.$emit('callUpdateFilterState',this) ; 

              this.rewriteRoute();
              
              this.filterYearList();

              this.filterAgeList();

              // check color globally
              this.checkColorMode() ; 

              // if enabled, check apc list
              if ( this.prop_show_extra_tab == 1 )
              {
                  this.generateApcsList() ; 
                  this.updateApcAPI();
                  this.manageSimpleApc() ; 
              }

              // then 
              this.$emit('callAfterUpdateFromDatavizFilter',this) ; 

              // this.manageFootnote();
              this.updateTitle();

              // commit changes to store
              this.$store.commit('setFilters',this.values) ; 

              this.manageFootnote() ;

              // tell watch not to re-do update
              this.filter_done = true ; 

              // @todo: change everywhere: force to rewrite if click on filter else, routes changes from reloading or prev/next browser buttons
              if ( rewrite != false  ) this.rewriteRoute() ; 
          }));
              
      } , 

      /**
      * Update dataviz title based of filter
      * @param (no param)
      * @return (bool)
      */
      updateTitle : function() {

          let array_types =  this.values.types.split('_');
          let array_sexes =  this.values.sexes.split('_');

          let titles = {
              'titles' : {
                  'key'           : '' ,// this.values.key_title , // use in table 
                  'sex'           : '' , 
                  'type'          : '' , 
                  'cancer'        : '' , 
                  'population'    : '' , 
                  'ages'          : '' , 
                  'years'         : '' ,
                  'title_l1'      : '' ,
                  'title_l2'      : '' ,
                  'title_l3'      : ''

              }
          } ; 

          let label_survival = '' ;
          // key (need to store in values key_title, key_short_title)
          switch( this.values.key )
          {
              case 'asr' : 
                  /*this.values.key_title = ( this.$t('indicators.asr') != 'indicators.asr' ) ? this.$t('indicators.asr') : 'Age-Standardized Rate (World) per 100 000' ; 
                  this.values.key_short_title = ( this.$t('indicators.asr_short') != 'indicators.asr' ) ? this.$t('indicators.asr') : 'ASR (World) per 100 000' ;*/
                  this.values.key_title = 'Age-Standardized Rate (World) per 100 000' ; 
                  this.values.key_short_title = 'ASR (World) per 100 000' ; 
                  break ;  

              case 'asr_e' : 
                  this.values.key_title =  'Age-Standardized Rate (European) per 100 000' ; 
                  this.values.key_short_title = 'ASR (European) per 100 000' ; 
                  break ;  

              case 'asr_n' : 
                  this.values.key_title =  'Age-Standardized Rate (Nordic) per 100 000 ' ; 
                  this.values.key_short_title = 'ASR (Nordic) per 100 000 ' ; 
                  break ;     

              case 'crude_rate' : 
                  this.values.key_title = "Crude rate per 100 000" ; 
                  this.values.key_short_title = 'Crude rate per 100 000' ; 
                  break ;   

              case 'total' : 
                  // in thousands 
                  this.values.key_title = "Absolute numbers" ; 
                  this.values.key_short_title = 'Number' ; 
                  break ;

              case 'total_pop' : 
                  this.values.key_title = "Total population year" ; 
                  this.values.key_short_title = 'Total population year' ; 
                  break ;    

              case 'cum_risk' : 
                  this.values.key_title = "Cumulative risk (in percentage)" ; 
                  this.values.key_short_title = 'Cum. risk' ; 
                  break ;  

              case 'eapc' : 
                  this.values.key_title = "Estimated Annual Percentage Change" ; 
                  this.values.key_short_title = 'EAPC' ; 
                  break ;   

              case 'diff_vs_D0' : 
                  this.values.key_title = "Difference in numbers versus D0" ; 
                  this.values.key_short_title = 'Difference versus D0' ; 
                  break ;

              case 'diff_vs_S0' : 
                  this.values.key_title = "Difference in numbers versus S0" ; 
                  this.values.key_short_title = 'Difference versus S0' ; 
                  break ;
          
              case 'percent' : 
                  // in thousands 
                  this.values.key_title = "Percentage change" ; 
                  this.values.key_short_title = 'Percentage change' ; 
                  break ;
          }

         
          if ( Number(this.values.types) == 3)
          {
              this.values.key_title = `${this.values.survival}-year age-standardised relative survival (%)` ; 
              this.values.key_short_title = 'Relative survival ' + label_survival+', ' ;
          }



          titles.key = this.values.key_title;
          titles.short_key = this.values.key_short_title ;

          /*if ( this.values.top_nb != -1 )
          {
              if ( this.values.top_nb < -1 ) 
                  titles.key = `Flop ${Math.abs(this.values.top_nb)} ${titles.key}` ; 
              else
                  titles.key = `Top ${Math.abs(this.values.top_nb) } ${titles.key}` ; 
          }*/
          
          // eslint-disable-next-line
          // $('.y_title').text( this.values.key_title ) ; 

          // sex 
          var temp_array = [] ; 
          let label ; 
          for ( var s in array_sexes ){
              label = this.dictionnary.sexes_labels[ Number(array_sexes[s])] ; 
              if ( label != undefined ) temp_array.push(label) ; 
          }
          titles.sex = temp_array.join(' and ');


          // type 
          if ( Number(this.values.types) == 2)
          {
              titles.type = label_survival ;
          }
          else
          { 
              temp_array = [] ; 
              label ; 
              for ( var t in array_types ){
                  label = this.dictionnary.types_labels[ Number(array_types[t])] ; 
                  if ( label != undefined ) temp_array.push(label) ; 
              }
              titles.type = temp_array.join(' and ');
          }

          // cancer
          temp_array = [] ; 
          label ; 
          for ( var c in this.dictionnary.cancers_list ){
              for ( var ca in this.values.cancers )
              {
                  if ( this.dictionnary.cancers_list[c].id == Number(this.values.cancers[ca]) )
                  {
                      temp_array.push( this.dictionnary.cancers_list[c].label ) ; //+ ' cancer' ; 
                      break ; 
                  }
              }
          }
          titles.cancer =  temp_array.join(( this.values.group_cancers == 1 ) ? ' + ' : ' - ') ; 

          // init
          this.values.regional_footnote = false ; 


          // population 
          temp_array = [] ; 
          for ( var pop in this.dictionnary.populations_list ){
              // eslint-disable-next-line
              for (var p in this.values.populations ) 
              {
                  // eslint-disable-next-line
                  if ( Number(this.dictionnary.populations_list[pop].country) == Number(this.values.populations[p]) )
                  {
                      let asterix = '' ; 

                      if ( ( this.$store.state.const.label_regional != undefined && this.$store.state.const.label_regional == true ) && (this.dictionnary.populations_list[pop].bool_national == false ) && this.values.types != 1 ){
                          asterix = '*' ; 
                          this.values.regional_footnote = true ; 
                      }
                      
                      temp_array.push( `${this.dictionnary.populations_list[pop].label}${asterix}` ) ; 
                      break ; 
                  }
              }
          }
          titles.population = temp_array.join(( this.values.group_populations == 1 ) ? ' + ' : ' - ') ; 

          // ages 
          // console.info("this.values.age_select",this.values.age_select) ; 

          if ( this.values.age_start == 0 && this.values.age_end == 17 )
          {
              titles.ages = '' ; 
          }   
          else if ( this.values.age_select[0] != undefined )
          {   
              let age_str = 'age ' ; 
              if ( Number(this.values.types) == 3) age_str = 'age at diagnosis' ; 
              // eslint-disable-next-line
              titles.ages = `${age_str} [${this.values.age_select[0].label}-${this.values.age_select[1].label}]`;
          }


          // years (for now, years length = 3 is not possible, might evolve)
          if ( this.values.years != undefined)
          {
              if (this.values.years.length > 1)
              {
                  if ( this.values.years[0] == this.values.years[1])
                  {
                      titles.years = " in " +this.values.years[0] ; 
                  }
                  else
                  {
                      titles.years ='[' + this.values.years[0]+"-" +this.values.years[1] + ']' ; 
                  }
              }
              else 
              {
                  titles.years = " in " +this.values.years[0] ;     
              }
          }
          
          // lower case if needed (default is not)
          // waiting for localization of titles
          if ( process.env.VUE_APP_TITLE_LOWERCASE == true ){

              titles.sex = titles.sex.toLowerCase();
              titles.type = titles.type.toLowerCase();
              if ( titles.key != undefined ){
                  titles.key = titles.key.replace('Age-Standardized Rate','Age-standardized rate');
                  titles.key = titles.key.replace('Estimated Annual Percentage Change','Estimated annual percentage change');
              }
              //titles.key = titles.key.replace('Age-Standardized Rate','Age-standardized rate');
          }

          // default title l1,l2,l3  // can be udpdate in views

          // filter(Boolean) drop string = ''
          titles.title_l1 = [titles.key,titles.type,titles.sex,titles.ages, titles.years].filter(Boolean).join(', ');
          
          if (this.values.mode.value == 'population')
          {
              
              titles.title_l2 = titles.cancer
              titles.title_l3 = titles.population
          }  
          else {
              titles.title_l2 = titles.population
              titles.title_l3 = titles.cancer
          }  

          titles.title_svg = "" ; 


          // force svg to get id
          if ( this.$router.currentRoute.name != 'maps' && this.$router.currentRoute.name != 'population_pyramid') 
          {   
              setTimeout(() => {
                  
                  // specific to pred method
                  let suffix_ = ( this.$router.currentRoute.name.indexOf('prediction') != -1 ) ? `-${this.values.pred_method}` : '' ; 

                  titles.title_svg = slugify( titles.title_l1 + '-' + titles.title_l2  ) + suffix_ ;

                  $('.graphic svg').attr('id', titles.title_svg ) ;

                  // put current graphic title in store
                  this.$store.commit('setGraphic',{ title : titles });

              }, 750 ) ; 
              
          }
          
          return titles ;  
      } , 
      
      /**
      * Move array to obj/val array element
      * @return (object)
      */
      objectValues: function (obj) {
          var res = [];
          for (var i in obj) {
              if (obj.hasOwnProperty(i)) {
                  res.push(obj[i]);
              }
          }
          return res ;
      },

      /**
      * Build specific key for apcs list
      * @desc format is [type][sex]c[country_code]c[cancer_code]v[apc_value] 
      * @param (string) key of slider
      * @param (float) value of slider
      * @return (string)
      */
      buildApcKey : function( slider_key , slider_value ){

          return `${slider_key}v${slider_value}`; 
      }  , 

      /**
      * Build specific key for apcs list
      * @desc format is [type][sex]c[country_code]c[cancer_code]v[apc_value] 
      * @param (object) sex|type|country|cancer|value
      * @return (string)
      */
      buildApcSlider : function( obj ){

          return `${obj.type}${obj.sex}c${obj.country}c${obj.cancer}`; 
      }, 

      /**
      * Setter to force apcs list to work with a certain cancer sites list
      * once the func has been set, it means overiding should NOT be part of rewriting route in 3rd mode
      * @param (array) 
      * @return (array) 
      */
      setApcCancerlist : function( cancers ){

          this.values.overide_apc = true ; 
          this.values.apc_cancer_list = cancers ; 

      } ,

      /**
      * Generate an apcs list in array before building data, used by rest API
      * @param (no param) 
      * @return (array)
      */
      generateApcsList : function( ){

          // prevent from empty cancers list 
          if ( this.values.apc_cancer_list.length == 0 )
              this.values.apc_cancer_list = this.values.cancers ; 

          //console.info("this.values.apc_cancer_list",this.values.apc_cancer_list) ; 

          if ( this.prop_show_extra_tab == 1 )
          {
              

              let apcs_keys = [] , obj_ , types = [] , sexes = [] ;

              // init
              types = this.values.types.split('_') ; 
              sexes = this.values.sexes.split('_')  ;  

              if (sexes[0] == '0') 
              {
                  sexes[0] = 1
                  sexes[1] = 2
              }

              types.forEach( ( type ) => {
              
                  sexes.forEach( ( sex ) => {

                      this.values.populations.forEach( ( population ) => {
                  
                          this.values.apc_cancer_list.forEach( ( cancer )=>{

                              obj_ = {
                                  'type' : type , 
                                  'sex' : sex , 
                                  'country' : population, 
                                  'cancer' : cancer 
                              } ; 
                              apcs_keys.push( this.buildApcSlider(obj_) ) ; 
                          }) ; 

                      })

                  });

              }) ; 

              this.values.apcs_keys = apcs_keys 
          }
      } , 

      /**
      * Specific to APC tabs, triggered by end of calling rest API urls
      * @param (array) dataset from current dataviz
      * @param (object) d3 object
      * @return (bool)
      */

      manageSimpleApc : function(){

          let slider_ , slider_id , obj_ , apc_obj_ , apc_slider_  , apc_value_ , ids_groups , sub_groups , group , sub_g , d1 , d2 , d3 , d_pop , d_can , label , nb_sub_rows , color_ , apc_notes = [],entries_base = [], entries = [],temp_array = [], d_sex , d_type, border_style = 'solid' , extra_label = '' ; 

          this.values.apcs_dataset = [] ;
          this.values.apcs_textbox = [] ;
          this.values.apc_split_bool = [0,0,0,0]

          // detect intent to decide if show tab

          if (this.values.apcs_url != undefined && +this.values.apcs_url !== +this.values.apcs_url)
          {


              if (this.values.apcs_url.substring(0,3) == 'cat')
              {
                  

                  let apcs_url_ = this.values.apcs_url.substring(4)
                  let apc_array_ = apcs_url_.split('_')
                  apc_array_.forEach((key) => {
                      let d = key.split('v') ;
                      if (d[0].substring(0,1) == 's')
                      {
                          this.values.apc_split_bool[0] = 1
                      }
                      else if (d[0].substring(0,1) == 't')
                      {
                          this.values.apc_split_bool[1] = 1
                      }
                      else if (d[0].substring(0,2) == 'co')
                      {
                          this.values.apc_split_bool[2] = 1
                      }
                      else if (d[0].substring(0,1) == 'ca')
                      {
                          this.values.apc_split_bool[3] = 1
                      }
                      
                  })
              }
          }

          // define which apc tabs should be shown or not

          if (this.values.apc_split == 0 ) this.values.apc_split = 1

          entries_base = [
              [
                  {id: "male", label:"Male",value:1, apc_key:"s1", colors:Constant.colors_sexes[0]},
                  {id: "female", label:"Female",value:2, apc_key:"s2", colors:Constant.colors_sexes[1]}
              ],
              [
                  {id: "incidence", label:"Incidence",value:0, apc_key:"t0",colors:Constant.colors_types[0]},
                  {id: "mortality", label:"Mortality",value:1, apc_key:"t1", colors:Constant.colors_types[1]}
              ]
          ]

          if (this.values.sexes == '0' || this.values.sexes == '1_2')
          {
              this.values.apc_split_bool[0] = 1;
          }

          if (this.values.types == '0_1')
          {
              this.values.apc_split_bool[1] = 1;
          }

          if (this.values.populations.length > 1) this.values.apc_split_bool[2] = 1;

          if (this.values.apc_cancer_list.length > 1) this.values.apc_split_bool[3] = 1;

          if (this.values.apc_split_bool[Number(this.values.apc_split) - 1 ] == 0)
          {   
              this.values.apc_split = 0
              this.values.apc_split_bool.forEach(( item, index) =>{
                  if (item > 0) 
                  {
                      this.values.apc_split = index +1 
                  }

              })

          }

          if (this.values.apc_split == 0 && this.values.apc_custom1)
          {
               this.values.apc_custom1 = false
               this.values.apc_custom0 = true
          }


          if ( this.values.populations.length > 0 )
          {
              this.values.populations.forEach( ( pop ) => {
                  let temp = this.dictionnary.populations_list.filter((d) => {
                      return ( d.country == pop);
                  });

                  if ( temp[0] != undefined )
                  {
                      temp_array.push({
                          id: 'country' + pop,
                          label:temp[0].label,
                          value:pop,
                          apc_key:'co' + pop,
                          colors:temp[0].color
                      })
                  }
              })
          }

          entries_base.push(temp_array)


          temp_array = [];

          this.values.apc_cancer_list.forEach( ( cancer ) => {
              let temp = this.dictionnary.cancers_list.filter((d) => {
                  return ( d.cancer == cancer);
              });


              if ( temp[0] != undefined )
              {
                  temp_array.push({
                      id: 'cancer' + cancer,
                      label:temp[0].label,
                      value:cancer,
                      apc_key:'ca' + cancer,
                      colors:temp[0].color
                  })
              }

             
               

          })

          entries_base.push(temp_array)

          if (this.values.apc_custom1)
          {
              entries = entries_base[Number(this.values.apc_split) - 1 ]

              let cpt = 0 ; 
              entries.forEach( (k) => {

                  if ( color_ == undefined ) color_ = CanColors.bootstrap_colors[cpt] ;
                  color_  = k.colors;
                  apc_value_ = this.values.apcs_list[k.apc_key] ;

                  obj_ = { 
                      'key' : 'id' + k.id , 
                      'id'    : 'id' + k.id , // d.id
                      'label' : k.label ,
                      'extra_label' : k.label , 
                      'color' : color_ , 
                      'border_style' : border_style ,
                      'show_ui' : true ,
                      'sub_label' : '' , 
                      'key_slider' : k.apc_key , 
                      'value_slider' : ( apc_value_ != undefined) ? apc_value_ : 0 ,
                      'toggle' : false 
                  }

                  this.values.apcs_dataset.push( obj_ ) ;
                  cpt++ ; 
              })
          }
          else if (this.values.apc_custom2)
          {


              let entries = [] ; 

              this.values.apcs_keys.forEach( (key,i) => {

                  let d = key.split('c') ;

                  d_type =  Number(d[0][0]) ; 
                  d_sex =  Number(d[0][1]) ; 
                  
                  d_pop = Number(d[1]) ; 
                  d_can = Number(d[2]) ;

                  entries.push({
                      type : d_type , 
                      sex : d_sex , 
                      population : d_pop , 
                      cancer : d_can , 
                      apc_key : key
                  })

              });



              entries.forEach( (k) => {

                  let label = []
                  let sex_label = this.dictionnary.sexes_labels[k.sex]
                  let type_label = this.dictionnary.types_labels[k.type]
                  let temp = this.dictionnary.populations_list.filter((d) => {
                      return ( d.country == k.population);
                  });

                  let population_label = temp[0].label

                  temp = this.dictionnary.cancers_list.filter((d) => {
                      return ( d.cancer == k.cancer);
                  });

                  let cancer_label = temp[0].label

                  if (this.values.sexes == '0' || this.values.sexes == '1_2') label.push(sex_label);
                  if (this.values.types == '0_1') label.push(type_label);
                  if (this.values.populations.length > 1) label.push(population_label);
                  if (this.values.apc_cancer_list.length > 1) label.push(cancer_label);
                  if (label.length == 0) label.push(population_label);

                  let label_string = label.join(', ')

                  apc_value_ = this.values.apcs_specific[k.apc_key] ;

                  obj_ = { 
                          'key' : k.apc_key , 
                          'id'    : k.apc_key , // d.id
                          'label' : label_string ,
                          'key_textbox' : k.apc_key , 
                          'value' : ( apc_value_ != undefined) ? apc_value_ : 0 ,
                      }

                  this.values.apcs_textbox.push( obj_ ) ;

              });
          }
          // 3rd mode, combination of 
          else if (this.values.apc_custom3)
          {
              // prepare combination of apc
              let data_entries = [] ; 

              this.values.apc_combination.forEach( (k_,i)=>{
                  data_entries.push( entries_base[parseFloat(k_)])
              }); 

              if ( this.values.apc_combination.length == 1 )
              {
                  console.info("A") ; 
                  entries = entries_base[Number(this.values.apc_combination)-1]
                  // console.info("this.values.apc_combination",this.values.apc_combination) ; 
                  
                  let cpt = 0 ; 
                  entries.forEach( (k) => {

                      if ( color_ == undefined ) color_ = CanColors.bootstrap_colors[cpt] ;
                      color_  = k.colors;
                      apc_value_ = this.values.apcs_list[k.apc_key] ;
                      obj_ = { 
                          'key' : 'id' + k.id , 
                          'id'    : 'id' + k.id , // d.id
                          'label' : k.label ,
                          'extra_label' : k.label , 
                          'color' : color_ , 
                          'border_style' : border_style ,
                          'show_ui' : true ,
                          'sub_label' : '' , 
                          'key_slider' : k.apc_key , 
                          'value_slider' : ( apc_value_ != undefined) ? apc_value_ : 0 ,
                          'toggle' : false 
                      }
                      this.values.apcs_dataset.push( obj_ ) ;
                      cpt++ ; 
                  }) 
              }
              else
              {
                  console.info("B",this.values.apc_combination,entries_base) ; 
                  let entries_1 = [] , entries_2 = [] ; 

                  // hard coded for now (pop & )
                  if ( this.values.apc_combination[0] == 1 && this.values.apc_combination[1] == 3)
                  {
                      entries_1 = entries_base[2] ;
                      entries_2 = entries_base[0] ;
                  }
                  if ( this.values.apc_combination[0] == 2 && this.values.apc_combination[1] == 3)
                  {
                      // default
                      entries_1 = entries_base[2] ;
                      entries_2 = entries_base[1] ;
                  }

                  let cpt = 0 ; 
                  entries_1.forEach( (k) => {

                      entries_2.forEach( (m) => {
                          if ( color_ == undefined ) color_ = CanColors.bootstrap_colors[cpt] ;
                          color_  = k.colors;
                          apc_value_ = this.values.apcs_list[k.apc_key] ;
                          obj_ = { 
                              'key' : 'id' + k.id+'_'+m.id , 
                              'id'    : 'id' + k.id+'_'+m.id , // d.id
                              'label' : k.label+', '+m.label ,
                              'extra_label' : k.label+', '+m.label , 
                              'color' : color_ , 
                              'border_style' : border_style ,
                              'show_ui' : true ,
                              'sub_label' : '' , 
                              'key_slider' : k.apc_key , 
                              'value_slider' : ( apc_value_ != undefined) ? apc_value_ : 0 ,
                              'toggle' : false 
                          }
                          this.values.apcs_dataset.push( obj_ ) ;
                          cpt++ ; 
                      }) 
                  }) ;     
              }

              return ; 

                             
          }

      },

      /**
      * update apcs slider so all can sync with urls and viz
      * @param (no param) 
      * @return (no return)
      */

      ConvertApc : function (apc_mode)
      {

          if (apc_mode == 0)
          {   
              this.values.apcs_list = [];

              // update category selected by user
              if (this.values.apc_split == 1)
              {
                  if (this.values.sexes == '1' || this.values.sexes == '2')
                  {
                      this.values.apcs_list['s' + this.values.sexes] = this.values.apc
                  }
                  else 
                  {
                     this.values.apcs_list['s1'] = this.values.apc
                     this.values.apcs_list['s2'] = this.values.apc
                  }

              }
              else if (this.values.apc_split == 2)
              {
                  if (this.values.types == '0_1')
                  {
                      this.values.apcs_list['t0'] = this.values.apc
                      this.values.apcs_list['t1'] = this.values.apc
                  }
                  else 
                  {
                     this.values.apcs_list['t' + this.values.types] = this.values.apc
                  }
              }
              else if (this.values.apc_split == 3)
              {
                  this.values.populations.forEach( ( pop ) => {
                      this.values.apcs_list['co' + pop] = this.values.apc
                   })
              }
              else if (this.values.apc_split == 4)
              {
                  this.values.apc_cancer_list.forEach( ( cancer ) => {
                      this.values.apcs_list['ca' + cancer] = this.values.apc
                   })

              }
             
              // update specific array
              this.values.apcs_specific = {};
              
              this.values.apcs_keys.forEach((key, index) => {
                  this.values.apcs_specific[key] = this.values.apc
              })

          }
          


      },

      updateApcAPI : function()
      {
          let apc_val_ , apc_notes = [] , group , sub_g , d1 , d2 , d3 , d_pop , d_can, d_type, d_sex ; 

          // this.values.apcs_specific = {};
          if (this.values.apc_custom2)
          {

              // update array apc specific 
              const textbox_keys = Object.keys(this.$refs)
              textbox_keys.forEach((key, index) => {


                  if (this.values.apcs_keys.includes(key))
                  {
                      let temp_textbox = this.$refs[key]
                      if (temp_textbox != undefined && temp_textbox.length ==1)
                      {
                          apc_val_ = temp_textbox[0].value
                          this.values.apcs_specific[key] = apc_val_

                      }
                  }
              })


              // update url
              this.values.apcs_url = ''

              const temp_keys = Object.keys(this.values.apcs_specific)
              temp_keys.forEach((key, index) => {
                  if (this.values.apcs_specific[key] != 0)
                  {
                      this.values.apcs_url = this.values.apcs_url +'_'+ this.buildApcKey( key ,this.values.apcs_specific[key]);

                  }
                 
              })
              this.values.apcs_url = this.values.apcs_url.substring(1);

          }
          if (this.values.apc_custom1)
          {

              this.values.apcs_specific = {};
              let apc_keys = Object.keys(this.values.apcs_list)
              const slider_keys = Object.keys(this.$refs)
              slider_keys.forEach((key, index) => {

                  let temp_slider = this.$refs[key]
                  if (temp_slider != undefined && temp_slider.length ==1)
                  {
                      apc_val_ = temp_slider[0].getValue()
                      
                      if (apc_keys.includes(key))
                      {   
                          this.values.apcs_list[key] = apc_val_
                      }
                      else 
                      {   
                          if (apc_val_ != 0 )
                          {
                              let obj = {};
                              obj[key] = apc_val_;
                              this.values.apcs_list[key] = apc_val_;
                          }
                      }
                  }
              })
          

              // update url
              this.values.apcs_url = 'cat'
              apc_keys = Object.keys(this.values.apcs_list)


              apc_keys.forEach((key, index) => {
                  if ( Math.abs( this.values.apcs_list[key]) != 0)
                  {
                      this.values.apcs_url = this.values.apcs_url +'_'+ this.buildApcKey( key ,this.values.apcs_list[key]);
                  }
                 
                  
              })

              if (this.values.apcs_url == 'cat')  this.values.apcs_url = '';


              // update  age specific array
              this.values.apcs_keys.forEach((key, index) => {

                  let apc_val_ = 0;


                  d1 = key.split('c') ;
                  d_type =  't' +d1[0][0] ; 
                  d_sex =  's' + d1[0][1] ; 
                  d_pop = 'co' + d1[1] ; 
                  d_can = 'ca' + d1[2] ;

                  if (apc_keys.includes(d_type)) 
                  {
                      apc_val_ += this.values.apcs_list[d_type]
                  }

                  if (apc_keys.includes(d_sex)) 
                  {
                      apc_val_ += this.values.apcs_list[d_sex]
                  }

                  if (apc_keys.includes(d_pop))
                  {
                      apc_val_ += this.values.apcs_list[d_pop]
                  }

                  if (apc_keys.includes(d_can))
                  {
                      apc_val_ += this.values.apcs_list[d_can]
                  }

                  // avoid js .000001
                  this.values.apcs_specific[key] = Math.round(apc_val_ * 1000) / 1000


              })

          
          }
          if (this.values.apc_custom0)
          {

              // update url
              this.values.apcs_url = this.values.apc
              this.ConvertApc(0)
              // update category array
          }

          // Update API value and update footnote
          this.values.apcs = [];
          const temp_keys = Object.keys(this.values.apcs_specific)

          let bool_apc_simple = true 
          let apc_val_base  = this.values.apcs_specific[temp_keys[0]]; // 5

          // console.info("temp_keys",temp_keys) ; 

          temp_keys.forEach((key, index) => {

              if ( Math.abs( this.values.apcs_specific[key]) != 0)
              {
                  this.values.apcs.push( this.buildApcKey( key ,this.values.apcs_specific[key])) ; 
              }
              
              // manage footnotes
              let d = key.split('c') ;
              d_type =  Number(d[0][0]) ; 
              d_sex =  Number(d[0][1]) ; 
              d_pop = Number(d[1]) ; 
              d_can = Number(d[2]) ;

              let label = []
              let sex_label = this.dictionnary.sexes_labels[d_sex]
              let type_label = this.dictionnary.types_labels[d_type]
              let temp = this.dictionnary.populations_list.filter((d) => {
                  return ( d.country == d_pop);
              });

              if ( temp[0] == undefined ) return ; 
              

              let population_label = temp[0].label

              temp = this.dictionnary.cancers_list.filter((d) => {
                  return ( d.cancer == d_can);
              });

              // @todo perhaps not the perfect way better to drop from URL methink
              if (this.values.sexes == '1' & d_sex == 2) return;
              if (this.values.sexes == '2' & d_sex == 1) return;
              if ((this.values.type == '0' || this.values.types == '0') && d_type == 1) return;
              if ((this.values.type == '1' || this.values.types == '1') && d_type == 0) return;
              if (!this.values.populations.includes(d_pop)) return;   
              if (!this.values.apc_cancer_list.includes(d_can)) return;

              let cancer_label = temp[0].label


              if (this.values.sexes == '0' || this.values.sexes == '1_2') label.push(sex_label);
              if (this.values.types == '0_1') label.push(type_label);
              if (this.values.populations.length > 1) label.push(population_label);
              if (this.values.apc_cancer_list.length > 1) label.push(cancer_label);
              if (label.length == 0) label.push(population_label);

              let label_string = label.join(', ')

              if (this.values.apcs_specific[key] != apc_val_base) bool_apc_simple = false

              if ( Math.abs( this.values.apcs_specific[key]) != 0)
              {      
                  // avoid js .000001
                  let value_ = Math.round(this.values.apcs_specific[key] * 1000) / 1000
                  apc_notes.push( label_string + ': '+ value_ + '%') ; 
              }

          })

          if (bool_apc_simple && apc_notes.length > 1)
          {
              if (apc_val_base == 0)
              {
                  apc_notes = [];
              }
              else {
                  apc_notes = [apc_val_base + '%']
              }
          }

          bool_apc_simple  = true
          let temp_label_type = ''
          let apc_notes_2 = [];
          let label_string = ''

          if (this.values.apc_custom1)
          {   
              for (const [key, value] of Object.entries(this.values.apcs_list)) {

                  if ( Math.abs( value) != 0)
                  {
                      if (temp_label_type != '')
                      {   
                          if (key.replace(/\d+/,'') != temp_label_type) bool_apc_simple = false
                      }

                      temp_label_type = key.replace(/\d+/,'')
                      let temp_label_value = Number(key.replace(/[^0-9]+/,''))

                      if (temp_label_type == 's') 
                      {
                          if (this.values.sexes == '1' & temp_label_value == 2)  continue;
                          if (this.values.sexes == '2' & temp_label_value == 1)  continue;
                          label_string = this.dictionnary.sexes_labels[temp_label_value]
                      }
                      if (temp_label_type == 't') 
                      {
                          if (this.values.types == '0' & temp_label_value == 1)  continue;
                          if (this.values.types == '1' & temp_label_value == 0)  continue;
                          label_string = this.dictionnary.types_labels[temp_label_value]
                      }
                      if (temp_label_type == 'co') 
                      {   
                          if (!this.values.populations.includes(temp_label_value)) continue;
 
                          label_string = this.dictionnary.populations_list.filter((d) => {
                              return ( d.country == temp_label_value);
                          });

                     
                          label_string = label_string[0].label
                      }
                      if (temp_label_type == 'ca') 
                      {   
                          if (!this.values.apc_cancer_list.includes(temp_label_value)) continue;
                         
                          label_string =  this.dictionnary.cancers_list.filter((d) => {
                              return ( d.cancer == temp_label_value);
                          });


                          label_string = label_string[0].label
                      }

                      // avoid js .000001
                      apc_notes_2.push( label_string + ': '+  Math.round(value * 1000) / 1000 + '%') ; 

                  }

              }

              if (bool_apc_simple)
              {
                  apc_notes = apc_notes_2;
              }

          }

          this.values.apc_notes = '' ; 
          this.values.apc_notes_tooltip = undefined ; 

          // console.info("apc_notes",apc_notes) ; 

          if ( apc_notes.length > 0 )
          {
              // check length of APC
              if ( apc_notes.length < 10 )
              {
                  this.values.apc_notes = "Annual percentage change: " ; 
                  this.values.apc_notes = this.values.apc_notes + apc_notes.join('; ') ; 
              }
              else
              {
                  let marker = ( this.print == 1 ) ? '*' : '' ; 
                  // console.info("apc_notes",apc_notes) ; 
                  this.values.apc_notes = `Custom annual percentage changes have been applied ` + marker ; 
                  this.values.apc_notes_tooltip = apc_notes.join('; ') ; 

                  if ( this.values.apc_notes_tooltip.length > 2000 )
                  {
                      this.values.apc_notes_tooltip = "Annual percentage change: " + this.values.apc_notes_tooltip.slice(0,2000)+' ...' ; 
                  }
              }

          }   
      },


      updateApcs : function(){

          this.update();

          this.rewriteRoute(); 
      },

      /**
      * Select APC mode
      * - default is the global slider, one value/slider at a time
      * - 1 is APCS based on selection, sex, types, cancer or population, on "type" at a time
      * - 2 is APCS based on user's values, customizable by input fields
      * - 3 is a same as mode 1 but combination of 2 types at time
      * @param (int) 
      */
      updateApcCustom : function(apc_mode){   

          // console.info("updateApcCustom",apc_mode) ; 

          if (apc_mode == 1)
          {
              this.values.apc_custom2 = false
              if (this.values.apc_custom1)
              {
                  this.values.apc_custom0 = false
              }
              else
              {
                  this.values.apc_custom0 = true
              } 
          }
          else if (apc_mode == 2)
          {
              this.values.apc_custom1 = false
              if (this.values.apc_custom2)
              {
                  this.values.apc_custom0 = false
              }
              else
              {
                  this.values.apc_custom0 = true
              }
          }

          else if (apc_mode == 3)
          {
              this.values.apc_custom1 = false
              this.values.apc_custom2 = false
              if (this.values.apc_custom3)
              {
                  this.values.apc_custom0 = false
              }
              else
              {
                  this.values.apc_custom0 = true
              } 
          }

          // this.generateApcsList() ; 
          // this.manageSimpleApc();

          this.updateApcs()
          // this.rewriteRoute(); 
      } , 

      /**
      * Update APC mode 3, combination of indicators (Sex AND pop or type and pop ... )
      * @param (string) type of event
      * @return (bool)
      */
      updateApcCustomCombination : function(){

          this.values.apc_combination.forEach((key_,i) => {
              key_ = parseFloat(key_) ; // always manipulate integer
              this.values.apc_combination[i] = key_ ; 
          })
          this.values.apc_combination.sort((a, b) => a - b) ; 

          // clean from sexes
          /*if ( this.values.sexes.length == 1 ){
              if ( this.values.apc_combination.include( this.values.sexes[0] ) ) 
              {
                  // delete this.values.sexes
                  let idx = this.values.apc_combination.indexOf( this.values.sexes[0] ); 
                  console.info(idx) ; 
              }
          }*/

          // disable rest of input checkbox it at least 2 are checked
          if ( this.values.apc_combination.length == 2 )
          {
              $('input[name="apc_combination"]:not(:checked)').attr('disabled',true) ; 
          }
          /*else if ( this.values.apc_combination.length == 1 )
          {
              // lock all, prevent from having 0 apcs
              $('input[name="apc_combination"]').attr('disabled',true) ; 
          }*/
          else
          {
              $('input[name="apc_combination"]').attr('disabled',false) ; 
          }

          // force 3rd panel
          this.updateApcCustom(3) ; 

      }, 

      /**
      * Update shape of graphic (4/3 or full space)
      * @param (string) type of event
      * @return (bool)
      */
      updateShape : function () {

          // emit  
          this.$emit('callUpdateShapeFromDatavizFilter',this) ; 
          this.rewriteRoute() ; 
      } , 


      updateXscale : function () {

          // emit  
          this.$emit('callXscaleFromDatavizFilter',this) ; 
          this.rewriteRoute() ; 
      } ,

      /**
      * Update scale
      * @param (string) type of event
      * @return (bool)
      */
      updateScale : function (){

          if (this.values.scale == 'log') 
          {
              this.values.min_zero = 0;
              this.values.disabled_min_zero_prop = true;
              if (this.values.set_scale == 1)
              {
                  if (this.values.y_min == 0) 
                  {
                      this.values.set_scale = 0;
                  }
              } 
          }
          else 
          {
              this.values.min_zero = 1;
              this.values.disabled_min_zero_prop = false;
              this.values.y_min = 0;

              this.values.disabled_set_y_min = true;
              this.values.disabled_set_y_max = (this.values.set_scale==0);

          }

          
          this.$emit('callUpdateScaleFromDatavizFilter',this) ; 
          this.rewriteRoute() ; 
          
      } , 

      updateAxisY : function (){

          if (this.values.min_zero)
          {
              this.values.disabled_set_y_min = true;
              this.values.y_min = 0;
          }
          else {
               this.values.disabled_set_y_min = (this.values.set_scale==0);
               this.values.disabled_set_y_max = (this.values.set_scale==0);
          }

          // prevent y_min being negative
          if ( this.values.y_min < 0 ) 
          {
              this.values.y_min = 0 ; 

          }

          this.$emit('callUpdateScaleFromDatavizFilter',this) ; 
          this.rewriteRoute() ; 
      },

      EnableSetScale  : function (){


          if (this.values.min_zero)
          {
              this.values.disabled_set_y_min = true;
          }
          else {
               this.values.disabled_set_y_min = (this.values.set_scale==false);
               
          }
          this.values.disabled_set_y_max = (this.values.set_scale==false);

      
          this.$emit('callUpdateScaleFromDatavizFilter',this) ; 



          this.rewriteRoute() ; 
      },

      /**
      * Toggle update prediction mode
      * @param (no param)
      * @return (bool)
      */
      updatePredMethod : function(){

          this.update();

      }, 

      /**
      * Update map scale
      * @param (string) type of event
      * @return (bool)
      */
      updateMapScale : function (){

          this.$emit('callUpdateMapScaleFromDatavizFilter',this) ; 
          this.rewriteRoute() ; 
          
      } , 

      /**
      * Show dots through UI
      * @param (no param)
      * @return (no return)
      */
      showDots : function(){

          this.$emit('callUpdateShowDotsFromDatavizFilter',this) ; 
          this.rewriteRoute() ; 

      } ,

      /**
      * Set stroke width through 4 buttons
      * @param (no param)
      * @return (no return)
      */
      setStroke : function(){

          this.$emit('callSetStrokeFromDatavizFilter',this) ; 
          this.rewriteRoute() ; 

      } , 

      /**
      * Update slider nb colors (for map)
      * @param (no param)
      * @return (no return)
      */
      updateNbColors : function(){

          this.$emit('callUpdateNbColorsFromDatavizFilter',this) ; 
          this.filter_done = true ; 
          this.rewriteRoute() ; 

      } , 

      /**
      * Set new color from d3 chromatic palette
      * @param (boolean) rewrite route or not default: true
      * @return (no return)
      */
      changeColor : function( rewriteRoute ){

          console.info("changeColor",this.values.palette)
          this.$emit('callClickChangeColorFromDatavizFilter',this) ; 
          // if ( rewriteRoute != false ) 
          this.rewriteRoute() ; 

      } , 

      /**
      * Change view mode regions|countries
      * @param (no param) 
      * @return (no return)
      */
      changeViewMap : function(){

          this.update(); // bourrin quand meme
          this.$emit('callChangeViewMapFromDatavizFilter',this) ; 
          //this.filter_done = false ; 
          this.rewriteRoute() ; 

      }, 

      /**
      * Change map projections (@todo: move it to dictionnary)
      * @param (no param) 
      * @return (no return)
      */
      updateMapProjection : function(){

          this.$emit('callChangeMapProjectionFromDatavizFilter',this) ; 

      }, 

      /**
      * Lock scale (either x, y or whatever need): emit hook to be catched in specific viz
      * @param (no param) 
      * @return (no return)
      */
      updateLockScale : function(){

          this.$emit('callLockScaleFromDatavizFilter',this) ; 
          this.update();
      }, 

      /**
      * Update round numbers with significant digits
      * @param (no param) 
      * @return (no return)
      */
      updateRoundNumbers : function(){

          this.$emit('callRoundNumbersFromDatavizFilter',this) ; 
          this.update();
      }, 

      

      /**
      * updateLabelPosition specific for dual bars
      * @param (no param) 
      * @return (no return)
      */
      updateLabelPosition : function(){

          this.$emit('callUpdateLabelPositionFromDatavizFilter',this) ; 
          this.rewriteRoute();
      } , 

      /**
      * updateValuesPosition specific for bar values
      * @param (no param) 
      * @return (no return)
      */
      updateValuesPosition : function(){

          this.$emit('callUpdateValuesPositionFromDatavizFilter',this) ; 
          this.update();
      } , 

      /**
      * updateColor can be used for any viz assuming 0, 1 or 2 etc are meaningfull
      * @param (no param) 
      * @return (no return)
      */
      updateColor : function(){

          this.$emit('callUpdateColorFromDatavizFilter',this) ; 
          this.update();
      } , 
      
      /**
      * updateColor can be used for any viz assuming 0, 1 or 2 etc are meaningfull
      * @param (no param) 
      * @return (no return)
      */
      updateSymbol : function(){

          this.$emit('callUpdateSymbolFromDatavizFilter',this) ; 
      
      } , 

      /**
      * update show areas 
      * @param (no param) 
      * @return (no return)
      */
      updateShowArea : function(){

          this.update() ; 
      }, 

      /**
      * update bar mode
      * @param (no param) 
      * @return (no return)
      */
      updateBarMode : function(){

          this.$emit('callUpdateBarModeFromDatavizFilter',this) ; 
          this.update() ; 
      }, 

      /**
      * getSymbolUrl
      * @param (no param) 
      * @return (no return)
      */
      getSymbolUrl : function(pic) {
          return require('../assets/img/symbols/'+pic+'.png') ; 
      } , 

      /**
      * updateUncertaintyLimits fire hook on update uncertainty limits
      * @param (no param) 
      * @return (no return)
      */
      updateUncertaintyLimits : function(){

          this.$emit('callUpdateUncertaintyLimitsFromDatavizFilter',this) ; 
          this.rewriteRoute() ; 
      } ,


      /**
      * updateSlider fire hook on update slider
      * @param (no param) 
      * @return (no return)
      */
      updateSlider : function( name_slider ){
      
          this.$emit('callUpdateSlider',this,) ; 
          this.rewriteRoute() ; 
      
      } ,

      /**
      * updateTopX
      * @param (no param) 
      * @return (no return)
      */
      updateTopNb : function(){
          
          if (this.values.top_nb.value == 'clear')
          {
              if ( this.values.mode.value == 'population' )
              {
                  this.values.populations = [this.values.populations[0]];
                  this.values.population_select = this.dictionnary.populations.filter((d) => 
                  {
                      return ( this.values.populations.includes(d.country));
                  });
              }
              else if ( this.values.mode.value == 'cancer' )
              {   
                  this.values.cancers = [this.values.cancers[0]];
                  this.values.cancer_select = this.dictionnary.cancers.filter((d) => 
                  {
                      return ( this.values.cancers.includes(d.cancer));
                  });
              }
          }

          $('#loader').css('display','block');
          $('#trend-container svg').css('opacity',0.3) ;

          this.update();
      } ,

      /**
      * updatePeriod fire hook on update uncertainty limits
      * @param (no param) 
      * @return (no return)
      */
      updatePeriod : function(){

          // this.$emit('callUpdatePeriodFromDatavizFilter',this) ; 
          this.update() ; 
      }, 

      /**
      * updateSurvivalAges fire hook on update uncertainty limits
      * @param (no param) 
      * @return (no return)
      */
      updateSurvivalAges : function(){

          this.$emit('callUpdateSurvivalAgesFromDatavizFilter',this) ; 
          this.update() ; 

      }, 

      /**
      * updatePredNbPeriod fire hook on update 
      * @param (no param) 
      * @return (no return)
      */
      updatePredNbPeriod  : function(){

          this.update() ; 

      } ,

      /**
      * updatePredRecent fire hook on update 
      * @param (no param) 
      * @return (no return)
      */
      updatePredRecent: function(){

          this.update() ; 

      } ,

      changeVersionForce: function(){

          this.values.data_version = this.data_version_tmp ;

          let uri     = window.location ; 
          this.current_route = this.$router.currentRoute.name ;
      
          document.location.href = window.location.pathname+'?data_version='+this.values.data_version ; 

      } ,     

      /**
      * Simple temporary database version switcher (mode smooth, update dataviz with reloading)
      * @param (no param)
      * @returrn (no return)
      */
      changeVersion : function(){
          
          this.values.data_version = this.data_version_tmp ; 

          let url_api = process.env.VUE_APP_API ; 
          let dbv = $(`select#version_switcher option:selected`).text() ; 
          let dbv_label = dbv.replace('.','') ; 

          this.url_api = url_api.replace('[vdb]',this.values.data_version) ; 

          let promises = [
              // cancer site list 
              axios.get( this.url_api + 'meta/cancers/all/' )
          ] ; 

          axios.all( promises )

          //.then( axios.spread(( both_inc , males_inc , females_inc , both_mort , males_mort , females_mort ) => {
          .then( axios.spread(( cancers_promise ) => {

              // fixed list non updated
              // eslint-disable-next-line
              this.dictionnary.cancers = clone_array(cancers_promise.data) ;
              this.dictionnary.cancers_list = this.dictionnary.cancers ; 

              // update cancer site
              let new_cancer_sites = [] ; 

              let c_old = (this.values.data_version==82)?'90':'82';
              let c_new = (this.values.data_version==82)?'82':'90';
              this.values.cancers.forEach( (can)=>{
                  let c_ = Constant.cancer_codes.find((c)=>can ==c[`v${c_old}_code`])
                  if ( c_ != undefined ) new_cancer_sites.push( c_[`v${c_new}_code`] )
              }) ; 

              this.values.cancers = new_cancer_sites  ;   

              this.update();

              // this.$emit('callAfterUpdateFromDatavizFilter',this) ; 

              $('span#dbv').text( $(`select#version_switcher option:selected`).text() ) ; 

          }))
          // eslint-disable-next-line
          .catch( error => {
              console.error("Error catched",error) ; 
              this.error = true
          })
          .finally(() => {
          })

          // return ;

          // cuold drop cancer code ?
          //document.location.href = window.location.pathname + '?data_version='+this.values.data_version + '&' + window.location.search.substring(1)  ;
      },

      updateApiCache : function(request, dataset) {

          let new_cache_request = {};

          new_cache_request.url = request;
          new_cache_request.dataset = dataset;
          new_cache_request.sexes = this.values.sexes;
          new_cache_request.types = this.values.types;
          if (this.values.survival != undefined) new_cache_request.survival = this.values.survival;
          new_cache_request.populations = this.values.populations;
          new_cache_request.group_populations = this.values.group_populations;
          new_cache_request.cancers = this.values.cancers;
          new_cache_request.group_cancers = this.values.group_cancers;

          this.api_cache.push(new_cache_request);

          if (this.api_cache.length > 100) this.api_cache.shift();

      },

      /**
      * @param () : request
      * @param () : project
      * @param () : substring
      * @param () : view
      * @param (string) mode : create (default) | update
      *
      */
      apiRequest : function(request,project, substring,view,mode="create")
      {

          if (this.website_is_static)
          {
              let cache_folder = "/api/cache_limited/"+ project + '/' 
              if ( process.env.VUE_API_STATIC_HOST ) cache_folder = process.env.VUE_API_STATIC_HOST + cache_folder ; 

              let cachefile = this.getCachedLimitedFile(request,project, true);
              
              axios.get(cache_folder+'md5list_'+substring+'.json')
                .then( response => {
                  // handle success

                  const regex0 = /.+\/(.+?)\.json/;
                  let cachefile_md5 = cachefile.map(x => x.replace(regex0, '$1'))
                  const bool_cache_limited = cachefile_md5.every(r=> response.data.indexOf(r) >= 0)
                  
                  if (bool_cache_limited)
                  {

                      this.staticAPIRequest(cachefile,view,mode)

                  }
                  else
                  {
                      this.dynamicAPIRequest(request,view,mode)

                  }


                })
                .catch(error => {
                  console.log(error);
                })
                .then(function () {
                });
            }
            else
            {
              this.dynamicAPIRequest(request,view,mode)

            }

      },

      /**
      * @param()
      * @param()
      */
      staticAPIRequest: function(request, view, mode)
      {
          axios.all( request.map(l => axios.get(l)))

          .then( axios.spread( (...data_promise) => {

              data_promise = this.getDataPromise(data_promise, true);

                // view.data_promise = data_promise.data.dataset ; 
              this.updateApiCache(request, data_promise.data)
              // view.createAfterAPIRequest(data_promise.data, this)

              if ( mode == "create")
                  view.createAfterAPIRequest(data_promise.data, this)
              else
                  view.updateAfterAPIRequest(data_promise.data, this) ;

          }))
          // eslint-disable-next-line
          .catch( error => {
              console.error(" Error after updating dataviz" , error ) 
              this.error = true
          })
          .finally(() => this.loading = false )

      },

      dynamicAPIRequest: function(request, view,mode)
      {

          if (this.source !== undefined)
          {
            this.source.cancel('new request');
          }

          const CancelToken = axios.CancelToken;
          this.source = CancelToken.source();

          // dataset
          axios.all([ axios.get( request ,{
                  cancelToken: this.source.token
              }) ])

          .then( axios.spread(( data_promise ) => {

              // view.data_promise = data_promise.data.dataset ;
              this.updateApiCache(request, data_promise.data)

              if ( mode == "create")
                  view.createAfterAPIRequest(data_promise.data, this)
              else
                  view.updateAfterAPIRequest(data_promise.data, this) ;

          }))
          // eslint-disable-next-line
          .catch( error => {
              // console.error(" Error after updating dataviz" , error ) 
              this.error = true
          })
          .finally(() => this.loading = false )

      },



      

      getCachedLimitedFile: function(request,project, explode=true)
      {

          let cache_folder = "/api/cache_limited/"+ project + '/' 
          if ( process.env.VUE_API_STATIC_HOST ) cache_folder = process.env.VUE_API_STATIC_HOST + cache_folder ; 

          const regex0 = /.+?api\/.+?\/(.*)(\?.*)?/;
          let temp_request = request.replace(regex0, '$1$2')
          let cache_file = cache_folder+md5(temp_request)+'.json'

          if (explode)
          {   
              const regex1 = /(.*\/).+?\/.+?\/.+?\/.+?\/(\?.*)?/;
              let path_request = temp_request.replace(regex1, '$1')
              let query_request = temp_request.replace(regex1, '$2')
              let temp_sex = this.values.sexes.split('_')
              let temp_type = this.values.types.split('_')
              let array_cache_file = []

              temp_type.forEach(item_type =>
              {
                  temp_sex.forEach(item_sex =>
                  {
                      this.values.populations.forEach(item_pop =>
                      {
                          this.values.cancers.forEach(item_cancer =>
                          {
                              let temp_file = path_request
                                  + item_type+ '/'
                                  + item_sex+ '/'
                                  + item_pop+ '/'
                                  + item_cancer+ '/'
                                  + query_request

                              array_cache_file.push(cache_folder+md5(temp_file)+'.json')

                          })
                      })
                  })
              }) 

              cache_file = array_cache_file



          }


           return(cache_file )

      },

      


      getDataPromise : function(array_promises, bool_prediction=false)
      {

          let data_promise = {};
          let data = {};
          let dataset = [];
          let extra = [];
          for (const [key, value] of Object.entries(array_promises)) {

            value.data.dataset.forEach(item =>
            {
              dataset.push(item)
            })

            if (bool_prediction)
            {


                value.data.extra.forEach(item =>
                {

                  let bool_new = true
                  let i = 0 
                  extra.forEach(function(item2, index) 
                  {
                      if (item2.type == item.type && item2.year == item.year)
                          {
                              bool_new = false
                              i = index
                          }
                  })

                  if (bool_new)
                  {
                      extra.push(item)
                  }
                  else 
                  {

                      extra[i]['cases_pred'] += item['cases_pred']
                      extra[i]['pop'] += item['pop']
                      extra[i]['cases_base'] += item['cases_base']
                      extra[i]['change'] = extra[i]['cases_pred'] - extra[i]['cases_base']
                      extra[i]['percent'] = (extra[i]['change']/extra[i]['cases_base'])*100
                      extra[i]['population']['cases'] = extra[i]['cases_pred']
                      extra[i]['population']['change'] = extra[i]['change']
                      extra[i]['population']['percent'] = extra[i]['percent']


                  }

                  // extra.push(temp)
              })

            }

          }

          data['dataset'] = dataset
          data['extra'] = extra
          data['error'] = []

          data_promise['data'] = data

          return(data_promise)

      },

      isDataCached : function(request, check_included=true)
      {


        let filter_data={update: true, sexes:false, types:false, populations:false, cancers:false, api_cache_id:0}

        for (let i = 0; i < this.api_cache.length; i++) 
        {

          let bool_temp = false; // considering no update needed
          if (!check_included) 
          {
            bool_temp = this.api_cache[i].url != request;
          }
          else 
          {

            if (this.api_cache[i].url != request)
            {   


              // COMPARE URL ending 
              let regexp_end = /.+(\/\??.*)$/;
              if (request.match(regexp_end)[1] != this.api_cache[i].url.match(regexp_end)[1])
              {
                bool_temp = true 
              }
              else 
              {

                if (this.values.survival != undefined)
                {
                    if (this.values.survival != this.api_cache[i].survival) bool_temp = true 
                }
                if (this.api_cache[i].sexes != this.values.sexes)
                {
                  if (this.api_cache[i].sexes.includes(this.values.sexes))
                  {
                    filter_data.sexes=true;
                  }
                  else
                  {
                    bool_temp = true 
                  }

                }

                if (this.api_cache[i].types != this.values.types)
                {
                  if (this.api_cache[i].types.includes(this.values.types))
                  {
                    filter_data.types=true;
                  }
                  else
                  {
                    bool_temp = true 
                  }

                }

                if (this.api_cache[i].populations != this.values.populations ||
                    this.api_cache[i].group_populations != this.values.group_populations
                )
                {
                  if (this.api_cache[i].group_populations == 1 || this.values.group_populations == 1)
                  {
                    bool_temp = true 
                  }
                  else
                  {
                    if (this.values.populations.every(v=> this.api_cache[i].populations.indexOf(v) !== -1))
                    {
                      filter_data.populations=true;
                    }
                    else 
                    {
                      bool_temp = true 
                    }
                  }

                }

                if (this.api_cache[i].cancers != this.values.cancers ||
                    this.api_cache[i].group_cancers != this.values.group_cancers
                )
                {

                  if (this.api_cache[i].group_cancers == 1 || this.values.group_cancers == 1)
                  {
                    bool_temp = true 
                  }
                  else
                  {
                    if (this.values.cancers.every(v=> this.api_cache[i].cancers.indexOf(v) !== -1))
                    {
                      filter_data.cancers=true;
                    }
                    else 
                    {
                      bool_temp = true 
                    }
                  }
                }
              }
            }


          }
          
          if (bool_temp)
          {
            filter_data.sexes=false;
            filter_data.types=false;
            filter_data.populations=false;
            filter_data.cancers=false;
          }
          else
          {
            filter_data.update = false
            filter_data.api_cache_id = i;
            break;
          }
        }

        return(filter_data);

      }, 

      filterDataCached : function(filter_data)
      {

          let dataset_filter = this.api_cache[filter_data.api_cache_id].dataset;

          let temp = dataset_filter 

          if (Object.keys(dataset_filter).includes('dataset')) temp = dataset_filter.dataset 
          
          if (filter_data.sexes) temp = temp.filter(item => this.values.sexes.split("_").includes(item.sex.toString()))
          if (filter_data.types) temp = temp.filter(item => this.values.types.split("_").includes(item.type.toString()))
          if (filter_data.populations) temp = temp.filter(item => this.values.populations.includes(Number(item.id)))
          if (filter_data.cancers) temp = temp.filter(item => this.values.cancers.includes(Number(item.cancer)))

          if (Object.keys(dataset_filter).includes('dataset'))
          {
              dataset_filter.dataset = temp
          }
          else
          {
              dataset_filter= temp
          }

          return(dataset_filter)
      },

      /**
      * Programmaticaly open method tab
      * @param (no param)
      * @return (no return)
      **/
      openMethodTab : function(){



      }     
  }
}

Vue.use(TabsPlugin)
Vue.use(ToastPlugin)

</script>

<style src="vue-multiselect/dist/vue-multiselect.min.css"></style>
<style lang="scss">

  $blue : #0b80b7 ; 
  $orange : #ffa147 ; 

  a{
      color: $blue ; 
  }

  select#version_switcher{
      position: fixed;
      left: 0;
      bottom : 30px;
  }

  form{

      font-size: 1em ; 

      #re-rendering{
          display: none ; 
      }

      .multiselect {
          border: 1px solid #d0d0d0;
          min-height  : 0px;

          .multiselect__placeholder {
              margin-bottom: 7px;
              padding-top: 7px;
          }
      }

      .multiselect.range_year_unique {

          float: left ;
          margin: 35px 0 0 0 ; 
          display: block ; 
          
      }

      .multiselect.range_year_start {

          float: left ;
          width: 48% ; 
          margin: 35px 0 0 0 ; 
          display: block ; 
          
      }


      .multiselect.range_year_end {

          float: right ;
          width: 48% ; 
          margin: 35px 0 0 0 ; 
          display: block ; 
          
      }

      .multiselect.select_year_unique {
          float: left ;
          display: block ; 
      }

      .multiselect.select_year_start {
          float: left ;
          width: 48% ; 
          display: block ; 
      }

      
      .multiselect.select_year_end {
          float: right ;
          width: 48% ; 
          display: block ; 
      }

       .multiselect.select_period_start {
          float: left ;
          width: 48% ; 
          display: block ; 
      }

      
      .multiselect.select_period_end {
          float: right ;
          width: 48% ; 
          display: block ; 
      }

      .multiselect.age_start{
          float: left ;
          width: 48% ; 
          margin: 35px 0 0 0 ; 
          display: block ; 
          &.multiselect--disabled{
              cursor: not-allowed !important ;
          }
      }

      .multiselect.age_end{
          float: right ;
          width: 48% ; 
          margin: 35px 0 0 0 ; 
          display: block ; 
      }

      .multiselect.apc_male,label.apc_male{
          float: left ;
          width: 48% ; 
          margin: 5px 0 0 0 ; 
          display: block ; 
          font-size: 0.8em;
      }

      .multiselect.apc_female,label.apc_female {
          float: right ;
          width: 48% ; 
          margin: 5px 0 0 0 ; 
          display: block ; 
          font-size: 0.8em;
      }

      .multiselect__tag {
          margin : 3px 3px -3px 0px;
          cursor: pointer;
          border-radius: 0px;
          background: $blue;

          &.tag_hide{
              background: #ccc ;
              color: #5c5c5c ; 
              text-decoration: line-through;
          }
      }

      .multiselect__tags {
          min-height: 0px;
          padding: 0px 40px 0 8px;
          border: 0px;
          max-height: 100px;
          overflow-y: auto;
          overflow-x: hidden; 
      }

      .multiselect__tag-icon {

          border-radius: 0px;
          border-left: 1px solid #d0d0d0;
          color:white;
      }

      .multiselect__single {
          padding:5px 0px 0px 0px;
          font-size: 1em ; 

      }

      .multiselect__select {
          height: 32px;
      }

      .multiselect__select:before {
          border-color: #000 transparent transparent;
      }



      .multiselect__tag-icon:after {
          color:white;
      }

      .multiselect__tag-icon:focus, .multiselect__tag-icon:hover {
          background: #d0d0d0;
      }

      .multiselect__option--highlight {
          background: rgba(125, 168, 208, 0.2);
          outline: none;
          color: #000;
      }

      .multiselect__option--selected.multiselect__option--highlight {
          background: rgba(125, 168, 208, 0.2);
          outline: none;
          color: #000;
      }

      .multiselect__option--selected{
          font-weight: 500!important ; 
      }

      .multiselect__option {
          font-size: 0.9em ;
          padding: 5px 8px;
          min-height: 0px;
      }


      .multiselect__option--disabled {
          color: #8D8D8D;
          background: #fff;
      }


      .selectize-input {
          border: 1px solid #d0d0d0;
          padding: 5px 10px;
      }

      fieldset{
          width: 100% ; 
          margin: 10px 0 10px 0 ;
          text-align: left;
          position: relative ;

          
          h3{
              margin-top: 10px ; 
          }

          h4{
              font-size: 0.9em ;
              padding-top: 3px;
              border-top: solid 1px #fff;  
              color: $orange ; 
              font-weight: 600 ; 
              text-align: left;
              padding-left:0px; 

              a.container_fieldset_icon{
                  i{
                      color: $orange ; 
                  }
              }
          }

          h5{
              font-size: .8em;
              font-weight: 800;
              margin: 10px 0 5px 0 ; 
          }

          &.container_color_palette{
              .group_color_palette{
                  input[type="radio"]{
                      display: block ; 
                      position: absolute;
                      z-index: 2;
                      opacity: 0
                  }

                  input[type="radio"]:checked + img{
                      border: dotted 2px #000 ;
                  }

                  label.label_color_palette{
                      cursor: pointer ;
                  }
                  img{
                      max-width: 100%; 
                      min-height: 20px ; 
                  }
              }
          }

          &.f_years{

              position: relative ; 
              
              .selectize-input{
                  width: 75% ;
              }

              a#btn_animate,a#btn_stop{
                  display: block ;
                  position: absolute ;
                  right: 30px ;
                  top: 25px ;
                  transition: all 0.5s ease-in-out;
                  i{
                      color: #3498db;
                      font-size: 2em;
                      background: #fff;
                      border-radius: 20px;
                  }
                  &:hover{
                      i{
                          background: #ccc ; 
                      }
                  }
              }
              a#btn_stop{
                  right: 0px ; 
              }
          }

          &.container_items{
              height: 70px; 
          }
          
          &.container_symbols{
              .item_symbol{
                  width: 14.2857142857% ; 
                  img{
                      display: block ; 
                      max-width: 100% ; 
                  }
              }
          }

          &.container_apcs{
              padding: 0 5px ;
              max-height: 700px; 
              overflow-y: auto ; 
              overflow-x: hidden ; 

              h4{
                  position: relative ; 
              }

              .slider-main{
                  padding: 5px 10px ;
                  min-height: 50px;

                  .vue-slider-mark-label{
                      font-size:.6em ; 
                  }

                  .vue-slider-rail{
                      background-color: #fff;
                  }

                  .vue-slider-disabled{
                      .vue-slider-mark-label{
                          opacity: 0.4 ; 
                      }
                  }
              }

              // sub-containers
              .container_apc_custom1,.container_apc_custom2,.container_apc_custom3{
                  max-height: 400px; 
                  overflow-y: auto;
                  overflow-x: hidden;
                  padding: 10px 0 ; 
              }

              .pretty{
                  position: absolute;
                  right: 0;
                  top: 10px;
              }

              .ptop{
                  margin-top: 0px ; 
              }

              .slider{
                  min-height: 50px ;
                  border-bottom: solid 1px #fff ; 
                  padding: 5px 5px 5px 0 ; 
                  position: relative ;
                  /*span.line-apc{
                      display: inline-block; 
                      width: 50px ; 
                      border-top: dashed 2px #fff ; 
                      margin-right: 5px ; 
                  }*/
                  .vue-slider-rail{
                      background-color: #fff;
                  }

                  .slider-block{
                      height: 35px;
                  }

                  a.toggle{
                      display: block ; 
                      position: absolute;
                      right: 5px;
                      margin-top: -28px;
                      i{
                          font-size: 1.2em ; 
                      }
                  }

                  i.fas-toggle{
                      display: block ; 
                      position: absolute;
                      font-size: 1.2em ; 
                      top: 10px ;
                  }

                  label{
                      font-size: 0.8em ; 
                      font-weight: 500 ; 
                      border-bottom: 4px #fff ; 
                      width: 100% ; 
                      margin-bottom: 10px;
                      &.main{
                          font-weight: 600 ;
                          width: 90% ;  
                          margin-left: 10%;
                      }

                      &.sub{
                          font-size: 0.6em ; 
                          position: absolute ; 
                      }
                  }
                  .vue-slider-mark-label{
                      font-size: 11px;
                  }
              }

              .specific_apc_rates{
                  .row{
                      padding: 5px 0 5px 0;
                      font-size: 0.8em;
                      border-bottom: solid 1px #fff ; 
                      label{
                          margin-left: 0 ;
                          padding-left: 0 ; 
                      }
                      input{
                          max-width: 50px;
                          text-align: right;
                          border: solid 1px #ccc;
                          padding: 2px 5px;
                          float: right;
                          font-size: 1.2em;
                      }
                  } 
              }
          }
      }
      select{
          width: 100% ; 
      }

      select[name="populations"]{
          max-height: 300px;
      }

      select.sort{
          width: 65%;
          float: left;
          margin-right: 10px;
          font-size: 0.9em;
          padding: 3px 5px;
          border: solid 1px #ccc;
      }

      label.sort_icon{
          cursor: pointer ; 
          input{
              display: none ; 
              &:checked+i{
                  border: solid 2px $blue ;
              }
          }
          i{
              display: block ; 
              padding: 3px 5px; 
              background: #ccc ; 
              color: #000 ;
              border-radius: 5px;
              border: solid 2px #fff ;
              &:hover{
                  background: $blue ; 
                  color: #fff ;
              }
              &.fa-sort-amount-up.fa-down{
                  transform: scale(1, -1);
              }
          }
      }

      label{
          margin: 0 5px;
      }
      input.axis{
          text-align: right ; 
          width: 57px ;
          padding: 2px ;  
      }

      .pretty.p-switch .state label{
          text-indent: 3em;
      }

      select[name="age_start"],select[name="age_end"],select[name="year_start"],select[name="year_end"]{
          float: left ;
          width: 48% ; 
          margin: 35px 2% 0 0 ; 
          display: block ; 
      }

      fieldset.container_bin{
          .vue-slider-process{
              display:none;
          }
          .vue-slider-mark-step {
              -webkit-box-shadow: 0 0 0 2px #e8e8e8!important;
              box-shadow: 0 0 0 2px #e8e8e8!important;
          }
      }

      fieldset.container_prediction_nb_period{
          label{
              width: 25%!important;
          }
      }

      fieldset.container_prediction_year_base{
          margin: 0; 
          .multiselect__tags{
              margin: 0; 
          }
          .multiselect.range_year_unique{
              margin: 0;
          }
      }

      fieldset.container_smoothing{
          
          position: relative ;

          &.container_smoothing_opened{
              margin-bottom: 30px;
          }
          
          label.show_dots{
              position: absolute;
              display: block;
              right: -20px;
              top: 3px;
          }
      }    
      
      fieldset.container_populations{
          position: relative ;
          label.group_populations{
              position: absolute;
              display: block;
              right: 10px;
              top: 3px;
              .state label{
                  text-indent: 1em;
                  margin-left: -75px;
              }
          }
          label.populations_multiple{
              position: absolute;
              display: block;
              right: 75px;
              top: 3px;
          }
          .multiselect__tags{
              max-height: 100px!important;
          }
          div.nested{
              .multiselect__option--group {
                  color: #303030!important;
                  background: #fff!important;
                  cursor: default;
                  font-weight: 800;
                  border-top: solid 1px #303030;
              }
              /*.multiselect__option--disabled {
                  color: #8D8D8D !important;
                  background: #fff !important;
                  border-top: none ; 
                  font-weight: normal; 
              }*/
          }
          a.emptyPopButton{
              i{
                  color: $orange ; 
              }
          }
          .pretty.p-round .state label:after, .pretty.p-round .state label:before {
              border-radius: 100%;
              top: 2px !important;
          }
      }

      fieldset.container_years{
          position: relative ;
          label.group_years{
              position: absolute;
              display: block;
              right: 0px;
              top: 3px;
          }
          .pretty.p-round .state label:after, .pretty.p-round .state label:before {
              border-radius: 100%;
              top: 2px !important;
          }
      }


      fieldset.container_cancers{
          position: relative ;
          label.group_cancers{
              position: absolute;
              display: block;
              right: 10px;
              top: 3px;
              .state label{
                  text-indent: 1em;
                  margin-left: -75px;
              }
          }
          .multiselect__tags{
              max-height: 55px!important;
          }

          label.multiple_cancers{
              position: absolute;
              display: block;
              right: 75px;
              top: 3px;
          }
          .pretty.p-round .state label:after, .pretty.p-round .state label:before {
              border-radius: 100%;
              top: 2px !important;
          }
      }

      fieldset.container_selection{
          position: relative ;
          label.group_selection{
              position: absolute;
              display: block;
              right: 10px;
              top: 3px;
              .state label{
                  text-indent: 1em;
                  margin-left: -100px;
              }
          }
      }

      fieldset.container_set_scale {

          label{
              font-size: 1em !important ; 
              padding-top: 0px ;
          }
          input{

              max-width:50%;
          }
      }

      .vue-slider-process{
          background-color: $blue; 
      }

      .pretty .state label{
          font-size: 0.8em !important ; 
          padding-top: 0px ;
      }

      fieldset.container_axis_y .pretty .state label{
          font-size: 1em !important ; 
          padding-top: 0px ;
      }

      .pretty{
          position: absolute;
          top: 9px;
          right: 5px;

          i.icon.fa.fa-check-circle{
              font-size: 1.2em !important;
              margin-top: -3px;
              margin-left: -5px;
          }
      }

      .state label:before{
          top: 0!important;
          margin-left: -2px;
      }

      .margin_bottom{
          margin-bottom: 7px ; 
      }

      .vue-slider-component .vue-slider-tooltip{
          font-size: 0.9em !important;
          padding: 1px 3px!important;
      }

      .vue-slider-component{
          margin-top: 30px ; 
      }

      .vue-slider-component.vue-slider-horizontal-reverse .vue-slider-piecewise-label, .vue-slider-component.vue-slider-horizontal .vue-slider-piecewise-label{
          cursor: pointer ; 
      }

      .selectize-control.multi .selectize-input > div, .selectize-control.multi .selectize-input > div.active {
          background: $blue ;
          color: #ffffff;
      }

      .selectize-dropdown, .selectize-input, .selectize-input input{
          font-size: 0.9em ; 
      }

      .selectize-dropdown .optgroup-header {
          color: #303030;
          background: #fff;
          cursor: default;
          font-weight: 800;
          border-top: solid 1px #303030;
      }

      .custom-dot{
          border: 1px solid #D9D9D9;
          border-radius: 3px;
          width: 15px;
          top: -5px;
          height: 25px;
          position: absolute;
          background: #FFF;
          cursor: pointer;
          box-shadow: inset 0 0 1px #FFF, inset 0 1px 7px #EBEBEB, 0 3px 6px -3px #BBB;
          transition: all .3s;
          &:before,&:after{
              content: "";
              display: block;
              position: absolute;
              height: 14px;
              width: 1px;
              background: #E8E7E6;
              left: 5px;
              top: 5px;
          }
          &:after{
              left: 7px;
          }
      }

      .vue-slider-dot.vue-slider-dot-disabled{
          .custom-dot{
              cursor: not-allowed!important;
          }
      }

      p.desc{
          font-size: 0.8em;
      }
  }

  .block,.download{
      
      padding: 10px ; 
      height: 86vh ; 
      border: solid 1px #ccc ; 
      border-top: none ;

      &.table_block{
          height: auto!important ; 
      }
      
      h2{
          font-size: 1em ; 
          border-bottom: solid 1px #fff ; 
          padding: 5px 0 ; 
          font-weight: 600 ; 
          color: #3498db ; 
      }

      h3{
          font-size: 1em ; 
          color: $blue ; 
          font-weight: 600 ; 
      }
  }

  .navbar{
      padding: 20px;
      position: relative;
      width: 320px;
      height: 100vh;
      aside{
          background: red ;
          color: green ; 
      }
  }

  .nav-tabs{
      min-width: 30px;
      .nav-item{
      /*max-width: 33% ;*/
      }
      .nav-link{
          padding: 0.5rem 10px;
      }
  }

  #container-filters-mobile{
      display: none  ; 
      
      form{
          fieldset{

              display: inline-block;

              select{
                  border: solid 1px #ccc;
                  color: #000 ; 
              }
              select.age_start,select.age_end{
                  width: 50%;
              }
          }
      }
  }

  #container-filters{

      /*
      min-width: 280px;*/
      position: absolute;
      width: calc(100% - 125px ); 
      left: 115px;
      margin-right: 10px;        
      top: 0;
      padding-bottom: 40px;

      a.nav-link{
          color:#212529;
          .spinner-grow{
              visibility: hidden;
              &.show{
                  visibility: visible;
              }
          }
      }
      a.nav-link.active{
          background: #f5f5f5 ; 
          border-color: #ccc #ccc #f5f5f5;
          color:#428bca;
      }

      .filters{
          background: #f5f5f5 ; 
          height: auto ;
          margin-bottom: 15px ; 
          font-size: 1em ;     
          transition: all 0.5s ease-in-out;
          border-top: none;

          .container_label_position{
              display: none;
          }

          .container_age_group{
              /*cursor: not-allowed!important;
              .vue-slider-dot.vue-slider-dot-disabled{
                  cursor: not-allowed!important;
              }*/
          }

          .container_warning{
              font-size: .8em; 
              text-align: left; 
              padding: 10px;
              background: #FFEB3B;
              margin: 10px 0;
              border: solid 1px #617D8B;
              i{
                  color: #FFC107 ;
              }
          }

          &.view_types_0_1.view_sexes_1_2{
              .container_label_position{
                  display: block ; 
              }
          }

          .radios_toggle,.checkbox_toggle {
              margin:0 ; 
              border-radius: 3px;
              input[type="radio"],input[type="checkbox"]{
                  display: none;
              }

              label{
                  display: block;
                  float: left;
                  width: 33%;
                  max-height: 32px;
                  margin: 0;
                  text-align: center;
                  display: block ; 
                  background: #fff;
                  border: solid 1px #d0d0d0;
                  border-right:none;
                  /*height: 31px;*/
                  padding: 9px 0;
                  font-size: 0.9em;
                  cursor: pointer;
                  padding: 5px 0;
                  transition: all 0.5s ease-in-out;
                  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.1);
                  color: #929090 ; 
                  overflow: hidden;
                  &:last-child{
                      border-right: solid 1px #d0d0d0;
                  }
              }

              &.radios_toggle_item2{
                  label{
                      width: 50% ; 
                      &:last-child{
                          border-right: solid 1px #d0d0d0;
                      }
                  }
              }

              &.radios_toggle_item4,&.checkbox_toggle_item4{

                  div.cell{
                      width: 25% ; 
                      label{
                          width: 100%!important;
                      }

                  }
              }

              &.radios_toggle_item4bis,&.radios_toggle_item4bis{

                 label{
                      width: 25% ; 
                  }
              }

              &.radios_toggle_item5{
                  label{
                      width: 20% ; 
                  }
              }

              &.radios_toggle_item6{
                  label{
                      width: 16.6666666667%!important;
                  }
              }

              input[type="radio"]:checked + label,input[type="checkbox"]:checked + label{
                  background: $blue ;
                  color: #fff!important ;
                  font-weight: 700 ; 
                  padding: 4.5px 0 ;
              }

              input[type="radio"]:disabled + label,input[type="checkbox"]:disabled + label{
                  background: #f5f5f5 !important;
                  color: #ccc!important ;
                  cursor: not-allowed;
              }

              label[for="input_inc"],label[for="input_males"],label:last-child{
                  border-radius: 3px 0 0 3px ;    
              }

          }
      }
  }
  .legendCells{
      text{
          font-size: 0.9em;
      }
  }


  .container_uncertainty_limits div
  {
      padding-left:0px;
  }

  #lines_thickness{
      margin-right: 0px;
      input[type="radio"]{
          display: none ; 
      }
      .col-md-3{
          -ms-flex: 0 0 25%!important;
          -webkit-box-flex: 0!important;
          flex: 0 0 25%!important;
          max-width: 25%!important;
      }
      svg{
          background: #fff ; 
          box-shadow: 1px 1px 0px rgba(0, 0, 0, 0.3) ;
          &.first{
          }
      }

      input[type="radio"]:checked ~ svg{
          box-shadow: inset 1px 1px 0px rgba(0, 0, 0, 0.3) ;
      }
      label{
          width: 80% ; 
          opacity: 0 ; 
          cursor: pointer ; 
          position: absolute ; 
      }
  }

  .pretty .state label{
      font-size: 0.9em ; 
      padding-top: 0px ;
  }

  .pretty{
      i.icon.fa.fa-check-circle{
          font-size: 1.6em !important;
          margin-top: -10px;
          margin-left: -5px;
      }
  }

  .pretty .state label:after, .pretty .state label:before{
      width: 20px!important;
      height: 20px!important;
      top: -3px!important;
  }
  
  .btn{
      font-size: 1em;
      border: solid 1px #ccc;
      background: #fff;
  }

  button{
      font-size: 0.8em;
      background: #9cd5ff;
      color: #000;
      border: solid 1px #ccc;
      margin: 4px;
  }

  a.btn_clear{
      background: #CC4666;
      color: #fff !important;
      display: block ; 
      padding: 2px 5px ;
      cursor: pointer ; 
      text-align: center ; 
      &.btn_clear_mobile{
          min-height: 20px;
      }
      &:hover{
          background: #ccc ;
          color: #000!important ;
      }
  }

  .option_chromatic{
      position: relative ; 
      padding: 2px 15px 2px 10px ;
      margin-bottom: 5px; 
      img{
          display: block;
          width: 100% ; 
          height: 20px; 
      }
  }

  .footnote{
      position: absolute;
      bottom: 40px;
      font-size: 0.6em;
      line-height: 10px;
      text-align: left;
      left: 15px;
      max-width: 80%;
  }

  /* Media queries */
     

  @media (max-width: 1080px){
      #container-filters{
          left: 15px ; 
          width: calc(100% - 25px);
      }  
  }

  @media (max-width: 768px){
      #container-filters{
          display: none;
      }
      #container-filters-mobile{
          display: block;
          background: transparent;
          overflow-x: scroll;
          overflow-y: hidden;
          white-space: nowrap;
          -webkit-overflow-scrolling: touch;

          /* hide scrollbar */
          &::-webkit-scrollbar {
              display: none;
          }
      }
      form[name="form-filters-mobile"]{

          fieldset{
              width: 140px ; 
              max-height: 75px ;
              background: #f5f5f5;
              padding: 10px ;
              margin: 5px;
              border-top-left-radius: 0.25rem;
              border-top-right-radius: 0.25rem;
              label{
                  width: 70%;
              }
              select,input[type="text"]{
                  max-height: 30px ; 
                  max-width: 115px ; 
              }

              &.container_populations, &.container_cancers{
                  width: 170px ; 
                  input[type="checkbox"].mobile_input{
                      display: block; 
                      position: absolute ; 
                      right: -15px;
                      width: 50px;
                      height: 30px;
                  }
              }
          }
      }
  }

  @media (max-width: 1400px){
      form fieldset.container_cancers label.group_cancers .state label,
      form fieldset.container_populations label.group_populations .state label{
          span{
              display: none;
          }
      }
  }

  

</style>
